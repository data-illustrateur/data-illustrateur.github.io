(this["webpackJsonpdata-illustrateur"]=this["webpackJsonpdata-illustrateur"]||[]).push([[0],{155:function(e,t,a){},156:function(e,t,a){},157:function(e,t,a){},192:function(e,t,a){},193:function(e,t,a){},300:function(e,t,a){},301:function(e,t,a){},303:function(e,t,a){},305:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),c=a(26),r=a.n(c),s=(a(155),a(156),a(81),a(53)),l=a(12),o=a(6),d=(a(157),a(22)),p=a(54),u=Object(p.b)({name:"canvas",initialState:{selected:[],directSelected:null,directSelectPreview:null,rectSelectRegion:{},itemUpdated:{},scaleUpdated:{},axisHandleVisible:!1,legendClicked:{},dataItemJoined:{},newItemCreated:{},itemsDeleted:[],undoStackChanged:{length:0},redoStackChanged:{length:0},zoomLevel:100,panDelta:{x:0,y:0}},reducers:{select:function(e,t){e.selected=t.payload},directSelect:function(e,t){e.directSelected=t.payload},directSelectPreview:function(e,t){e.directSelectPreview=t.payload},rectSelect:function(e,t){e.rectSelectRegion=t.payload},draw:function(e,t){console.log(t)},updateItem:function(e,t){e.itemUpdated=t.payload},updateScale:function(e,t){e.scaleUpdated=t.payload},toggleAxisHandle:function(e,t){e.axisHandleVisible=t.payload},customizeColorPalette:function(e,t){e.legendClicked=t.payload},joinDataItem:function(e,t){e.dataItemJoined=t.payload},createNewItem:function(e,t){e.newItemCreated=t.payload},deleteItems:function(e,t){e.itemsDeleted=t.payload},updateUndoStack:function(e,t){e.undoStackChanged=t.payload},updateRedoStack:function(e,t){e.redoStackChanged=t.payload},setZoomLevel:function(e,t){e.zoomLevel=t.payload},pan:function(e,t){e.panDelta=t.payload}}}),h=u.actions,y=h.select,f=h.directSelect,v=h.directSelectPreview,b=h.rectSelect,g=(h.draw,h.updateItem),x=h.updateScale,m=h.toggleAxisHandle,j=h.customizeColorPalette,O=h.joinDataItem,S=h.createNewItem,k=h.deleteItems,w=h.updateUndoStack,C=h.updateRedoStack,I=h.setZoomLevel,T=h.pan,B=u.reducer,P=Object(p.b)({name:"tool",initialState:{activeTool:"Select"},reducers:{activateTool:function(e,t){e.activeTool=t.payload}}}),R=P.actions.activateTool,M=P.reducer,G=Object(p.a)({reducer:{canvas:B,tool:M}}),E=a(2),D=a(3),N={"Shape Position":{X:{id:"x",channel:"x",group:"Shape Position",type:"numeric",encodable:!0,class:["line-prop","circle-prop","rect-prop","pointText-prop","path-prop","polygon-prop","image-prop","group-prop","area-prop"],accessor:["x"]},Y:{id:"y",channel:"y",group:"Shape Position",type:"numeric",encodable:!0,class:["line-prop","circle-prop","rect-prop","pointText-prop","path-prop","polygon-prop","image-prop","group-prop","area-prop"],accessor:["y"]},Baseline:{id:"baseline",group:"Shape Position",type:"categorical",encodable:!1,class:["area-prop"],accessor:["baseline"],options:[{display:"top",value:"top"},{display:"middle",value:"middle"},{display:"bottom",value:"bottom"},{display:"left",value:"left"},{display:"center",value:"center"},{display:"right",value:"right"}]}},"Segment Position":{X:{id:"segmentX",channel:"x",group:"Segment Position",type:"numeric",encodable:!0,class:["segment-prop"],accessor:["x"]},Y:{id:"segmentY",channel:"y",group:"Segment Position",type:"numeric",encodable:!0,class:["segment-prop"],accessor:["y"]}},"Vertex Position":{X:{id:"vxX",channel:"x",group:"Vertex Position",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["x"]},Y:{id:"vxY",channel:"y",group:"Vertex Position",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["y"]}},Size:{Width:{id:"width",channel:"width",group:"Size",type:"numeric",encodable:!0,class:["rect-prop","path-prop","image-prop","area-prop"],accessor:["bounds","width"]},Height:{id:"height",channel:"height",group:"Size",type:"numeric",encodable:!0,class:["rect-prop","path-prop","image-prop","area-prop"],accessor:["bounds","height"]},Radius:{id:"radius",channel:"radius",group:"Size",type:"numeric",encodable:!0,class:["circle-prop"],accessor:["radius"]},"Inner Radius":{id:"innerRadius",channel:"innerRadius",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","pie-prop","ring-prop"],accessor:["innerRadius"]},"Outer Radius":{id:"outerRadius",channel:"outerRadius",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","pie-prop","ring-prop"],accessor:["outerRadius"]},Angle:{id:"angle",channel:"angle",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","pie-prop"],accessor:["angle"]},Thickness:{id:"thickness",channel:"thickness",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","pie-prop","ring-prop"],accessor:["thickness"]},Area:{id:"area",channel:"area",group:"Size",type:"numeric",encodable:!0,class:["rect-prop","circle-prop"],accessor:["area"]}},Text:{Content:{id:"content",channel:"text",group:"Text",type:"string",encodable:!0,class:["pointText-prop"],accessor:["text"]},Font:{id:"fontFamily",channel:"fontFamily",group:"Text",type:"categorical",encodable:!1,class:["pointText-prop"],accessor:["fontFamily"],options:[{display:"Arial",value:"Arial, sans-serif"},{display:"Alegreya Sans",value:"'Alegreya Sans', sans-serif"},{display:"Alegreya",value:"'Alegreya', serif"},{display:"Calibri",value:"Calibri, sans-serif"},{display:"Cambria",value:"Cambria, sans-serif"},{display:"Chivo",value:"'Chivo', sans-serif"},{display:"Comic Sans MS",value:"'Comic Sans MS', sans-serif"},{display:"Consolas",value:"Consolas, monospace"},{display:"Cormorant",value:"'Cormorant', serif"},{display:"Courier New",value:"'Courier New', Courier, monospace"},{display:"Eczar",value:"'Eczar', serif"},{display:"Fira Sans",value:"'Fira Sans', sans-serif"},{display:"Futura",value:"Futura, sans-serif"},{display:"Georgia",value:"Georgia, serif"},{display:"Helvetica Neue",value:"'HelveticaNeue', 'Helvetica Neue', 'HelveticaNeueRoman', 'HelveticaNeue-Roman', 'Helvetica Neue Roman', sans-serif"},{display:"Impact",value:"Impact, Charcoal, sans-serif"},{display:"Palatino",value:"Palatino, serif"},{display:"Libre Franklin",value:"'Libre Franklin', sans-serif"},{display:"Playfair Display",value:"'Playfair Display', serif"},{display:"Playfair Display SC",value:"'Playfair Display SC', serif"},{display:"Rubik",value:"'Rubik', sans-serif"},{display:"Space Mono",value:"'Space Mono', monospace"},{display:"Times New Roman",value:"'Times New Roman', TimesNewRoman, serif"},{display:"Trebuchet MS",value:"'Trebuchet MS', sans-serif"},{display:"Verdana",value:"Verdana, Geneva, sans-serif"},{display:"Work Sans",value:"'Work Sans', sans-serif"}]},Color:{id:"textColor",channel:"fillColor",group:"Text",type:"color",encodable:!0,class:["pointText-prop"],accessor:["fillColor"]},Weight:{id:"fontWeight",channel:"fontWeight",group:"Text",type:"categorical",encodable:!1,class:["pointText-prop"],accessor:["fontWeight"],options:[{display:"normal",value:"normal"},{display:"bold",value:"bold"}]},"Size (px)":{id:"fontSize",channel:"fontSize",group:"Text",type:"numeric",encodable:!0,class:["pointText-prop"],accessor:["fontSize"]},"Horz Anchor":{id:"horzAnchor",channel:"horzAnchor",group:"Text",type:"categorical",encodable:!1,class:["pointText-prop"],accessor:["horzAnchor"],options:[{display:"left",value:"left"},{display:"center",value:"center"},{display:"right",value:"right"}]},"Vert Anchor":{id:"vertAnchor",channel:"vertAnchor",group:"Text",type:"categorical",encodable:!1,class:["pointText-prop"],accessor:["vertAnchor"],options:[{display:"top",value:"top"},{display:"middle",value:"middle"},{display:"bottom",value:"bottom"}]}},"Vertex Style":{Shape:{id:"vxShape",channel:"shape",group:"Vertex Style",type:"categorical",encodable:!1,class:["vertex-prop"],accessor:["shape"],options:[{display:"none",value:void 0},{display:"rectangle",value:"rect"},{display:"circle",value:"circle"}]},Width:{id:"vxWidth",channel:"width",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["width"]},Height:{id:"vxHeight",channel:"height",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["height"]},Radius:{id:"vxRadius",channel:"radius",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["radius"]},"Fill Color":{id:"vxFillColor",channel:"fillColor",group:"Vertex Style",type:"color",encodable:!0,class:["vertex-prop"],accessor:["fillColor"]},"Stroke Color":{id:"vxStrokeColor",channel:"strokeColor",group:"Vertex Style",type:"color",encodable:!0,class:["vertex-prop"],accessor:["strokeColor"]},"Stroke Width":{id:"vxStrokeWidth",channel:"strokeWidth",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["strokeWidth"]},Opacity:{id:"vxOpacity",channel:"opacity",group:"Vertex Style",type:"numeric-range",encodable:!1,class:["vertex-prop"],range:[0,1],accessor:["opacity"]}},Style:{"Curve Mode":{id:"curveMode",channel:"curveMode",group:"Style",type:"categorical",encodable:!1,class:["path-prop","area-prop"],accessor:["curveMode"],options:[{display:"Natural",value:"natural",parameters:[]},{display:"Basis",value:"basis",parameters:[]},{display:"BumpX",value:"bumpX",parameters:[]},{display:"BumpY",value:"bumpY",parameters:[]},{display:"Linear",value:"linear",parameters:[]},{display:"Step",value:"step",parameters:[]},{display:"CatmullRom",value:"CatmullRom",parameters:[]},{display:"Cardinal",value:"cardinal",parameters:[]}]},"Fill Color":{id:"fillColor",channel:"fillColor",group:"Style",type:"color",encodable:!0,class:["circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],accessor:["fillColor"]},"Stroke Color":{id:"strokeColor",channel:"strokeColor",group:"Style",type:"color",encodable:!0,class:["line-prop","circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],accessor:["strokeColor"]},"Stroke Width":{id:"strokeWidth",channel:"strokeWidth",group:"Style",type:"numeric",encodable:!0,class:["line-prop","circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],accessor:["strokeWidth"]},Opacity:{id:"opacity",channel:"opacity",group:"Style",type:"numeric-range",encodable:!1,class:["line-prop","circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],range:[0,1],accessor:["opacity"]}},Canvas:{Background:{id:"canvasFillColor",group:"canvas",type:"color",encodable:!1,class:["canvas-prop"],accessor:["fillColor"]}},"Collection Properties":{X:{id:"collectionX",channel:"x",group:"collection",type:"numeric",encodable:!0,class:["collection-prop"],accessor:["x"]},Y:{id:"collectionY",channel:"y",group:"collection",type:"numeric",encodable:!0,class:["collection-prop"],accessor:["y"]},"Children Order":{id:"childrenOrder",group:"collection",type:"categorical",encodable:!1,class:["collection-prop"],accessor:["childrenOrder","field"],options:[{display:"Default",value:"default",parameters:[]}]}},"Glyph Position":{X:{id:"glyphX",channel:"x",group:"Glyph Position",type:"numeric",encodable:!0,class:["glyph-prop"],accessor:["x"]},Y:{id:"glyphY",channel:"y",group:"Glyph Position",type:"numeric",encodable:!0,class:["glyph-prop"],accessor:["y"]}},Layout:{Type:{id:"layoutType",group:"Layout",type:"categorical",encodable:!1,class:["collection-prop","grid-prop","stack-prop","none-prop"],options:[{display:"Grid",value:"grid",parameters:["Num Rows","Num Columns","Row Gap","Column Gap","Horz Gravity","Vert Gravity","Direction"]},{display:"Stack",value:"stack",parameters:["Orientation","Horz Gravity","Vert Gravity"]},{display:"Pack",value:"packing",parameters:[]},{display:"Treemap",value:"treemap",parameters:[]},{display:"None",value:"none",parameters:[]}]},"Num Rows":{id:"numRows",group:"Layout",type:"numeric-integer",encodable:!1,class:["grid-prop","layout-prop"],accessor:["numRows"]},"Num Columns":{id:"numCols",group:"Layout",type:"numeric-integer",encodable:!1,class:["grid-prop","layout-prop"],accessor:["numCols"]},"Row Gap":{id:"rowGap",group:"Layout",type:"numeric",encodable:!1,class:["grid-prop","layout-prop"],accessor:["rowGap"]},"Column Gap":{id:"colGap",group:"Layout",type:"numeric",encodable:!1,class:["grid-prop","layout-prop"],accessor:["colGap"]},Orientation:{id:"orientation",group:"Layout",type:"categorical",encodable:!1,class:["stack-prop","layout-prop"],accessor:["orientation"],options:[{display:"Horizontal",value:"horizontal",parameters:[]},{display:"Vertical",value:"vertical",parameters:[]}]},"Horz Gravity":{id:"horzGravity",group:"Layout",type:"categorical",encodable:!1,class:["grid-prop","stack-prop","layout-prop"],accessor:["horzCellAlignment"],options:[{display:"Left",value:"left",parameters:[]},{display:"Center",value:"center",parameters:[]},{display:"Right",value:"right",parameters:[]}]},"Vert Gravity":{id:"vertGravity",group:"Layout",type:"categorical",encodable:!1,class:["grid-prop","stack-prop","layout-prop"],accessor:["vertCellAlignment"],options:[{display:"Top",value:"top",parameters:[]},{display:"Middle",value:"middle",parameters:[]},{display:"Bottom",value:"bottom",parameters:[]}]},Direction:{id:"direction",group:"Layout",type:"categorical",encodable:!1,class:["grid-prop","layout-prop"],accessor:["direction"],options:[{display:"Left to Right, Bottom to Top",value:"l2r_b2t",parameters:[]},{display:"Left to Right, Top to Bottom",value:"l2r_t2b",parameters:[]},{display:"Right to Left, Bottom to Top",value:"r2l_b2t",parameters:[]},{display:"Right to Left, Top to Bottom",value:"r2l_t2b",parameters:[]},{display:"Bottom to Top, Left to Right",value:"b2t_l2r",parameters:[]},{display:"Top to Bottom, Left to Right",value:"t2b_l2r",parameters:[]},{display:"Bottom to Top, Right to Left",value:"b2t_r2l",parameters:[]},{display:"Top to Bottom, Right to Left",value:"t2b_r2l",parameters:[]}]}},Axis:{"Include 0":{id:"includeZero",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["includeZero"]},"Show Path":{id:"showPath",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["pathVisible"]},"Show Ticks":{id:"showTicks",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["tickVisible"]},Orientation:{id:"axisOrientation",group:"axis",type:"categorical",encodable:!1,class:["axis-prop"],accessor:["orientation"],options:[{display:"top",value:"top"},{display:"bottom",value:"bottom"},{display:"left",value:"left"},{display:"right",value:"right"}]},"Stroke Color":{id:"axisStrokeColor",group:"axis",type:"color",encodable:!1,class:["axis-prop"],accessor:["strokeColor"]},"Text Color":{id:"axisTextColor",group:"axis",type:"color",encodable:!1,class:["axis-prop"],accessor:["textColor"]},"Path Position":{id:"pathPos",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["pathPosition"]},"Tick Offset":{id:"tickOffset",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["tickOffset"]},"Tick Size":{id:"tickSize",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["tickSize"]},"Label Offset":{id:"labelOffset",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["labelOffset"]},"Label Format":{id:"labelFormat",group:"axis",type:"string",encodable:!1,class:["axis-prop"],accessor:["labelFormat"]},"Label Rotation":{id:"labelRotation",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["labelRotation"]},"Show Title":{id:"showTitle",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["showTitle"]}},Legend:{"Text Color":{id:"legendTextColor",group:"legend",type:"color",encodable:!1,class:["legend-prop"],accessor:["textColor"]},Orientation:{id:"legendOrientation",group:"legend",type:"categorical",encodable:!1,class:["legend-prop"],accessor:["orientation"],options:[{display:"Horizontal",value:"horizontal"},{display:"Vertical",value:"vertical"}]}},Gridlines:{"Stroke Color":{id:"gridlineStrokeColor",group:"Gridlines",type:"color",encodable:!1,class:["gridlines-prop"],accessor:["strokeColor"]},"Stroke Width":{id:"gridlineStrokeWidth",group:"Gridlines",type:"numeric",encodable:!1,class:["gridlines-prop"],accessor:["strokeWidth"]}}},L={interpolateBrBG:"BrownBlueGreen",interpolatePRGn:"PurpleGreen",interpolatePiYG:"PinkYellowGreen",interpolatePuOr:"PurpleOrange",interpolateRdBu:"RedBlue",interpolateRdGy:"RedGrey",interpolateRdYlBu:"RedYellowBlue",interpolateRdYlGn:"RedYellowGreen",interpolateSpectral:"Spectral"},U={interpolateTurbo:"Turbo",interpolateViridis:"Viridis",interpolateInferno:"Inferno",interpolateMagma:"Magma",interpolatePlasma:"Plasma",interpolateCividis:"Cividis",interpolateWarm:"Warm",interpolateCool:"Cool",interpolateCubehelixDefault:"CubehelixDefault",interpolateBuGn:"Blue-Green",interpolateBuPu:"Blue-Purple",interpolateGnBu:"Green-Blue",interpolateOrRd:"Orange-Red",interpolatePuBuGn:"Purple-Blue-Green",interpolatePuBu:"Purple-Blue",interpolatePuRd:"Purple-Red",interpolateRdPu:"Red-Purple",interpolateYlGnBu:"Yellow-Green-Blue",interpolateYlGn:"Yellow-Green",interpolateYlOrBr:"Yellow-Orange-Brown",interpolateYlOrRd:"Yellow-Orange-Red"},A=a(11),z=function(e,t,a,i){var n,c=i||"undo",r=e.toJSON(),s=Object(D.a)(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;l.id in r.tables||(r.tables[l.id]=l.toJSON())}}catch(o){s.e(o)}finally{s.f()}a.push(JSON.stringify(r)),"undo"===c?G.dispatch(w({length:a.length})):"redo"===c&&G.dispatch(C({length:a.length}))},Y=function(e,t){var a,i="",n=Object(D.a)(e);try{for(n.s();!(a=n.n()).done;){var c=a.value;if(c.getSVGPathData)i+=c.getSVGPathData();else if(c.bounds){var r=c.bounds;i+=["M",r.left,r.top].join(" "),i+=["L",r.right,r.top].join(" "),i+=["L",r.right,r.bottom].join(" "),i+=["L",r.left,r.bottom,"Z"].join(" ")}else if("vertex"===c.type){var s=Math.max(c.width,c.height,c.radius,t);i+=["M",c.x-s/2,c.y-s/2].join(" "),i+=["L",c.x+s/2,c.y-s/2].join(" "),i+=["L",c.x+s/2,c.y+s/2].join(" "),i+=["L",c.x-s/2,c.y+s/2,"Z"].join(" ")}}}catch(l){n.e(l)}finally{n.f()}return i},F=function(e,t,a,i){if(!e)return null;var n;if(t.length>=1?n=i.getItem(t[0]):a&&(n=i.getItem(a)),!n)return null;var c=i.getEncodingByItem(n,e);return c?c.aggregator:null},V=function(e,t,a,i){var n;if(t.length>=1?n=i.getItem(t[0]):a&&(n=i.getItem(a)),!n)return null;var c=i.getEncodingByItem(n,e);return c?c.scale.scheme:null},H=function(e,t,a,i){var n;if(t.length>=1?n=i.getItem(t[0]):a&&(n=i.getItem(a)),!n)return null;var c=i.getEncodingByItem(n,e);return c?c.scale.type:null},W=function(e,t){for(var a=0,i=[["x","width"],["y","height"],["fillColor","strokeColor"]];a<i.length;a++){var n=i[a];if(n.indexOf(e)>=0&&n.indexOf(t)>=0)return!0}return!1},X=function(e,t){var a=e.bounds.width/e.bounds.height,i="collection"===e.type&&e.layout&&"grid"===e.layout.type,n=i?3*e.layout.rowGap:5,c=i?3*e.layout.colGap:5;return a>2?A.layout("grid",{numCols:1,rowGap:n}):A.layout("grid",{numRows:1,colGap:c})},_=function(e,t){var a=document.getElementById("canvas"),i=a.createSVGPoint();i.x=e,i.y=t;var n=i.matrixTransform(a.getScreenCTM().inverse());return[n.x,n.y]},J=function(e,t){var a=function(e,t){switch(e){case"vertex":return"vx"+t.replace(/^\w/,(function(e){return e.toUpperCase()}));case"scene":return"canvas"+t.replace(/^\w/,(function(e){return e.toUpperCase()}));case"collection":case"segment":case"legend":return e+t.replace(/^\w/,(function(e){return e.toUpperCase()}));default:return t}}(e,t);for(var i in N)for(var n in N[i])if(N[i][n].id===a)return N[i][n];return null},q=[],K=void 0,Z=void 0,Q=function(){for(var e=["M",q[0][0],q[0][1]].join(" "),t=1;t<q.length;t++){var a=q[t][0],i=q[t][1];a===q[0][0]&&i===q[0][1]?e+="Z":e+=["L",q[t][0],q[t][1]].join(" ")}void 0!==K&&void 0!==Z&&(e+=["L",K,Z].join(" ")),E.select("#polylineToolUI").style("visibility","visible").style("fill","none").attr("d",e)},$=function(e,t,a,i){if(q&&0!==q.length){if(Q(),E.select("#polylineToolUI").style("visibility","hidden"),q.length>1){z(e,t,i);var n=e.mark("path",{vertices:q});G.dispatch(S(n.id)),a.render(e)}q=[],K=void 0,Z=void 0}},ee=a(1);var te,ae,ie=Object(d.b)((function(e){return{selected:e.canvas.selected,itemUpdated:e.canvas.itemUpdated,scaleUpdated:e.canvas.scaleUpdated,dataItemJoined:e.canvas.dataItemJoined,itemsDeleted:e.canvas.itemsDeleted,zoomLevel:e.canvas.zoomLevel,panDelta:e.canvas.panDelta}}))((function(e){return Object(i.useEffect)((function(){e.renderer.render(e.scene)}),[e.scene,e.renderer,e.itemUpdated,e.scaleUpdated,e.dataItemJoined,e.itemsDeleted]),Object(i.useEffect)((function(){if(e.zoomLevel)for(var t=0,a=["#canvas","#evtLayer"];t<a.length;t++){var i=a[t],n=E.select(i),c=n.attr("viewBox"),r=n.node().getBoundingClientRect(),s=r.width,l=r.height,o=c?parseInt(c.split(" ")[0]):0,d=c?parseInt(c.split(" ")[1]):0;n.attr("viewBox",[o,d,o+100*s/e.zoomLevel,d+100*l/e.zoomLevel].join(" "))}}),[e.zoomLevel]),Object(i.useEffect)((function(){if(e.panDelta)for(var t=0,a=["#canvas","#evtLayer"];t<a.length;t++){var i=a[t],n=E.select(i),c=n.attr("viewBox"),r=n.node().getBoundingClientRect(),s=r.width,l=r.height,o=c?c.split(" ").map((function(e){return parseInt(e)})):[0,0,s,l];n.attr("viewBox",[o[0]+e.panDelta.x,o[1]+e.panDelta.y,o[2],o[3]].join(" "))}}),[e.panDelta]),Object(i.useEffect)((function(){var t=function(t,a){var i=G.getState().canvas.selected;if(i&&i.length>0){var n=e.scene.getItem(i[0]);n&&"axis"===n.type?(G.dispatch(m({visible:!1})),"x"===n.channel||"width"===n.channel?n.pathY=n.pathY+a:"y"!==n.channel&&"height"!==n.channel||(n.pathX=n.pathX+t),G.dispatch(g({id:n.id,type:n.type,properties:{pathPosition:n.pathPosition}}))):n&&(e.scene.translate(n,t,a),G.dispatch(g({id:n.id,type:n.type,properties:{x:n.x,y:n.y}})))}var c=G.getState().canvas.directSelected;if(c){var r=e.scene.getItem(c);"path"===r.parent.type&&(r._doTranslate(t,a),G.dispatch(g({id:r.parent.id,type:r.parent.type,properties:{x:r.parent.x,y:r.parent.y}})))}};document.addEventListener("keydown",(function(a){switch(a.key){case"Delete":var i=G.getState().canvas.selected;if(i&&i.length>0)for(var n=i.length-1;n>=0;n--){var c=e.scene.getItem(i[n]);c&&c.parent===e.scene&&(G.dispatch(y([])),e.scene.removeItem(c),G.dispatch(k([c].map((function(e){return e.id})))))}break;case"ArrowLeft":t(-5,0);break;case"ArrowRight":t(5,0);break;case"ArrowUp":t(0,-5);break;case"ArrowDown":t(0,5);break;case"Escape":"Pen"===G.getState().tool.activeTool&&($(e.scene,e.datasets,e.renderer,e.undoStack),G.dispatch(R("Select")));break;case"+":case"=":if(a.ctrlKey||a.metaKey){a.preventDefault();var r=Math.min(400,G.getState().canvas.zoomLevel+10);G.dispatch(I(r))}break;case"-":if(a.ctrlKey||a.metaKey){a.preventDefault();var s=Math.max(20,G.getState().canvas.zoomLevel-10);G.dispatch(I(s))}break;case"0":(a.ctrlKey||a.metaKey)&&(a.preventDefault(),function(){for(var e=0,t=["#canvas","#evtLayer"];e<t.length;e++){var a=t[e],i=E.select(a),n=i.node().getBoundingClientRect(),c=n.width,r=n.height;i.attr("viewBox",[0,0,c,r].join(" "))}}())}}))}),[e.scene,e.datasets,e.renderer,e.undoStack]),"canvas"===e.type?Object(ee.jsx)("canvas",{className:"canvas",id:"canvas"}):Object(ee.jsx)("svg",{className:"canvas",id:"canvas"})})),ne=a(20),ce={nw:function(e){return{x:e.left,y:e.top}},n:function(e){return{x:e.x,y:e.top}},ne:function(e){return{x:e.right,y:e.top}},e:function(e){return{x:e.right,y:e.y}},se:function(e){return{x:e.right,y:e.bottom}},s:function(e){return{x:e.x,y:e.bottom}},sw:function(e){return{x:e.left,y:e.bottom}},w:function(e){return{x:e.left,y:e.y}}},re=void 0,se=function(e){if(e){var t,a,i,n,c,r,s,l,o,d,p=E.select("#axisHandle");switch(e.channel){case"x":case"width":t=e.bounds.left,a=re||e.bounds.middle,i=e.bounds.right,n=a,s=45,l=16,o=(c=e.isFlipped?e.bounds.left:e.bounds.right-s)+5,d=(r=a-l/2)+l/2,p.select("text").style("writing-mode","lr");break;case"y":case"height":t=re||e.bounds.center,a=e.bounds.top,i=t,n=e.bounds.bottom,l=45,c=t-(s=16)/2,o=t+3,d=(r=e.isFlipped?e.bounds.bottom-l:e.bounds.top)+5,p.select("text").style("writing-mode","tb").style("glyph-orientation-vertical",0)}p.select("line").attr("x1",t).attr("x2",i).attr("y1",a).attr("y2",n),p.select("rect").attr("x",c).attr("y",r).attr("width",s).attr("height",l).attr("rx",6).attr("ry",6),p.select("text").text(e.encoding.scale.rangeExtent.toFixed(0)+"px").attr("x",o).attr("y",d)}},le=function(e,t,a){var i={x:e.left,y:e.top,width:e.width,height:e.height};for(var n in i)a.attr(n,i[n]);for(var c in t)a.style(c,t[c])},oe=function(e){te=e.x,ae=e.y},de=function(e,t,a,i){var n,c=e.children.filter((function(e){return e!==t&&"axis"!==e.type&&"legend"!==e.type&&"gridlines"!==e.type})),r=[],s="x"===a?["left","right","center"]:["top","bottom","middle"],l=Object(D.a)(c);try{for(l.s();!(n=l.n()).done;){var o,d=n.value,p=Object(D.a)(s);try{for(p.s();!(o=p.n()).done;){var u=o.value;r.push({item:d,anchor:u})}}catch(h){p.e(h)}finally{p.f()}}}catch(h){l.e(h)}finally{l.f()}return r.sort((function(e,t){return Math.abs(e.item.bounds[e.anchor]-i)-Math.abs(t.item.bounds[t.anchor]-i)})),r[0]},pe=function(e,t,a,i,n){var c=t.bounds,r={top:c.top,height:c.height,left:c.left,width:c.width},s="n"!==e&&"s"!==e?de(n,t,"x",a):void 0,l="e"!==e&&"w"!==e?de(n,t,"y",i):void 0,o=a-te,d=i-ae;return s&&Math.abs(s.item.bounds[s.anchor]-a)<=5?(o=s.item.bounds[s.anchor]-te,E.select("#hGuide").style("visibility","visible").attr("x1",s.item.bounds[s.anchor]).attr("x2",s.item.bounds[s.anchor]).attr("y1",Math.min(s.item.bounds.top,t.bounds.top)-10).attr("y2",Math.max(s.item.bounds.bottom,t.bounds.bottom)+10)):E.select("#hGuide").style("visibility","hidden"),l&&Math.abs(l.item.bounds[l.anchor]-i)<=5?(d=l.item.bounds[l.anchor]-ae,E.select("#vGuide").style("visibility","visible").attr("y1",l.item.bounds[l.anchor]).attr("y2",l.item.bounds[l.anchor]).attr("x1",Math.min(l.item.bounds.left,t.bounds.left)-10).attr("x2",Math.max(l.item.bounds.right,t.bounds.right)+10)):E.select("#vGuide").style("visibility","hidden"),e.indexOf("s")>=0?(d<1-c.height&&(d=1-c.height),r.height+=d):e.indexOf("n")>=0&&(d>c.height-1&&(d=c.height-1),r.height-=d,r.top+=d),e.indexOf("e")>=0?(o<1-c.width&&(o=1-c.width),r.width+=o):e.indexOf("w")>=0&&(o>c.width-1&&(o=c.width-1),r.left+=o,r.width-=o),r.right=r.left+r.width,r.bottom=r.top+r.height,r.x=(r.left+r.right)/2,r.y=(r.top+r.bottom)/2,r},ue=["nw","n","ne","w","sw","s","se","e"];var he,ye,fe,ve,be,ge,xe,me,je,Oe,Se,ke,we=Object(d.b)((function(e){return{selected:e.canvas.selected,directSelected:e.canvas.directSelected,directSelectPreview:e.canvas.directSelectPreview,itemUpdated:e.canvas.itemUpdated,axisHandleVisible:e.canvas.axisHandleVisible,scaleUpdated:e.canvas.scaleUpdated,rectSelectRegion:e.canvas.rectSelectRegion}}))((function(e){return Object(i.useEffect)((function(){if(0!==e.selected.length){var t=e.scene.getItem(e.selected[0]);E.select("#selectionUI").selectAll("circle").style("stroke","#1592e6").style("fill","white").call(E.drag().on("start",oe).on("drag",(function(a){!function(e,t,a,i){var n=pe(t,a,e.x,e.y,i),c=E.select("#handleG");E.select("#boundsOutline").attr("x",n.left).attr("y",n.top).attr("width",n.width).attr("height",n.height);var r,s=Object(D.a)(ue);try{for(s.s();!(r=s.n()).done;){var l=r.value,o=ce[l](n);c.select("."+l).attr("cx",o.x).attr("cy",o.y)}}catch(d){s.e(d)}finally{s.f()}}(a,E.select(this).attr("class"),t,e.scene)})).on("end",(function(a){!function(e,t,a,i){var n,c=pe(t,a,e.x,e.y,i);if("rect"===a.type||"line"===a.type)n={width:c.width,height:c.height,xRef:t.indexOf("e")<0?"right":"left",yRef:t.indexOf("n")<0?"top":"bottom"};else if("circle"===a.type)n={radius:Math.max(c.width,c.height)/2,xRef:t.indexOf("e")<0?"right":"left",yRef:t.indexOf("n")<0?"top":"bottom"};else if("pointText"===a.type){var r=Math.floor(parseInt(a.fontSize)*c.width/a.bounds.width);n={fontSize:(r=Math.max(4,r))+"px"}}n&&(i.setProperties(a,n),G.dispatch(g({id:a.id,type:a.type,properties:n})))}(a,E.select(this).attr("class"),t,e.scene)})))}}),[e.scene,e.selected]),Object(i.useEffect)((function(){!function(e,t){if(E.select("#selectionUI").selectAll("circle").style("visibility","hidden"),E.select("#handleG").style("visibility","hidden"),E.selectAll(".openGroup").style("visibility","hidden"),E.select("#pathOutline").style("visibility","hidden"),E.select("#selectPeerOutline").style("visibility","hidden"),E.select("#boundsOutline").style("visibility","hidden"),1===e.length){var a=t.getItem(e[0]);if(!a)return;var i,n,c=Object(A.getPeersInScene)(a);if(c.length>1){var r=Y(c,2);E.select("#selectPeerOutline").style("visibility","visible").attr("d",r)}i="collection"===a.type||"axis"===a.type||"legend"===a.type?{stroke:"#1ecb40","stroke-dasharray":"5,5","stroke-width":2,fill:"none"}:{stroke:"#1592e6","stroke-dasharray":"none","stroke-width":1.5,fill:"none"},"legend"===a.type?((n=a.bounds.clone()).left-=10,n.top-=10,n.width+=20,n.height+=20):n=a.bounds,"path"===a.type||"area"===a.type||"polygon"===a.type||"arc"===a.type||"pie"===a.type?(E.select("#boundsOutline").style("visibility","hidden"),E.select("#pathOutline").style("visibility","visible"),E.select("#pathSegments").attr("d",a.getSVGPathData()),E.select("#pathVertices").attr("d",Y(a.vertices,2))):(E.select("#boundsOutline").style("visibility","visible"),E.select("#pathOutline").style("visibility","hidden"),le(n,i,E.select("#boundsOutline"))),E.selectAll(".openGroup").style("visibility","hidden");for(var s=a.parent,l=1,o={stroke:"#1ecb40","stroke-width":4,fill:"none",opacity:.15,visibility:"visible"};s&&"scene"!==s.type;)le(s.bounds,o,E.select("#openGroup"+l)),s=s.parent,l+=1;E.select("#handleG").style("visibility","visible");var d=E.select("#selectionUI");if(["rect","circle","line","pointText"].indexOf(a.type)<0)return void d.selectAll("circle").style("visibility","hidden");var p,u=Object(D.a)(ue);try{for(u.s();!(p=u.n()).done;){var h=p.value,y=ce[h](n);d.select("."+h).style("cursor",h+"-resize").attr("cx",y.x).attr("cy",y.y).style("visibility","visible")}}catch(g){u.e(g)}finally{u.f()}"line"===a.type?(0===a.bounds.width&&(d.selectAll("circle").style("visibility","hidden"),d.select(".n").style("visibility","visible"),d.select(".s").style("visibility","visible")),0===a.bounds.height&&(d.selectAll("circle").style("visibility","hidden"),d.select(".e").style("visibility","visible"),d.select(".w").style("visibility","visible"))):"pointText"===a.type&&(d.selectAll("circle").style("visibility","hidden"),d.select(".se").style("visibility","visible"))}else if(e.length>1){var f=e.map((function(e){return t.getItem(e)}));E.select("#handleG").style("visibility","visible");for(var v=f[0].bounds.clone(),b=1;b<f.length;b++)v=v.union(f[b].bounds);le(v,{stroke:"#1592e6","stroke-dasharray":"none","stroke-width":1.5,fill:"none",visibility:"visible"},E.select("#boundsOutline")),E.select("#selectPeerOutline").style("visibility","hidden"),E.select("#pathOutline").style("visibility","hidden")}}(e.selected,e.scene),function(e,t){if(E.selectAll(".directSelectPreview").style("visibility","hidden"),e){var a=t.getItem(e);if(!a)return E.selectAll(".directSelected").style("visibility","hidden"),void E.select("#directSelectPeerOutline").style("visibility","hidden");var i=Object(A.getPeersInScene)(a);if(i.length>1){var n=Y(i,4);E.select("#directSelectPeerOutline").style("visibility","visible").attr("d",n)}var c={stroke:"#1592e6","stroke-width":2,fill:"none",visibility:"visible"};if("segment"===a.type){var r=E.select("#segment").attr("x1",a.vertex1.x).attr("y1",a.vertex1.y).attr("x2",a.vertex2.x).attr("y2",a.vertex2.y);for(var s in c)r.style(s,c[s]);E.select("#vertex").style("visibility","hidden")}else{var l={left:a.x-2,top:a.y-2,width:4,height:4};le(l,c,E.select("#vertex")),E.select("#segment").style("visibility","hidden")}}else E.selectAll(".directSelected").style("visibility","hidden"),E.select("#directSelectPeerOutline").style("visibility","hidden")}(e.directSelected,e.scene),function(e,t){if(1===e.length){var a=t.getItem(e[0]);if(a&&"collection"===a.type&&a.layout&&"grid"===a.layout.type){for(var i=a.layout,n=i.cellBounds,c=i.numCols,r=i.numRows,s=Math.min.apply(Math,Object(ne.a)(n.map((function(e){return e.top})))),l=Math.min.apply(Math,Object(ne.a)(n.map((function(e){return e.left})))),o=[],d=0;d<c-1;d++)o.push({x:l+n[0].width+d*(n[0].width+i.colGap),y:s,width:Math.abs(i.colGap),height:a.bounds.height,type:"c"});for(var p=0;p<r-1;p++)o.push({x:l,y:s+n[0].height+p*(n[0].height+i.rowGap),width:a.bounds.width,height:Math.abs(i.rowGap),type:"r"});var u=E.select("#gridGaps").style("visibility","visible").selectAll("rect").data(o);u.enter().append("rect").merge(u).attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height})).style("fill","pink").style("opacity",.2).style("cursor",(function(e){return"r"===e.type?"ns-resize":"ew-resize"})).call(E.drag().on("drag",(function(i){i.sourceEvent.stopPropagation();var n=E.select(this).datum().type,c={},r="r"===n?"rowGap":"colGap",s="r"===n?i.dy:i.dx;c[r]=a.layout[r]+s,t.setProperties(a.layout,c),G.dispatch(g({id:e[0],type:a.type,properties:c}))}))),u.exit().remove()}else E.select("#gridGaps").style("visibility","hidden")}else E.select("#gridGaps").style("visibility","hidden")}(e.selected,e.scene),E.selectAll(".smartGuide").style("visibility","hidden")}),[e.scene,e.selected,e.directSelected,e.itemUpdated,e.scaleUpdated]),Object(i.useEffect)((function(){!function(e,t){if(E.selectAll(".directSelectPreview").style("visibility","hidden"),e){var a=t.getItem(e);if(!a)return;var i={stroke:"#79AFE0","stroke-width":2,fill:"none",visibility:"visible"};if("segment"===a.type){var n=E.select("#segmentPreview").attr("x1",a.vertex1.x).attr("y1",a.vertex1.y).attr("x2",a.vertex2.x).attr("y2",a.vertex2.y);for(var c in i)n.style(c,i[c])}else{var r={left:a.x-3,top:a.y-3,width:6,height:6};le(r,i,E.select("#vertexPreview"))}}}(e.directSelectPreview,e.scene)}),[e.directSelectPreview,e.scene]),Object(i.useEffect)((function(){var t;e.axisHandleVisible.visible?(e.scene,(t=e.scene.getItem(e.axisHandleVisible.axis))&&(E.select("#axisHandle").style("visibility","visible").select("rect").call(E.drag().on("start",(function(e){"x"===t.channel||"width"===t.channel?re=t.bounds.middle:"y"!==t.channel&&"height"!==t.channel||(re=t.bounds.center)})).on("end",(function(e){re=void 0})).on("drag",(function(e){e.sourceEvent.stopPropagation();var a=t.isFlipped?-1:1,i=t.encoding.scale;if("x"===t.channel||"width"===t.channel){var n=i.rangeExtent+e.dx*a;if(n<=0){if(!(i.getEncodedChannels().indexOf("width")<0))return;i.isFlipped=!i.isFlipped}t.encoding.scale.rangeExtent=n,t.autoUpdateTicks()}else if("y"===t.channel||"height"===t.channel){var c=i.rangeExtent-e.dy*a;if(c<=0){if(!(i.getEncodedChannels().indexOf("height")<0))return;i.isFlipped=!i.isFlipped}t.encoding.scale.rangeExtent=c,t.autoUpdateTicks()}G.dispatch(x({id:t.encoding.scale.id,type:t.encoding.scale.type,axis:t.id}))}))),se(t))):E.select("#axisHandle").style("visibility","hidden")}),[e.scene,e.axisHandleVisible]),Object(i.useEffect)((function(){0!==e.rectSelectRegion.width&&0!==e.rectSelectRegion.height||E.select("#rectSelectRegion").style("visibility","hidden");le(e.rectSelectRegion,{stroke:"#ccc","stroke-width":2,fill:"none","stroke-dasharray":"5,5",opacity:1,visibility:"visible"},E.select("#rectSelectRegion"))}),[e.rectSelectRegion]),Object(i.useEffect)((function(){e.scaleUpdated.axis&&se(e.scene.getItem(e.scaleUpdated.axis))}),[e.scene,e.scaleUpdated]),Object(ee.jsxs)("g",{id:"selectionUI",children:[Object(ee.jsx)("rect",{id:"openGroup1",className:"openGroup"}),Object(ee.jsx)("rect",{id:"openGroup2",className:"openGroup"}),Object(ee.jsx)("rect",{id:"openGroup3",className:"openGroup"}),Object(ee.jsx)("rect",{id:"openGroup4",className:"openGroup"}),Object(ee.jsx)("path",{id:"selectPeerOutline",style:{stroke:"#60bdf0",strokeWidth:1,fill:"none"}}),Object(ee.jsx)("path",{id:"directSelectPeerOutline",style:{stroke:"#60bdf0",strokeWidth:1,fill:"none"}}),Object(ee.jsx)("rect",{id:"boundsOutline"}),Object(ee.jsx)("g",{id:"handleG",children:ue.map((function(e){return Object(ee.jsx)("circle",{className:e,r:"4"},e)}))}),Object(ee.jsxs)("g",{id:"axisHandle",children:[Object(ee.jsx)("line",{style:{strokeWidth:"2px",stroke:"#1ecb40"}}),Object(ee.jsx)("rect",{style:{fill:"#1ecb40"}}),Object(ee.jsx)("text",{style:{fill:"white",fontSize:"11px",pointerEvents:"none",fontWeight:"bold",alignmentBaseline:"middle",dominantBaseline:"middle"}})]}),Object(ee.jsxs)("g",{id:"pathOutline",style:{stroke:"#1592e6",strokeWidth:2,fill:"none"},children:[Object(ee.jsx)("path",{id:"pathSegments"}),Object(ee.jsx)("path",{id:"pathVertices"})]}),Object(ee.jsx)("g",{id:"gridGaps",children:Object(ee.jsx)("rect",{})}),Object(ee.jsx)("rect",{id:"rectSelectRegion"}),Object(ee.jsx)("line",{id:"segment",className:"directSelected"}),Object(ee.jsx)("rect",{id:"vertex",className:"directSelected"}),Object(ee.jsx)("line",{id:"segmentPreview",className:"directSelectPreview"}),Object(ee.jsx)("rect",{id:"vertexPreview",className:"directSelectPreview"}),Object(ee.jsx)("line",{id:"hGuide",className:"smartGuide",style:{strokeWidth:"2px",stroke:"#f50088",strokeDasharray:"5,5"}}),Object(ee.jsx)("line",{id:"vGuide",className:"smartGuide",style:{strokeWidth:"2px",stroke:"#f50088",strokeDasharray:"5,5"}})]})})),Ce=!1,Ie=!1,Te=!1,Be=null,Pe={},Re={},Me=function(e,t){var a=_(e.clientX,e.clientY),i=G.getState().canvas.selected;if(0===i.length)return A.hitTest(t,a[0],a[1]);var n=t.getItem(i[0]);if("axis"===n.type||"legend"===n.type)return A.hitTest(t,a[0],a[1]);for(var c=n.parent;c;){var r=A.hitTest(c,a[0],a[1]);if(r)return r;c=c.parent}return null},Ge=function(e,t,a,i,n,c){"axis"===e.type?(G.dispatch(m({visible:!1})),"x"===e.channel||"width"===e.channel?e.pathY=i:"y"!==e.channel&&"height"!==e.channel||(e.pathX=a),G.dispatch(g({id:e.id,type:e.type,properties:{pathPosition:e.pathPosition}}))):(t.translate(e,n,c),G.dispatch(g({id:e.id,type:e.type,properties:{x:e.x,y:e.y}})))},Ee=!1,De=!1,Ne=!1,Le=!1,Ue=!1,Ae=!1,ze=!1,Ye=!1,Fe=!1;function Ve(e){return Object(i.useEffect)((function(){document.getElementById("evtLayer").addEventListener("wheel",(function(e){e.preventDefault(),G.dispatch(T({x:e.deltaX,y:e.deltaY}))}))}),[]),Object(ee.jsxs)("svg",{id:"evtLayer",className:"canvas",onDoubleClick:function(t){if("Select"===G.getState().tool.activeTool)!function(e,t){var a=G.getState().canvas.selected;if(a.length>0){var i=t.getItem(a[0]);if(i&&"axis"!==i.type&&"legend"!==i.type&&i.children&&i.children.length>0){var n=_(e.clientX,e.clientY),c=A.hitTest(i,n[0],n[1]);c&&G.dispatch(y([c.id]))}}}(t,e.scene)},onMouseDown:function(t){switch(t.preventDefault(),G.getState().tool.activeTool){case"Select":!function(e,t){Ce=!0,he=e.clientX,ye=e.clientY;var a=Me(e,t);if(null!==a&&"legend"===a.type&&a.channel.indexOf("Color")>0&&"string"===a.fieldType){var i=_(e.clientX,e.clientY),n=a.pathHitTest(i[0],i[1]);if(null!==n){var c=n.dataScope.getFieldValue("category");return void G.dispatch(j({legend:a.id,value:c}))}}if(G.dispatch(j({legend:null,value:null})),Be=a,null===a&&0===e.button)Ie=!0;else if(null!==a){var r=G.getState().canvas.selected.map((function(e){return t.getItem(e)}));r.push(a);var s,l=Object(D.a)(r);try{for(l.s();!(s=l.n()).done;){var o=s.value;Pe[o.id]="axis"!==o.type||"y"!==o.channel&&"height"!==o.channel?o.x:o.pathX,Re[o.id]="axis"!==o.type||"x"!==o.channel&&"width"!==o.channel?o.y:o.pathY}}catch(d){l.e(d)}finally{l.f()}}}(t,e.scene);break;case"Rect":!function(e,t){De=!0;var a=_(e.clientX,e.clientY);be=a[0],ge=a[1]}(t,e.scene);break;case"Ellipse":!function(e,t){Le=!0;var a=_(e.clientX,e.clientY);xe=a[0],me=a[1]}(t,e.scene);break;case"Ring":!function(e,t){Ae=!0;var a=_(e.clientX,e.clientY);je=a[0],Oe=a[1]}(t,e.scene);break;case"DirectSelect":!function(e,t){var a=_(e.clientX,e.clientY);A.inMarkHitTest(t,a[0],a[1],4)||(fe=e.clientX,ve=e.clientY,Ee=!0)}(t,e.scene);break;case"Line":!function(e,t){Ye=!0;var a=_(e.clientX,e.clientY);Se=a[0],ke=a[1]}(t,e.scene);break;case"Pen":e.scene}},onMouseMove:function(t){switch(t.preventDefault(),G.getState().tool.activeTool){case"Select":!function(e,t,a){if(Ce){if(Ie){var i=_(Math.min(he,e.clientX),Math.min(ye,e.clientY)),n=i[0],c=i[1],r=Math.abs(e.clientX-he),s=Math.abs(e.clientY-ye);G.dispatch(b({left:n,top:c,width:r,height:s}))}else if(Be){var l=G.getState().canvas.selected,o=l.indexOf(Be.id)>=0;if(0!==l.length&&o){if(o){Te=!0;var d,p=Object(D.a)(G.getState().canvas.selected);try{for(p.s();!(d=p.n()).done;){var u=d.value,h=t.getItem(u);Ge(h,t,Pe[h.id]+e.clientX-he,Re[h.id]+e.clientY-ye,Pe[h.id]+e.clientX-he-h.x,Re[h.id]+e.clientY-ye-h.y)}}catch(v){p.e(v)}finally{p.f()}}}else G.dispatch(y([Be.id])),Te=!0,Ge(Be,t,Pe[Be.id]+e.clientX-he,Re[Be.id]+e.clientY-ye,Pe[Be.id]+e.clientX-he-Be.x,Re[Be.id]+e.clientY-ye-Be.y)}}else{var f=Me(e,t);f&&"axis"===f.type&&f.encoding?G.dispatch(m({axis:f.id,visible:!0})):G.dispatch(m({visible:!1}))}}(t,e.scene,e.renderer);break;case"Rect":!function(e,t){if(De){Ne=!0;var a,i,n,c,r=_(e.clientX,e.clientY),s=be,l=r[0],o=ge,d=r[1];a=Math.min(s,l),i=Math.min(o,d),n=Math.abs(s-l),c=Math.abs(o-d),e.shiftKey&&(c=n=Math.min(n,c),a=s<l?s:s-n,i=o<d?o:o-c),E.select("#rectToolUI").style("visibility","visible").attr("x",a).attr("y",i).attr("width",n).attr("height",c)}}(t,e.scene);break;case"Ellipse":!function(e,t){if(Le){Ue=!0;var a=_(e.clientX,e.clientY),i=xe,n=a[0],c=me,r=a[1],s=(i+n)/2,l=(c+r)/2,o=Math.min(Math.abs(i-n)/2,Math.abs(c-r)/2);E.select("#circleToolUI").style("visibility","visible").attr("cx",s).attr("cy",l).attr("r",o)}}(t,e.scene);break;case"Ring":!function(e,t){if(Ae){ze=!0;var a=_(e.clientX,e.clientY),i=je,n=a[0],c=Oe,r=a[1],s=(i+n)/2,l=(c+r)/2,o=Math.min(Math.abs(i-n)/2,Math.abs(c-r)/2);E.select("#ringToolOuterUI").style("visibility","visible").attr("cx",s).attr("cy",l).attr("r",o),E.select("#ringToolInnerUI").style("visibility","visible").attr("cx",s).attr("cy",l).attr("r",2*o/3)}}(t,e.scene);break;case"DirectSelect":!function(e,t){if(Ee){var a=_(Math.min(fe,e.clientX),Math.min(ve,e.clientY)),i=a[0],n=a[1],c=Math.abs(e.clientX-fe),r=Math.abs(e.clientY-ve);G.dispatch(b({left:i,top:n,width:c,height:r}))}else{var s=_(e.clientX,e.clientY),l=A.hitTest(t,s[0],s[1]);l&&"axis"===l.type&&l.encoding?G.dispatch(m({axis:l.id,visible:!0})):G.dispatch(m({visible:!1}));var o=A.inMarkHitTest(t,s[0],s[1],4);G.dispatch(v(o?o.id:null))}}(t,e.scene);break;case"Line":!function(e,t){if(Ye){Fe=!0;var a,i,n=_(e.clientX,e.clientY);if(e.shiftKey){var c=180*Math.atan2(n[1]-ke,n[0]-Se)/Math.PI,r=45*Math.round(c/45)*Math.PI/180,s=Math.sqrt(Math.pow(n[1]-ke,2)+Math.pow(n[0]-Se,2));a=Se+Math.cos(r)*s,i=ke+Math.sin(r)*s}else a=n[0],i=n[1];E.select("#lineToolUI").style("visibility","visible").attr("x1",Se).attr("y1",ke).attr("x2",a).attr("y2",i)}}(t,e.scene);break;case"Pen":!function(e,t){if(0!==q.length){var a=_(e.clientX,e.clientY),i=q[q.length-1];if(e.shiftKey){var n=180*Math.atan2(a[1]-i[1],a[0]-i[0])/Math.PI,c=45*Math.round(n/45)*Math.PI/180,r=Math.sqrt(Math.pow(a[1]-i[1],2)+Math.pow(a[0]-i[0],2));K=i[0]+Math.cos(c)*r,Z=i[1]+Math.sin(c)*r}else K=a[0],Z=a[1];Math.sqrt(Math.pow(K-q[0][0],2)+Math.pow(Z-q[0][1],2))<2&&q.length>2?E.select("#selectionUI").select("#vertexPreview").attr("x",q[0][0]-5).attr("y",q[0][1]-5).attr("width",10).attr("height",10).style("visibility","visible"):E.select("#selectionUI").select("#vertexPreview").style("visibility","hidden"),Q()}}(t,e.scene)}},onMouseUp:function(t){switch(t.preventDefault(),G.getState().tool.activeTool){case"Select":!function(e,t){if(Ie){var a=_(Math.min(he,e.clientX),Math.min(ye,e.clientY)),i=a[0],n=a[1],c=Math.abs(e.clientX-he),r=Math.abs(e.clientY-ye);G.dispatch(b({left:i,top:n,width:0,height:0}));var s,l={left:i,top:n,width:c,height:r,right:i+c,bottom:n+r},o=A.rectHitTest(t,l).map((function(e){return e.id})),d=Object(D.a)(o);try{for(d.s();!(s=d.n()).done;){var p=s.value,u=t.getItem(p);Pe[u.id]="axis"!==u.type||"y"!==u.channel&&"height"!==u.channel?u.x:u.pathX,Re[u.id]="axis"!==u.type||"x"!==u.channel&&"width"!==u.channel?u.y:u.pathY}}catch(g){d.e(g)}finally{d.f()}G.dispatch(y(o))}else if(!Te)if(null===Be)G.dispatch(y([]));else{var h,f=G.getState().canvas.selected,v=f.indexOf(Be.id)>=0;e.shiftKey&&!v?h=f.concat(Be.id):e.shiftKey&&v?(h=f.filter((function(e){return e!==Be.id})),Pe[Be.id]="axis"!==Be.type||"y"!==Be.channel&&"height"!==Be.channel?Be.x:Be.pathX,Re[Be.id]="axis"!==Be.type||"x"!==Be.channel&&"width"!==Be.channel?Be.y:Be.pathY):h=[Be.id],G.dispatch(y(h))}Ce=!1,Ie=!1,Te=!1,Be=null}(t,e.scene);break;case"Rect":!function(e,t,a,i,n){De=!1;var c=E.select("#rectToolUI");if(c.style("visibility","hidden"),Ne){z(t,a,n);var r=t.mark("rect",{left:parseInt(c.attr("x")),top:parseInt(c.attr("y")),width:parseInt(c.attr("width")),height:parseInt(c.attr("height"))});G.dispatch(S(r.id)),G.dispatch(y([r.id])),i.render(t)}Ne=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack),G.dispatch(R("Select"));break;case"Ellipse":!function(e,t,a,i,n){Le=!1;var c=E.select("#circleToolUI");if(c.style("visibility","hidden"),Ue){z(t,a,n);var r=t.mark("circle",{x:parseInt(c.attr("cx")),y:parseInt(c.attr("cy")),radius:parseInt(c.attr("r")),fillColor:"none"});G.dispatch(S(r.id)),G.dispatch(y([r.id])),i.render(t)}Ue=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack),G.dispatch(R("Select"));break;case"Ring":!function(e,t,a,i,n){Ae=!1;var c=E.select("#ringToolOuterUI");if(c.style("visibility","hidden"),E.select("#ringToolInnerUI").style("visibility","hidden"),ze){z(t,a,n);var r=t.mark("ring",{x:parseInt(c.attr("cx")),y:parseInt(c.attr("cy")),outerRadius:parseInt(c.attr("r")),innerRadius:2*parseInt(c.attr("r"))/3,fillColor:"none"});G.dispatch(S(r.id)),G.dispatch(y([r.id])),i.render(t)}ze=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack),G.dispatch(R("Select"));break;case"Line":!function(e,t,a,i,n){Ye=!1;var c=E.select("#lineToolUI");if(c.style("visibility","hidden"),Fe){z(t,a,n);var r=t.mark("line",{x1:parseInt(c.attr("x1")),y1:parseInt(c.attr("y1")),x2:parseInt(c.attr("x2")),y2:parseInt(c.attr("y2"))});G.dispatch(S(r.id)),G.dispatch(y([r.id])),i.render(t)}Fe=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack),G.dispatch(R("Select"));break;case"DirectSelect":!function(e,t,a){if(Ee){var i=_(Math.min(fe,e.clientX),Math.min(ve,e.clientY)),n=i[0],c=i[1],r=Math.abs(e.clientX-fe),s=Math.abs(e.clientY-ve);G.dispatch(b({left:n,top:c,width:0,height:0}));var l={left:n,top:c,width:r,height:s,right:n+r,bottom:c+s},o=A.inMarkRectHitTest(t,l,2);G.dispatch(f(o?o.id:null)),Ee=!1}else{var d=_(e.clientX,e.clientY),p=A.inMarkHitTest(t,d[0],d[1],4);G.dispatch(f(p?p.id:null))}}(t,e.scene);break;case"Pen":!function(e,t,a,i,n){if(void 0!==K&&void 0!==Z)Math.sqrt(Math.pow(K-q[0][0],2)+Math.pow(Z-q[0][1],2))<2&&q.length>2?(q.push([q[0][0],q[0][1]]),$(t,a,i,n)):(q.push([K,Z]),Q());else{var c=_(e.clientX,e.clientY);q.push([c[0],c[1]])}E.select("#selectionUI").select("#vertexPreview").style("visibility","hidden")}(t,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack);break;case"Text":!function(e,t,a,i,n){var c=_(e.clientX,e.clientY),r=A.hitTest(t,c[0],c[1]);if(!r&&"visible"===E.select("#textElement").style("visibility"))return E.select("#textElement").style("visibility","hidden"),void i.render(t);r&&"pointText"===r.type||(z(t,a,n),r=t.mark("text",{x:e.clientX,y:e.clientY,text:"",anchor:["left","top"]}),G.dispatch(S(r.id)),i.render(t)),E.select("#textElement").style("visibility","visible").style("left",r.bounds.left+"px").style("top",r.bounds.top-1+"px").property("value",r.text).style("font-family",r.fontFamily).style("font-size",r.fontSize+"px").style("font-weight",r.fontWeight).style("height",r.bounds.height).on("input",(function(e){r.text=E.select("#textElement").property("value")})),document.getElementById("textElement").focus()}(t,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack),G.dispatch(R("Select"))}},children:[Object(ee.jsx)(we,{scene:e.scene,renderer:e.renderer}),Object(ee.jsx)("rect",{id:"rectToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}}),Object(ee.jsx)("circle",{id:"circleToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}}),Object(ee.jsx)("line",{id:"lineToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden"}}),Object(ee.jsx)("path",{id:"polylineToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden"}}),Object(ee.jsx)("circle",{id:"ringToolOuterUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}}),Object(ee.jsx)("circle",{id:"ringToolInnerUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}})]})}a(192);var He=a(313),We=a(140),Xe=a(103),_e=["Select","DirectSelect","Line","Rect","Ellipse","Ring","Pen","Text"],Je=["Align Top","Align Middle","Align Bottom","Align Left","Align Center","Align Right"],qe=A.renderer("svg","preview"),Ke=A.scene(),Ze=function(e,t){var a={};if(!e)return a;if(e.dataScope)a[e.dataScope.dataTable.id]=e.dataScope.dataTable;else{var i,n=Object(D.a)(t);try{for(n.s();!(i=n.n()).done;){var c=i.value;a[c.id]=c}}catch(r){n.e(r)}finally{n.f()}}return a},Qe=function(e,t){if("Divide"===t)switch(e){default:return["horizontal","vertical"];case"circle":return["angular","radial"];case"ring":return["angular"];case"pie":return["radial"]}else if("Densify"===t)return["horizontal","vertical"]};var $e=Object(d.b)((function(e){return{activeTool:e.tool.activeTool,selected:e.canvas.selected,undoStackChanged:e.canvas.undoStackChanged,redoStackChanged:e.canvas.redoStackChanged}}))((function(e){var t=Object(d.c)(),a=Object(i.useRef)(null),n=Object(i.useState)(!1),c=Object(o.a)(n,2),r=c[0],s=c[1],l=Object(i.useState)(null),p=Object(o.a)(l,2),u=p[0],h=p[1],v=Object(i.useState)({}),b=Object(o.a)(v,2),x=b[0],m=b[1],j=Object(i.useState)([]),S=Object(o.a)(j,2),k=S[0],I=S[1],T=Object(i.useState)([]),B=Object(o.a)(T,2),P=B[0],M=B[1],N=Object(i.useState)(""),L=Object(o.a)(N,2),U=L[0],Y=L[1],F=function(a){switch(E.select("#textElement").style("visibility","hidden"),e.renderer.render(e.scene),a){case"Rect":case"Ellipse":case"Line":case"Ring":case"Pen":t(f(null)),t(y([]));break;case"Select":E.select("#evtLayer").style("cursor","default"),t(f(null));break;case"DirectSelect":t(y([]))}t(R(a))},V=function(){if(!E.select("#preview").empty()){Ke.clear();var t=e.scene.getItem(e.selected[0]),a=x[E.select("#datasetSelect").property("value")],i=E.select("#fieldSelect").property("value");if(t&&u&&i&&a){var n=t.duplicate();if("none"===n.fillColor&&(n.fillColor="#f5f5f5"),n.strokeColor="#222",Ke.addChild(n),"Repeat"===u){if(e.selected.length>1){var c=e.selected.map((function(t){return e.scene.getItem(t)})).map((function(e){return e.duplicate()}));n=Ke.glyph.apply(Ke,Object(ne.a)(c))}var r=Ke.repeat(n,a,{field:i,layout:X(n,a.getUniqueFieldValues(i).length)}),s=[r.bounds.left-2,r.bounds.top-2,r.bounds.width+4,r.bounds.height+4].join(" ");E.select("#preview").attr("viewBox",s)}else if("Divide"===u){n.strokeWidth=Math.max(n.strokeWidth,1);var l=E.select("#orientationSelect").property("value"),o=Ke.divide(n,a,{field:i,orientation:l}),d=[o.bounds.left-2,o.bounds.top-2,o.bounds.width+4,o.bounds.height+4].join(" ");E.select("#preview").attr("viewBox",d)}else if("Densify"===u){n.strokeWidth=Math.max(n.strokeWidth,1);var p=E.select("#orientationSelect").property("value"),h=Ke.densify(n,a,{field:i,orientation:p});Ke.setProperties(h,{vxShape:"rect",vxWidth:4,vxHeight:4,vxStrokeColor:"#1592e6",vxStrokeWidth:1});var y=[h.bounds.left-2,h.bounds.top-2,h.bounds.width+4,h.bounds.height+4].join(" ");E.select("#preview").attr("viewBox",y)}else if("Classify"===u){n.strokeWidth=Math.max(n.strokeWidth,1),Ke.classify(n,{field:i});var f=X(n.firstChild.firstChild,Math.max.apply(Math,Object(ne.a)(n.children.map((function(e){return e.children.length})))));Ke.setProperties(n.firstChild,{layout:f});var v=X(n.firstChild,n.children.length);Ke.setProperties(n,{layout:v});var b=[n.bounds.left-2,n.bounds.top-2,n.bounds.width+4,n.bounds.height+4].join(" ");E.select("#preview").attr("viewBox",b)}qe.clear(),qe.render(Ke)}}},H=function(){if(0!==e.selected.length&&u){var t,a=e.scene.getItem(e.selected[0]),i=x[E.select("#datasetSelect").property("value")],n=E.select("#fieldSelect").property("value"),c=i.getUniqueFieldValues(n),r="";if(t=a.dataScope?a.dataScope.getUniqueFieldValues(n).length:c.length,"Repeat"===u)r=[t,e.selected.length>1?"glyphs":a.type+"s","will be created,"].join(" ");else if("Divide"===u)r=["Divide the",a.type,"into",t,"parts,"].join(" ");else if("Densify"===u){if("rect"===a.type)r=["Densify the","horizontal"===E.select("#orientationSelect").property("value")?"top/bottom side":"left/right side","of the rect with",t,"vertices,"].join(" ");else r=["Densify the",a.type,"with",t,"vertices, one for each"].join(" ")}else"Classify"===u&&(r=["Group the",a.children.length,a.firstChild.type+"s","into",t,"collections"].join(" "));E.select("#msg").text(r)}else Y("")};return Object(i.useEffect)((function(){switch(E.selectAll(".iconBtn").classed("active",!1),E.select("#"+e.activeTool+"Btn").classed("active",!0),e.activeTool){case"Rect":case"Ellipse":case"Line":case"Ring":case"Pen":E.select("#evtLayer").style("cursor","crosshair");break;default:E.select("#evtLayer").style("cursor","default")}}),[e.activeTool]),Object(i.useEffect)((function(){var e=document.getElementById("fieldSelect");if(e){var t=new CustomEvent("change",{bubbles:!0,cancelable:!1});e.dispatchEvent(t)}}),[k]),Object(i.useEffect)((function(){var t={"#repeatBtn":!1,"#divideBtn":!1,"#densifyBtn":!1,"#classifyBtn":!1,".alignBtn":!1};if(0===e.selected.length||0===e.datasets.length)for(var a in t)t[a]=!0;else{var i=e.selected.map((function(t){return e.scene.getItem(t)}));i.length>1?(t["#divideBtn"]=!0,t["#densifyBtn"]=!0,t["#classifyBtn"]=!0):(t["#repeatBtn"]=!Object(A.canRepeat)(i),t["#divideBtn"]=!Object(A.canDivide)(i[0]),t["#densifyBtn"]=!Object(A.canDensify)(i[0]),t["#classifyBtn"]=!Object(A.canClassify)(i[0]),t[".alignBtn"]=!function(e,t){if(e.length<2)return!1;var a,i=Object(D.a)(e);try{for(i.s();!(a=i.n()).done;)if(a.value.parent!==t)return!1}catch(n){i.e(n)}finally{i.f()}return!0}(i,e.scene))}for(var n in t)E.selectAll(n).property("disabled",t[n])}),[e.selected,e.scene,e.datasets]),Object(i.useEffect)((function(){E.select("#undoBtn").property("disabled",e.undoStackChanged.length<=0)}),[e.undoStackChanged]),Object(i.useEffect)((function(){E.select("#redoBtn").property("disabled",e.redoStackChanged.length<=0)}),[e.redoStackChanged]),Object(i.useEffect)((function(){E.select("#undoBtn").property("disabled",e.undoStack.length<=0),E.select("#redoBtn").property("disabled",e.redoStack.length<=0)}),[e.undoStack,e.redoStack]),Object(ee.jsxs)("div",{children:[Object(ee.jsxs)("div",{className:"myToolBar",children:[Object(ee.jsxs)("div",{className:"myBtnGroup",children:[Object(ee.jsx)("button",{className:"myTextBtn",id:"openBtn",onClick:function(e){a.current.click()},children:"Open"},"open"),Object(ee.jsx)("input",{type:"file",id:"scnFile",ref:a,style:{display:"none"},accept:".msc",onChange:function(t){t.stopPropagation(),t.preventDefault();var a=t.target.files[0],i=new FileReader;i.onload=function(){e.loadScene(JSON.parse(i.result)),e.resetStacks()},i.readAsText(a)}}),Object(ee.jsx)("button",{className:"myTextBtn",id:"saveBtn",onClick:function(t){var a=e.scene.getDataTables(),i=Object.values(a).length>0?Object.values(a)[0].name+".msc":"visualization.msc",n=JSON.stringify(e.scene.toJSON());Object(Xe.saveAs)(new Blob([n],{type:"text/plain;charset=utf-8"}),i)},children:"Save"},"save"),Object(ee.jsx)("button",{className:"myTextBtn",id:"exportBtn",onClick:function(t){var a=document.getElementById("canvas"),i=(new XMLSerializer).serializeToString(a);i.match(/^<svg[^>]+xmlns="http:\/\/www\.w3\.org\/2000\/svg"/)||(i=i.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),i.match(/^<svg[^>]+"http:\/\/www\.w3\.org\/1999\/xlink"/)||(i=i.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),i='<?xml version="1.0" standalone="no"?>\r\n'+i;var n=e.scene.getDataTables(),c=Object.values(n).length>0?Object.values(n)[0].name+".svg":"visualization.svg";Object(Xe.saveAs)(new Blob([i],{type:"text/plain;charset=utf-8"}),c)},children:"Export"},"export")]}),Object(ee.jsxs)("div",{className:"myBtnGroup",children:[Object(ee.jsx)("button",{className:"myTextBtn",id:"undoBtn",onClick:function(t){if(0!==e.undoStack.length){z(e.scene,e.datasets,e.redoStack,"redo");var a=e.undoStack.pop();e.loadScene(JSON.parse(a)),G.dispatch(w({length:e.undoStack.length}))}},children:"Undo"},"undo"),Object(ee.jsx)("button",{className:"myTextBtn",id:"redoBtn",onClick:function(t){if(0!==e.redoStack.length){z(e.scene,e.datasets,e.undoStack);var a=e.redoStack.pop();e.loadScene(JSON.parse(a)),G.dispatch(C({length:e.redoStack.length}))}},children:"Redo"},"redo")]}),Object(ee.jsx)("div",{className:"myBtnGroup",children:_e.map((function(e){return Object(ee.jsx)("button",{className:"iconBtn",title:e,id:e+"Btn",tool:e,onClick:function(e){return F(e.target.getAttribute("tool"))}},e)}))}),Object(ee.jsxs)("div",{className:"myBtnGroup",children:[Object(ee.jsx)("button",{className:"myTextBtn",id:"repeatBtn",onClick:function(t){if(F("Select"),0!==e.selected.length){h("Repeat"),s(!0);var a=e.scene.getItem(e.selected[0]),i=Ze(a,e.datasets);m(i);var n=a.firstChild&&a.firstChild.dataScope?a.firstChild.dataScope.fields:[],c=i[Object.keys(i)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),I(c)}},children:"Repeat"},"repeat"),Object(ee.jsx)("button",{className:"myTextBtn",id:"divideBtn",onClick:function(t){if(F("Select"),0!==e.selected.length){h("Divide"),s(!0);var a=e.scene.getItem(e.selected[0]);M(Qe(a.type,"Divide"));var i=Ze(a,e.datasets);m(i);var n=a.dataScope?a.dataScope.fields:[],c=i[Object.keys(i)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),I(c)}},children:"Divide"},"divide"),Object(ee.jsx)("button",{className:"myTextBtn",id:"densifyBtn",onClick:function(t){if(F("Select"),0!==e.selected.length){h("Densify"),s(!0);var a=e.scene.getItem(e.selected[0]);M(Qe(a.type,"Densify"));var i=Ze(a,e.datasets);m(i);var n=a.dataScope?a.dataScope.fields:[],c=i[Object.keys(i)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),I(c)}},children:"Densify"},"densify"),Object(ee.jsx)("button",{className:"myTextBtn",id:"classifyBtn",onClick:function(t){if(F("Select"),0!==e.selected.length){h("Classify"),s(!0);var a=e.scene.getItem(e.selected[0]),i=Ze(a,e.datasets);m(i);var n=a.dataScope?a.dataScope.fields:[],c=i[Object.keys(i)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),I(c)}},children:"Classify"},"classify")]}),Object(ee.jsx)("div",{className:"myBtnGroup",children:Je.map((function(t){return Object(ee.jsx)("button",{className:"alignBtn",dir:t.split(" ")[1].toLowerCase(),title:t,id:t.replace(" ","")+"Btn",onClick:function(t){return function(t){var a,i=e.selected.map((function(t){return e.scene.getItem(t)}));switch(t){case"bottom":case"right":a=Math.max.apply(Math,Object(ne.a)(i.map((function(e){return e.bounds[t]}))));break;case"center":case"middle":a=E.mean(i.map((function(e){return e.bounds[t]})));break;default:a=Math.min.apply(Math,Object(ne.a)(i.map((function(e){return e.bounds[t]}))))}["top","middle","bottom"].indexOf(t)>=0?i.forEach((function(i){return e.scene.translate(i,0,a-i.bounds[t])})):i.forEach((function(i){return e.scene.translate(i,a-i.bounds[t],0)})),G.dispatch(g({id:i[0].id,type:i[0].type,properties:{x:i[0].x,y:i[0].y}})),e.renderer.render(e.scene)}(t.target.getAttribute("dir"))}},t.replace(" ",""))}))})]}),Object(ee.jsxs)(He.a,{show:r,onShow:function(e){V(),H()},backdrop:"static",keyboard:!1,children:[Object(ee.jsx)(He.a.Header,{children:Object(ee.jsx)(He.a.Title,{children:u})}),Object(ee.jsxs)(He.a.Body,{children:[Object(ee.jsxs)("div",{style:{clear:"both",marginBottom:"10px"},children:[Object(ee.jsx)("div",{id:"msg",style:{clear:"both",marginBottom:"7px",display:"block"},children:U}),"one for each ",Object(ee.jsx)("select",{id:"fieldSelect",onChange:function(e){V(),H()},style:{marginLeft:"8px"},children:k.map((function(e){return Object(ee.jsx)("option",{value:e,children:"atlas_rowId"===e?"row of data":e},e)}))}),Object(ee.jsxs)("div",{style:{marginTop:"12px",clear:"left"},children:["from dataset",Object(ee.jsx)("select",{id:"datasetSelect",onChange:function(e){I(x[e.target.value].nonNumericFields.concat(["atlas_rowId"]))},style:{marginLeft:"7px"},children:Object.values(x).map((function(e){return Object(ee.jsx)("option",{value:e.id,children:e.name},e.id)}))})]}),Object(ee.jsxs)("div",{style:{marginTop:"15px",display:"Repeat"===u||"Classify"===u||"Densify"===u&&e.selected[0]&&"rect"!==e.scene.getItem(e.selected[0]).type?"none":"block"},children:["Orientation",Object(ee.jsx)("select",{id:"orientationSelect",onChange:function(e){V()},style:{marginLeft:"7px"},children:P.map((function(e){return Object(ee.jsx)("option",{value:e,children:e},e)}))})]})]}),Object(ee.jsx)("svg",{id:"preview",style:{width:"470px",height:"180px",border:"solid 0px #ddd",padding:"5px"}})]}),Object(ee.jsxs)(He.a.Footer,{children:[Object(ee.jsx)(We.a,{variant:"secondary",onClick:function(e){s(!1)},children:"Cancel"}),Object(ee.jsx)(We.a,{variant:"primary",onClick:function(){if(s(!1),z(e.scene,e.datasets,e.undoStack),"Repeat"===u){var t=e.scene.getItem(e.selected[0]);if(e.selected.length>1){var a,i=e.selected.map((function(t){return e.scene.getItem(t)}));t=(a=e.scene).glyph.apply(a,Object(ne.a)(i))}G.dispatch(y([]));var n=x[E.select("#datasetSelect").property("value")],c=E.select("#fieldSelect").property("value"),r=X(t,n.getUniqueFieldValues(c).length),l=e.scene.repeat(t,n,{field:c,layout:r});l.children.length<25&&(1===r.numCols?e.scene.axis("y",c,{item:t}):1===r.numRows&&e.scene.axis("x",c,{item:t})),e.scene.reCreateRelatedAxes(l),G.dispatch(y([l.id])),G.dispatch(O({}))}else if("Divide"===u){var o=e.scene.getItem(e.selected[0]);G.dispatch(y([]));var d=x[E.select("#datasetSelect").property("value")],p=E.select("#fieldSelect").property("value"),h=E.select("#orientationSelect").property("value"),f=e.scene.divide(o,d,{field:p,orientation:h});"rect"===f.firstChild.type&&f.layout&&"scene"===f.parent.type&&("vertical"===f.layout.orientation?e.scene.axis("y",p,{item:f.firstChild}):"horizontal"===f.layout.orientation&&e.scene.axis("x",p,{item:f.firstChild})),e.scene.reCreateRelatedAxes(f),G.dispatch(y([f.id])),G.dispatch(O({}))}else if("Densify"===u){var v=e.scene.getItem(e.selected[0]);G.dispatch(y([]));var b=x[E.select("#datasetSelect").property("value")],g=E.select("#fieldSelect").property("value"),m=E.select("#orientationSelect").property("value"),j=e.scene.densify(v,b,{field:g,orientation:m});G.dispatch(y([j.id])),G.dispatch(O({}))}else if("Classify"===u){var S=e.scene.getItem(e.selected[0]);G.dispatch(y([]));var k=E.select("#fieldSelect").property("value");e.scene.classify(S,{field:k});var w=X(S.firstChild.firstChild,Math.max.apply(Math,Object(ne.a)(S.children.map((function(e){return e.children.length})))));e.scene.setProperties(S.firstChild,{layout:w});var C=X(S.firstChild,S.children.length);e.scene.setProperties(S,{layout:C}),S.children.length<25&&e.scene.axis("y",k,{item:S.firstChild}),G.dispatch(y([S.id])),G.dispatch(O({}))}},children:"OK"})]})]})]})})),et=(a(193),a(78)),tt=a(312),at=a(314),it=a(315),nt={};for(var ct in N){var rt=[];for(var st in N[ct]){var lt,ot=Object(D.a)(N[ct][st].class);try{for(ot.s();!(lt=ot.n()).done;){var dt=lt.value;rt.indexOf(dt)<0&&rt.push(dt)}}catch(Rt){ot.e(Rt)}finally{ot.f()}}nt[ct]=rt}var pt=function(e,t,a){if(E.select("#"+e.id).style("padding-left","3px"),E.select("#"+e.id+"ScaleBtn").style("display","none"),e.accessor){var i,n=t,c=Object(D.a)(e.accessor);try{for(c.s();!(i=c.n()).done;){n=n[i.value]}}catch(Rt){c.e(Rt)}finally{c.f()}"numeric"===e.type&&(n=n.toFixed(1)),"vxShape"!==e.id||n||(n="none"),"color"===e.type?E.select("#"+e.id).style("background",n).property("value",n):"boolean"===e.type?E.select("#"+e.id).property("checked",n):E.select("#"+e.id).property("value",n).property("disabled","area"===e.channel)}if(e.channel){var r;r="width"===e.channel||"height"===e.channel||"area"===e.channel||"radius"===e.channel?a.sizeBound(t,e.channel):"x"===e.channel||"y"===e.channel?a.positionBound(t,e.channel):a.getEncodingByItem(t,e.channel);var s="segment"===t.type?t.parent.dataScope:"vertex"===t.type&&t.parent.dataScope||t.dataScope;if(r)if(r.channel===e.channel){E.select("#"+e.id).property("value",r.field).property("disabled",!0).style("pointer-events","none"),E.select("#"+e.id+"UnencodeBtn").style("display","inline-block").on("click",(function(e){a.removeEncoding(r);var i={};i[r.channel]=!0,G.dispatch(g({id:t.id,type:t.type,properties:i}))})),E.select("#"+e.id+"EncodeBtn").style("display","none"),("numeric"===e.type&&["linear","sqrt","log","power"].indexOf(r.scale.type)>=0||"color"===e.type&&["sequentialColor","divergingColor"].indexOf(r.scale.type)>=0)&&(E.select("#"+e.id).style("padding-left","23px"),E.select("#"+e.id+"ScaleBtn").style("display","inline-block"))}else{var l="vertex"===r.anyItem.type||"segment"===r.anyItem.type?"[see "+r.anyItem.type+"]":"[see "+r.channel+"]";E.select("#"+e.id).property("value",l).property("disabled",!0).style("pointer-events","none"),E.select("#"+e.id+"UnencodeBtn").style("display","none"),E.select("#"+e.id+"EncodeBtn").style("display","none")}else if(s){var o="Segment Position"===e.group||"Vertex Position"===e.group;E.select("#"+e.id).property("disabled",o).style("pointer-events","all"),E.select("#"+e.id+"UnencodeBtn").style("display","none"),E.select("#"+e.id+"EncodeBtn").style("display","inline-block")}else{var d="Segment Position"===e.group||"Vertex Position"===e.group;E.select("#"+e.id).property("disabled",d).style("pointer-events","all"),E.select("#"+e.id+"UnencodeBtn").style("display","none"),E.select("#"+e.id+"EncodeBtn").style("display","none")}}if("layoutType"===e.id){var p=t.layout?t.layout.type:"none";E.select("#"+e.id).property("value",p),E.selectAll(".layout-prop").style("display","none"),E.selectAll("."+p+"-prop").style("display","inline-block");var u=E.select("#"+e.id).selectAll("option"),h=t.firstChild.type,y=[];"rect"===h?(y.push("packing"),a.getEncodingByItem(t.firstChild,"area")||y.push("treemap")):"circle"===h?y.push("treemap"):"collection"===h&&(y=y.concat(["packing","treemap"])),u.property("disabled",(function(e,t){var a=E.select(this).property("value");return y.indexOf(a)>=0}));var f,v=e.options.filter((function(e){return e.value===p}))[0].parameters,b=Object(D.a)(v);try{for(b.s();!(f=b.n()).done;){var x=f.value,m=N.Layout[x],j=t.layout[m.accessor[0]];"numeric-integer"===m.type?j=j.toFixed(0):"numeric"===m.type&&(j=j.toFixed(1)),E.select("#"+m.id).property("value",j),E.select("#"+m.id+"ScaleBtn").style("display","none")}}catch(Rt){b.e(Rt)}finally{b.f()}}if("childrenOrder"===e.id&&(E.select("#"+e.id).selectAll("option").remove(),t.dataScope)){var O=t.dataScope.dataTable.fields;E.select("#"+e.id).selectAll("option").data(O).enter().append("option").property("value",(function(e){return e})).text((function(e){return"atlas_rowId"===e?"default":e})),E.select("#"+e.id).property("value",t.childrenOrder.field)}if("axisOrientation"===e.id){var S=E.select("#"+e.id).selectAll("option");"x"===t.channel||"width"===t.channel?S.property("disabled",(function(e,t){var a=E.select(this).property("value");return"top"!==a&&"bottom"!==a})):"y"===t.channel||"height"===t.channel?S.property("disabled",(function(e,t){var a=E.select(this).property("value");return"left"!==a&&"right"!==a})):S.property("disabled",!0)}if("includeZero"===e.id&&("y"!==t.channel?E.select("#"+e.id+"_row").style("display","none"):E.select("#"+e.id+"_row").style("display","inline-block")),"baseline"===e.id){var k=E.select("#"+e.id).selectAll("option"),w=t.orientation;"horizontal"===w?k.property("disabled",(function(e,t){var a=E.select(this).property("value");return"top"!==a&&"middle"!==a&&"bottom"!==a})):"vertical"===w?k.property("disabled",(function(e,t){var a=E.select(this).property("value");return"left"!==a&&"center"!==a&&"right"!==a})):k.property("disabled",!0)}"vxShape"===e.id&&ut()},ut=function(){var e=E.select("#vxShape").property("value");"rect"===e?(E.select("#vxRadius_row").style("display","none"),E.select("#vxWidth_row").style("display","inline-block"),E.select("#vxHeight_row").style("display","inline-block")):"circle"===e?(E.select("#vxRadius_row").style("display","inline-block"),E.select("#vxWidth_row").style("display","none"),E.select("#vxHeight_row").style("display","none")):(E.select("#vxRadius_row").style("display","none"),E.select("#vxWidth_row").style("display","none"),E.select("#vxHeight_row").style("display","none"))};var ht=Object(d.b)((function(e){return{selected:e.canvas.selected,directSelected:e.canvas.directSelected,itemUpdated:e.canvas.itemUpdated}}))((function(e){var t=Object(i.useState)("#fff"),a=Object(o.a)(t,2),c=a[0],r=a[1],s=Object(i.useState)(null),l=Object(o.a)(s,2),d=l[0],p=l[1],u=Object(i.useState)(null),h=Object(o.a)(u,2),y=h[0],f=h[1],v=Object(i.useState)({}),b=Object(o.a)(v,2),x=b[0],j=b[1];Object(i.useEffect)((function(){j({})}),[e.scene]),Object(i.useEffect)((function(){if(null!==d){var t="canvasFillColor"===d.id?e.scene:e.selected.length>0?e.scene.getItem(e.selected[0]):e.directSelected?e.scene.getItem(e.directSelected):null;if(null!==t){var a=t[d.accessor];r(a||"#fff"),E.select("#colorPicker").style("display","block")}}else E.select("#colorPicker").style("display","none")}),[d,e.scene,e.selected,e.directSelected]),Object(i.useEffect)((function(){if(null!==d){if(E.select("#"+d.id).style("background",c).property("value",c),"canvasFillColor"===d.id)e.scene[d.accessor]=c;else if(e.selected.length>0){var t=e.scene.getItem(e.selected[0]);if("axis"===t.type||"gridlines"===t.type||"legend"===t.type)t[d.accessor]=c;else{var a={};a[d.accessor]=c,e.scene.setProperties(t,a)}}else if(e.directSelected){var i=e.scene.getItem(e.directSelected),n={};n[d.accessor]=c,e.scene.setProperties(i,n)}e.renderer.render(e.scene)}}),[c,d,e.scene,e.selected,e.directSelected,e.renderer]),Object(i.useEffect)((function(){if(e.itemUpdated.id&&"inspector"!==e.itemUpdated.source){var t=e.scene.getItem(e.itemUpdated.id);if(void 0!==t)for(var a in e.itemUpdated.properties){var i=J(t.type,a);i&&pt(i,t,e.scene)}}}),[e.scene,e.itemUpdated]),Object(i.useEffect)((function(){var t,a=e.selected.length>0?e.scene.getItem(e.selected[0]):void 0;if(a){t=a.type;var i=e.scene.getItem(e.selected[0]);i.dataScope?f(i.dataScope.dataTable):f(null)}else t="canvas",a=e.scene,f(null);var n=E.select(".propertyPanel");if(n.selectAll(".propertyGroupHeader").style("display","none"),n.selectAll(".propertyRow").style("display","none"),a)for(var c in n.selectAll("."+t+"-prop").style("display","inline-block"),N)for(var r in N[c])N[c][r].class.indexOf(t+"-prop")>=0&&pt(N[c][r],a,e.scene)}),[e.scene,e.selected]),Object(i.useEffect)((function(){if(e.directSelected){var t=e.scene.getItem(e.directSelected);t.dataScope?f(t.dataScope.dataTable):t.parent.dataScope?f(t.parent.dataScope.dataTable):f(null)}else f(null);var a=E.select(".propertyPanel");if(a.selectAll(".propertyGroupHeader").style("display","none"),a.selectAll(".propertyRow").style("display","none"),e.directSelected){var i=e.scene.getItem(e.directSelected),n=i.type;for(var c in a.selectAll("."+n+"-prop").style("display","inline-block"),N)for(var r in N[c])N[c][r].class.indexOf(n+"-prop")>=0&&pt(N[c][r],i,e.scene)}}),[e.scene,e.directSelected]);var O=function(t){var a=E.select("#"+t.id);if(!a.empty()){var i=a.property("value"),n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);if(void 0!==n){z(e.scene,e.datasets,e.undoStack);var c={};switch(t.id){case"axisOrientation":case"legendOrientation":n[t.accessor[0]]=i,c[t.accessor[0]]=i;break;case"orientation":case"horzGravity":case"vertGravity":case"direction":c[t.accessor[0]]=i,e.scene.setProperties(n.layout,c);break;case"layoutType":var r;c.layout=i,n.id in x||(x[n.id]=[]),x[n.id].unshift(n.layout),x[n.id].length>0&&(r=x[n.id].find((function(e){return e&&e.type===i}))),r||(r=function(e){switch(e){case"stack":return A.layout("stack",{orientation:"vertical"});case"packing":return A.layout("packing");case"none":return;default:return A.layout("grid",{numRows:1})}}(i)),e.scene.setProperties(n,{layout:r}),pt(t,n,e.scene);break;case"vxShape":c[t.accessor[0]]=i,e.scene.setProperties(n,c),ut();break;case"childrenOrder":var s=E.select("#childrenOrderDirBtn").property("checked")?"desc":"asc";c[t.accessor[0]]={field:i,direction:s},e.scene.setProperties(n,c);break;default:c[t.accessor[0]]=i,e.scene.setProperties(n,c)}G.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}},k=function(t){var a=E.select("#"+t.id);if(!a.empty()){var i=parseFloat(a.property("value"));if(!isNaN(i)&&!("rowGap"!==t.id&&"colGap"!==t.id&&"labelRotation"!==t.id&&i<0)){"numeric-integer"===t.type&&(i=parseInt(i));var n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);z(e.scene,e.datasets,e.undoStack);var c={};switch(t.id){case"strokeWidth":case"width":case"height":case"area":case"fontSize":case"vxWidth":case"vxHeight":case"vxRadius":case"vxOpacity":case"vxStrokeWidth":case"opacity":case"radius":case"innerRadius":case"outerRadius":c[t.channel]=i,e.scene.setProperties(n,c);break;case"rowGap":case"colGap":case"numRows":case"numCols":n.layout&&(c[t.id]=i,e.scene.setProperties(n.layout,c));break;case"tickOffset":case"labelOffset":case"labelRotation":case"tickSize":case"pathPos":case"gridlineStrokeWidth":c[t.accessor[0]]=i,n[t.accessor[0]]=i;break;case"x":case"collectionX":case"glyphX":e.scene.translate(n,i-n.x,0);break;case"y":case"collectionY":case"glyphY":e.scene.translate(n,0,i-n.y)}G.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}},w=function(t,a,i){var n;if(e.selected.length>=1?n=e.scene.getItem(e.selected[0]):e.directSelected&&(n=e.scene.getItem(e.directSelected)),n){if(z(e.scene,e.datasets,e.undoStack),("x"===a||"y"===a)&&"collection"===n.parent.type&&n.parent.layout)if("grid"===n.parent.layout.type)("x"===a&&n.parent.layout.numCols>1||"y"===a&&n.parent.layout.numRows>1)&&e.scene.setProperties(n.parent,{layout:void 0});else e.scene.setProperties(n.parent,{layout:void 0});var c;if(e.scene.encode(n,{field:t,channel:a,scale:i}),i){if("vertex"===n.type&&["path","line"].indexOf(n.parent.type)>=0){var r=n.parent,s=Math.abs((r.firstVertex.y-r.lastVertex.y+1)/(r.firstVertex.x-r.lastVertex.x+1));(s<1&&"y"===a||s>1&&"x"===a)&&(c=e.scene.axis(a,t,{item:n}))}}else a.indexOf("Color")>0?c=e.scene.legend(a,t):"width"!==a&&"height"!==a&&"x"!==a&&"y"!==a||(c=e.scene.axis(a,t,{item:n}));e.scene.reCreateRelatedAxes(n);var l={};l[a]="encoded",G.dispatch(g({id:n.id,type:n.type,properties:l})),c&&G.dispatch(S(c.id))}},C=function(t,a){var i,n=Object(D.a)(e.scene.children);try{for(n.s();!(i=n.n()).done;){var c=i.value;if("axis"===c.type&&c.encoding&&c.encoding.scale===t)return void G.dispatch(m({axis:c.id,visible:a}))}}catch(Rt){n.e(Rt)}finally{n.f()}},I=function(e){return Object(ee.jsx)("input",{id:e.id,onChange:function(t){return k(e)}})},T=function(t){return Object(ee.jsx)("input",{type:"text",id:t.id,onInput:function(a){return function(t){var a=E.select("#"+t.id);if(!a.empty()){var i=a.property("value"),n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);z(e.scene,e.datasets,e.undoStack);var c={};"labelFormat"===t.id&&(c[t.accessor[0]]=i,n[t.accessor[0]]=i),G.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}(t)}})},B=function(t){return Object(ee.jsx)("input",{type:"checkbox",id:t.id,onChange:function(a){return function(t){var a=E.select("#"+t.id);if(!a.empty()){z(e.scene,e.datasets,e.undoStack);var i=a.property("checked"),n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);n[t.accessor[0]]=i;var c={};c[t.accessor[0]]=i,G.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}(t)}})},P=n.a.forwardRef((function(e,t){var a=e.children,i=e.onClick;return Object(ee.jsx)("button",{className:"dropdown-item dropdown-toggle encodeFields",href:"",ref:t,onClick:function(e){e.preventDefault(),i(e)},children:"  "+a})})),R=function(t,a){var i="propertyRow "+a.class.join(" ");return Object(ee.jsxs)("tr",{className:i,id:a.id+"_row",children:[Object(ee.jsx)("td",{className:"propertyName",children:t}),Object(ee.jsxs)("td",{className:"propertyInput",children:[Object(ee.jsxs)(tt.a,{id:a.id+"ScaleBtn",className:"scaleBtnDiv",children:[Object(ee.jsx)(tt.a.Toggle,{className:"scaleBtn",variant:"link",bsPrefix:"p-0"}),Object(ee.jsx)(tt.a.Menu,{className:"scaleMenu",children:Object(ee.jsx)("div",{children:Object(ee.jsxs)(at.a,{children:[Object(ee.jsx)(at.a.Group,{style:{margin:"0 10px 0 10px",display:t.indexOf("Color")<0?"block":"none"},children:Object(ee.jsxs)(it.a,{direction:"horizontal",gap:1,children:[Object(ee.jsx)(at.a.Label,{className:"scaleMenuLabel",children:"Scale type"}),Object(ee.jsxs)(at.a.Select,{value:H(a.channel,e.selected,e.directSelected,e.scene)?H(a.channel,e.selected,e.directSelected,e.scene):"",onChange:function(t){return function(t,a){var i;if(e.selected.length>=1?i=e.scene.getItem(e.selected[0]):e.directSelected&&(i=e.scene.getItem(e.directSelected)),i){z(e.scene,e.datasets,e.undoStack);var n=e.scene.getEncodingByItem(i,t);if(n){n.scale.type=a,e.scene.reCreateRelatedAxes(i);var c={};c[t]="scaleType",G.dispatch(g({id:i.id,type:i.type,properties:c}))}}}(a.channel,t.target.value)},size:"sm",children:[Object(ee.jsx)("option",{value:"linear",children:"Linear"}),Object(ee.jsx)("option",{value:"log",children:"Log"}),Object(ee.jsx)("option",{value:"sqrt",children:"Square Root"}),Object(ee.jsx)("option",{value:"power",children:"Power (2)"})]})]})}),Object(ee.jsx)(at.a.Group,{style:{margin:"0 10px 0 10px",display:F(a.channel,e.selected,e.directSelected,e.scene)?"block":"none"},children:Object(ee.jsxs)(it.a,{direction:"horizontal",gap:1,children:[Object(ee.jsx)(at.a.Label,{className:"scaleMenuLabel",children:"Aggregator"}),Object(ee.jsxs)(at.a.Select,{value:F(a.channel,e.selected,e.directSelected,e.scene)?F(a.channel,e.selected,e.directSelected,e.scene):"",onChange:function(t){return function(t,a){var i;if(e.selected.length>=1?i=e.scene.getItem(e.selected[0]):e.directSelected&&(i=e.scene.getItem(e.directSelected)),i){z(e.scene,e.datasets,e.undoStack);var n=e.scene.getEncodingByItem(i,t);if(n){n.aggregator=a,e.scene.reCreateRelatedAxes(i);var c={};c[t]="aggregator",G.dispatch(g({id:i.id,type:i.type,properties:c}))}}}(a.channel,t.target.value)},size:"sm",children:[Object(ee.jsx)("option",{value:"sum",children:"Sum"}),Object(ee.jsx)("option",{value:"mean",children:"Average"}),Object(ee.jsx)("option",{value:"max",children:"Maximum"}),Object(ee.jsx)("option",{value:"min",children:"Minimum"}),Object(ee.jsx)("option",{value:"median",children:"Median"}),Object(ee.jsx)("option",{value:"count",children:"Count"})]})]})}),Object(ee.jsx)(at.a.Group,{style:{margin:"0 10px 0 10px",display:t.indexOf("Color")>0?"block":"none"},children:Object(ee.jsxs)(it.a,{direction:"horizontal",gap:1,children:[Object(ee.jsx)(at.a.Label,{className:"scaleMenuLabel",children:"Color Scheme"}),Object(ee.jsx)(at.a.Select,{value:V(a.channel,e.selected,e.directSelected,e.scene)?V(a.channel,e.selected,e.directSelected,e.scene):"",onChange:function(t){return function(t,a){var i;if(e.selected.length>=1?i=e.scene.getItem(e.selected[0]):e.directSelected&&(i=e.scene.getItem(e.directSelected)),i){z(e.scene,e.datasets,e.undoStack);var n=e.scene.getEncodingByItem(i,t);if(n){n.scale.scheme=a,e.scene.reCreateRelatedLegends(i);var c={};c[t]="scheme",G.dispatch(g({id:i.id,type:i.type,properties:c}))}}}(a.channel,t.target.value)},size:"sm",children:"divergingColor"===H(a.channel,e.selected,e.directSelected,e.scene)?Object.keys(L).map((function(e){return Object(ee.jsx)("option",{value:e,children:L[e]},e)})):Object.keys(U).map((function(e){return Object(ee.jsx)("option",{value:e,children:U[e]},e)}))})]})})]})})})]}),function(){switch(a.type){default:return I(a);case"numeric-range":return e=a,Object(ee.jsxs)("div",{className:"propertySliderDiv",children:[Object(ee.jsx)("input",{type:"range",min:e.range[0],max:e.range[1],step:(e.range[1]-e.range[0])/10,className:"propertySlider",id:e.id,onChange:function(t){return k(e)}}),Object(ee.jsxs)("div",{className:"propertySliderMarks",children:[Object(ee.jsx)("div",{style:{margin:0,float:"left"},children:e.range[0]}),Object(ee.jsx)("div",{style:{margin:0,float:"right"},children:e.range[1]})]})]});case"color":return function(e){return Object(ee.jsx)("input",{id:e.id,onClick:function(t){p(e),t.stopPropagation()}})}(a);case"categorical":return function(e){return Object(ee.jsx)("select",{id:e.id,onChange:function(t){return O(e)},children:e.options.map((function(e){return Object(ee.jsx)("option",{value:e.value,children:e.display},e.display)}))})}(a);case"boolean":return B(a);case"string":return T(a)}var e}()]}),a.encodable?Object(ee.jsxs)("td",{children:[Object(ee.jsx)("button",{className:"unencodeBtn",id:a.id+"UnencodeBtn"}),Object(ee.jsxs)(tt.a,{id:a.id+"EncodeBtn",children:[Object(ee.jsx)(tt.a.Toggle,{className:"encodeBtn",variant:"link",bsPrefix:"p-0"}),Object(ee.jsx)(tt.a.Menu,{children:null===y?[]:y.getEncodableFields(a.channel).map((function(t,i){var n=function(e,t,a){var i={};for(var n in a.encodings){var c=a.encodings[n];for(var r in c){var s=c[r];W(r,t)&&s.dataTable.getFieldType(s.field)===e&&(s.scale.id in i||(i[s.scale.id]=[]),i[s.scale.id].push(s))}}return i}(y.getFieldType(t),a.channel,e.scene);if(0===Object.keys(n).length)return Object(ee.jsx)(tt.a.Item,{className:"encodeFields",onClick:function(e){w(t,a.channel)},children:t},t);var c=[];for(var r in n)c.push({fields:Object(ne.a)(new Set(n[r].map((function(e){return e.field})))).join("/"),scale:n[r][0].scale});return Object(ee.jsxs)(tt.a,{id:a.id+"_scale_"+t,drop:"start",children:[Object(ee.jsx)(tt.a.Toggle,{as:P,bsPrefix:"p-0",children:t}),Object(ee.jsx)(tt.a.Menu,{children:[null].concat(c).map((function(e,i){return null===e?Object(ee.jsx)(tt.a.Item,{className:"encodeFields",onClick:function(e){w(t,a.channel)},children:"Create new scale"},"new"+i):Object(ee.jsx)(tt.a.Item,{className:"encodeFields",onClick:function(i){w(t,a.channel,e.scale)},onMouseEnter:function(t){C(e.scale,!0)},onMouseLeave:function(t){C(e.scale,!1)},children:"Merge with "+e.fields},e.scale.id+"_"+i)}))})]},a.id+"_scale_"+t)}))})]})]}):"childrenOrder"===a.id?Object(ee.jsxs)("td",{children:[Object(ee.jsx)("label",{htmlFor:"childrenOrderDirBtn",children:Object(ee.jsx)("img",{id:"childrenOrderDirBtnImg",src:"/app/icons/asc.png",className:"orderDirBtn",alt:"ascending"})}),Object(ee.jsx)("input",{type:"checkbox",id:"childrenOrderDirBtn",style:{display:"none"},onChange:function(t){return function(t,a){var i=t.target.checked?"desc":"asc";E.select("#childrenOrderDirBtnImg").attr("src","/app/icons/"+i+".png"),z(e.scene,e.datasets,e.undoStack);var n=e.scene.getItem(e.selected[0]),c={};c[a.accessor[0]]={field:n[a.accessor[0]].field,direction:i},e.scene.setProperties(n,c),G.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}(t,a)}})]}):Object(ee.jsx)("td",{})]},t)};return Object(ee.jsxs)("div",{children:[Object(ee.jsx)("div",{className:"propertyPanel",onClick:function(e){return p(null)},style:{overflow:"visible"},children:Object.keys(N).map((function(e){return Object(ee.jsxs)("div",{children:[Object(ee.jsx)("span",{className:nt[e].concat(["propertyGroupHeader"]).join(" "),children:e}),Object(ee.jsx)("table",{children:Object(ee.jsx)("tbody",{children:Object.keys(N[e]).map((function(t){return R(t,N[e][t])}))})})]},e)}))}),Object(ee.jsx)("div",{id:"colorPicker",children:Object(ee.jsx)(et.a,{disableAlpha:!0,color:c,onChangeComplete:function(e){return r(e.hex)}})})]})})),yt=(a(300),function e(t,a,i){if(a.push({item:t,level:i}),t.children)switch(t.type){case"collection":e(t.firstChild,a,i+1);break;case"axis":case"legend":case"gridlines":break;default:for(var n=t.children.length-1;n>=0;n--)e(t.children[n],a,i+1)}}),ft=function(e){switch(e.type){case"axis":case"legend":return e.id;default:return e.classId?e.classId:e.id}};var vt=Object(d.b)((function(e){return{selected:e.canvas.selected,dataItemJoined:e.canvas.dataItemJoined,newItemCreated:e.canvas.newItemCreated,itemsDeleted:e.canvas.itemsDeleted,itemUpdated:e.canvas.itemUpdated}}))((function(e){return Object(i.useEffect)((function(){var t=[];yt(e.scene,t,-1),t.forEach((function(e,t){return e.index=t}));var a=E.select(".layerView");a.selectAll("*").remove(),a.append("text").text("Layers").style("font-weight","bold").attr("class","layerText").attr("x",20).attr("y",16);var i=a.selectAll(".layer").data(t.slice(1)).enter().append("g").attr("class","layer");i.append("rect").attr("class","layerRow").attr("id",(function(e){return ft(e.item)})).attr("x",0).attr("y",(function(e){return 20+25*e.index-3})).attr("width",260).attr("height",25).on("click",(function(e,t){G.dispatch(f(null)),G.dispatch(R("Select")),G.dispatch(y([t.item.id]))})),i.append("image").attr("class","layerIcon").attr("x",(function(e){return 20+25*e.level})).attr("y",(function(e){return 20+25*e.index+2})).attr("href",(function(e){return"/app/icons/"+e.item.type+".png"})),i.append("text").attr("class","layerText").attr("x",(function(e){return 20+25*e.level+22})).attr("y",(function(e){return 20+25*e.index+1})).text((function(e){return function(e){if("axis"===e.type)return e.channel.substring(0,1).toUpperCase()+e.channel.substring(1)+" axis: "+e.field;var t=e.type.substring(0,1).toUpperCase()+e.type.substring(1);if(e.dataScope){var a=e.getScene().getPeers(e);a.length>1&&(t+=" ("+a.length+")");var i=e.dataScope.fields;e.parent&&"collection"===e.parent.type&&e.parent.dataScope&&(i=i.filter((function(t){return e.parent.dataScope.fields.indexOf(t)<0})));var n=i.join(", ");"atlas_rowId"===n&&(n="row ID"),""!==n&&(t+=": "+n)}return t}(e.item)}))}),[e.scene,e.dataItemJoined,e.newItemCreated,e.itemsDeleted,e.itemUpdated]),Object(i.useEffect)((function(){if(E.selectAll(".layerRow").classed("layerSelected",!1),e.selected.length>0){var t,a=Object(D.a)(e.selected);try{for(a.s();!(t=a.n()).done;){var i=t.value,n=e.scene.getItem(i);if(!n)return;E.select(".layerView").select("#"+ft(n)).classed("layerSelected",!0)}}catch(Rt){a.e(Rt)}finally{a.f()}}}),[e.scene,e.selected]),Object(ee.jsx)("svg",{className:"layerView"})})),bt=a(4),gt=(a(301),a(147)),xt=a(17);var mt=Object(d.b)((function(e){return{selected:e.canvas.selected,directSelected:e.canvas.directSelected}}))((function(e){var t=Object(i.useState)(null),a=Object(o.a)(t,2),n=a[0],c=a[1],r=Object(i.useState)([]),l=Object(o.a)(r,2),d=l[0],p=l[1],u=Object(i.useState)(null),h=Object(o.a)(u,2),y=h[0],f=h[1],v=Object(i.useRef)(null),b=Object(s.b)(),g=Object(o.a)(b,1)[0],x=Object(i.useState)(null),m=Object(o.a)(x,2),j=m[0],O=m[1],S=Object(i.useCallback)((function(t,a){try{var i=Object(A.csvFromString)(t,a),n=e.datasets.slice();n.push(i),e.loadDataset(n),c(i)}catch(Rt){console.warn("Invalid data file: "+a)}}),[e]);Object(i.useEffect)((function(){var e=g.get("dataset");e&&!j&&(O(e),fetch("/app/csv/"+e+".csv").then((function(e){return e.text()})).then((function(t){S(t,e)})))}),[g,j,S]);var k=Object(i.useMemo)((function(){if(null===n)return[{Header:" ",accessor:" "}];var e,t=n.fields,a=[],i=Object(D.a)(t);try{var c=function(){var t=e.value;a.push({Header:"atlas_rowId"===t?"Row ID":t,accessor:t,filter:"equals",Cell:function(e){var a=e.value;return n.getRawValue(t,a)}})};for(i.s();!(e=i.n()).done;)c()}catch(Rt){i.e(Rt)}finally{i.f()}return a}),[n]),w=Object(i.useMemo)((function(){return null===n?[{col:1}]:d.slice(0,500)}),[n,d]),C=Object(gt.useTable)({columns:k,data:w,initialState:{hiddenColumns:["atlas_rowId"]}}),I=C.getTableProps,T=C.getTableBodyProps,B=C.headerGroups,P=C.rows,R=C.prepareRow,M=function(e){if(!n)return Object(ee.jsx)("span",{});switch(n.getFieldType(e)){case"string":return Object(ee.jsx)("img",{src:"/app/icons/string.png",alt:"(string) ",width:"20px",height:"10px",style:{margin:"0 4px 2px 0"}});case"date":return Object(ee.jsx)("img",{src:"/app/icons/date.png",alt:"(date) ",width:"15px",style:{margin:"0 3px 2px 0"}});default:return Object(ee.jsx)("img",{src:"/app/icons/number.png",alt:"(number) ",width:"12px",height:"12px",style:{margin:"0 2px 3px 0"}})}};return Object(i.useEffect)((function(){if(!e.datasets||0===e.datasets.length)return c(null),p([]),void f(null);if(0!==e.selected.length||e.directSelected){if(e.selected.length>0){var t=e.scene.getItem(e.selected[0]);if(!t||"axis"===t.type||"legend"===t.type||"gridlines"===xt.d.type)return c(e.datasets[0]),p([]),void f(null);t.dataScope?(c(t.dataScope.dataTable),p(t.dataScope.tuples),f("Selected "+t.type+" has "+t.dataScope.numTuples+" attached data rows")):(c(null),p([]),f("Selected "+t.type+" has no attached data"))}else if(e.directSelected){var a=e.scene.getItem(e.directSelected);a||(c(e.datasets[0]),p([]),f(null)),a.dataScope?(c(a.dataScope.dataTable),p(a.dataScope.tuples),f("Selected "+a.type+" has "+a.dataScope.numTuples+" attached data rows")):(c(null),p([]),f("Selected "+a.type+" has no attached data"))}}else c(e.datasets[0]),p(e.datasets[0].data),f(null)}),[e.selected,e.directSelected,e.scene,e.datasets]),Object(ee.jsxs)("div",{id:"dataPanel",children:[Object(ee.jsxs)("div",{id:"datasetInfo",children:[e.datasets.map((function(e){return Object(ee.jsx)("div",{className:n&&n.id===e.id?"activeTableTab":"tableTab",onClick:function(t){return c(e)},children:e.name+" ("+e.getRowCount()+" rows)"},e.id)})),Object(ee.jsx)("button",{id:"csvBtn",onClick:function(){v.current.click()},children:"Import Data"}),Object(ee.jsx)("input",{type:"file",id:"file",ref:v,style:{display:"none"},accept:".csv",onChange:function(t){t.stopPropagation(),t.preventDefault();var a=t.target.files[0],i=new FileReader;i.onload=function(){z(e.scene,e.datasets,e.undoStack);var t=Object(A.csvFromString)(i.result,a.name),n=e.datasets.slice();n.push(t),e.loadDataset(n),c(t)},a&&i.readAsText(a)}})]}),Object(ee.jsx)("div",{id:"dataScopeInfo",style:{display:y?"block":"none"},children:y||""}),Object(ee.jsx)("div",{id:"tableDiv",children:Object(ee.jsxs)("table",Object(bt.a)(Object(bt.a)({id:"dataTable"},I()),{},{children:[Object(ee.jsx)("thead",{children:B.map((function(e){return Object(ee.jsx)("tr",Object(bt.a)(Object(bt.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(ee.jsxs)("th",Object(bt.a)(Object(bt.a)({},e.getHeaderProps()),{},{children:[M(e.Header),e.render("Header")]}))}))}))}))}),Object(ee.jsx)("tbody",Object(bt.a)(Object(bt.a)({},T()),{},{children:P.map((function(e){return R(e),Object(ee.jsx)("tr",Object(bt.a)(Object(bt.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(ee.jsx)("td",Object(bt.a)(Object(bt.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})]})}));a(303);var jt=Object(d.b)((function(e){return{legendClicked:e.canvas.legendClicked}}))((function(e){var t=Object(i.useState)(null),a=Object(o.a)(t,2),n=a[0],c=a[1],r=Object(i.useState)("#fff"),s=Object(o.a)(r,2),l=s[0],d=s[1],p=Object(i.useState)(null),u=Object(o.a)(p,2),h=u[0],y=u[1];return Object(i.useEffect)((function(){var t=e.legendClicked.legend,a=e.legendClicked.value;t&&a?(E.select("#legendColorPicker").style("visibility","visible"),c(e.scene.getItem(t)),y(a),d(e.scene.getItem(t).encoding.scale.map(a))):E.select("#legendColorPicker").style("visibility","hidden")}),[e.legendClicked,e.scene]),Object(ee.jsx)("div",{id:"legendColorPicker",children:Object(ee.jsx)(et.a,{disableAlpha:!0,color:l,onChangeComplete:function(t,a){d(t.hex);var i,c=n.encoding.scale.domain,r=[],s=Object(D.a)(c);try{for(s.s();!(i=s.n()).done;){var l=i.value;l===h?r.push(t.hex):r.push(n.encoding.scale.map(l))}}catch(Rt){s.e(Rt)}finally{s.f()}n.encoding.scale._setRange(r),e.renderer.render(e.scene)}})})}));var Ot=function(e){var t=Object(s.b)(),a=Object(o.a)(t,1)[0],n=Object(i.useState)(A.renderer("svg","canvas")),c=Object(o.a)(n,1)[0],r=Object(i.useState)(A.scene()),l=Object(o.a)(r,2),d=l[0],p=l[1],u=Object(i.useState)([]),h=Object(o.a)(u,2),v=h[0],b=h[1],g=Object(i.useState)([]),x=Object(o.a)(g,2),j=x[0],O=x[1],S=Object(i.useState)([]),k=Object(o.a)(S,2),w=k[0],C=k[1];Object(i.useEffect)((function(){document.body.style.backgroundColor="#ddd",document.body.style.overflow="hidden"}),[]),Object(i.useEffect)((function(){var e=a.get("project");e&&fetch("/app/scenes/"+e+".msc").then((function(e){return e.text()})).then((function(t){try{var a=JSON.parse(t);I(a)}catch(Rt){console.warn("Invalid project: "+e)}}))}),[a]),Object(i.useEffect)((function(){G.dispatch(m({visible:!1})),G.dispatch(y([])),G.dispatch(f(null)),c.clear(),c.render(d)}),[c,d]);var I=function(e){var t=A.sceneLoader(),a=t.load(e);p(a),b(Object.values(t.tables))};return Object(ee.jsxs)("div",{style:{overflow:"hidden"},children:[Object(ee.jsx)(ie,{scene:d,renderer:c,datasets:v,undoStack:j,redoStack:w,type:"svg"}),Object(ee.jsx)(Ve,{scene:d,renderer:c,datasets:v,undoStack:j,redoStack:w}),Object(ee.jsx)(mt,{scene:d,renderer:c,datasets:v,undoStack:j,loadDataset:b}),Object(ee.jsx)(vt,{scene:d,renderer:c}),Object(ee.jsx)($e,{scene:d,renderer:c,datasets:v,undoStack:j,redoStack:w,resetStacks:function(){O([]),C([])},loadScene:I}),Object(ee.jsx)(ht,{scene:d,renderer:c,datasets:v,undoStack:j}),Object(ee.jsx)(jt,{scene:d,renderer:c}),Object(ee.jsx)("input",{type:"text",id:"textElement",style:{visibility:"hidden",position:"absolute"}})]})},St=a(13),kt=a.n(St),wt=a(105);function Ct(e){return It.apply(this,arguments)}function It(){return(It=Object(wt.a)(kt.a.mark((function e(t){var a,i,n;return kt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return a=e.sent,e.next=5,a.text();case 5:return i=e.sent,n=JSON.parse(i),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Tt=function(e){var t=A.renderer("svg","canvas"),a=Object(i.useState)(A.scene()),n=Object(o.a)(a,2),c=n[0],r=n[1],s=Object(i.useState)("BarChartHorz"),l=Object(o.a)(s,2),d=l[0],p=l[1];Object(i.useEffect)((function(){document.body.style.backgroundColor="#ddd",document.body.style.overflow="hidden"}),[]),Object(i.useEffect)((function(){u("specs/"+d+".json")}),[d]),Object(i.useEffect)((function(){t.clear(),t.render(c)}),[t,c]);var u=function(){var e=Object(wt.a)(kt.a.mark((function e(t){var a,i,n;return kt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ct(t);case 2:return a=e.sent,i=A.specExecutor(),e.next=6,i.run(a);case 6:n=e.sent,G.dispatch(y([])),r(n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ee.jsxs)("div",{style:{overflow:"hidden"},children:[Object(ee.jsx)(ie,{scene:c,renderer:t,type:"svg"}),Object(ee.jsx)(Ve,{scene:c,renderer:t}),Object(ee.jsx)("div",{id:"specList",children:Object(ee.jsx)("ul",{children:["BarChartHorz","BarChartVert","BoxPlot","BulletChart","DivergingBarChart","GanttChart","GroupedBarChart","HeatMap","Histogram","MosaicPlot","StackedBarChart","TowerChart","Treemap","WaffleChart","WaterfallChart"].map((function(e){return Object(ee.jsx)("li",{onClick:function(t){return p(e)},children:e},e)}))})}),Object(ee.jsx)(mt,{scene:c,renderer:t}),Object(ee.jsx)(vt,{scene:c,renderer:t}),Object(ee.jsx)(ht,{scene:c,renderer:t}),Object(ee.jsx)($e,{})]})};window.onbeforeunload=function(e){var t=e||window.event;return t.preventDefault(),t&&(t.returnValue=""),""};var Bt=function(e){return Object(ee.jsx)(s.a,{basename:"/app",children:Object(ee.jsx)("div",{children:Object(ee.jsxs)(l.c,{children:[Object(ee.jsx)(l.a,{path:"/",element:Object(ee.jsx)(Ot,{})}),Object(ee.jsx)(l.a,{path:"/reuse",element:Object(ee.jsx)(Tt,{})})]})})})},Pt=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,316)).then((function(t){var a=t.getCLS,i=t.getFID,n=t.getFCP,c=t.getLCP,r=t.getTTFB;a(e),i(e),n(e),c(e),r(e)}))};r.a.render(Object(ee.jsx)(n.a.StrictMode,{children:Object(ee.jsx)(d.a,{store:G,children:Object(ee.jsx)(Bt,{})})}),document.getElementById("root")),Pt()},81:function(e,t,a){}},[[305,1,2]]]);
//# sourceMappingURL=main.dc7d3dc5.chunk.js.map