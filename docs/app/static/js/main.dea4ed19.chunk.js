(this["webpackJsonpdata-illustrateur"]=this["webpackJsonpdata-illustrateur"]||[]).push([[0],{155:function(e,t,i){},156:function(e,t,i){},157:function(e,t,i){},192:function(e,t,i){},193:function(e,t,i){},300:function(e,t,i){},301:function(e,t,i){},303:function(e,t,i){},305:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),c=i(25),r=i.n(c),l=(i(155),i(156),i(80),i(147)),s=i(12),o=i(6),d=(i(157),i(21)),p=i(53),u=Object(p.b)({name:"canvas",initialState:{selected:[],directSelected:null,directSelectPreview:null,rectSelectRegion:{},itemUpdated:{},scaleUpdated:{},axisHandleVisible:!1,legendClicked:{},dataItemJoined:{},newItemCreated:{},itemsDeleted:[],undoStackChanged:{length:0},redoStackChanged:{length:0}},reducers:{select:function(e,t){e.selected=t.payload},directSelect:function(e,t){e.directSelected=t.payload},directSelectPreview:function(e,t){e.directSelectPreview=t.payload},rectSelect:function(e,t){e.rectSelectRegion=t.payload},draw:function(e,t){console.log(t)},updateItem:function(e,t){e.itemUpdated=t.payload},updateScale:function(e,t){e.scaleUpdated=t.payload},toggleAxisHandle:function(e,t){e.axisHandleVisible=t.payload},customizeColorPalette:function(e,t){e.legendClicked=t.payload},joinDataItem:function(e,t){e.dataItemJoined=t.payload},createNewItem:function(e,t){e.newItemCreated=t.payload},deleteItems:function(e,t){e.itemsDeleted=t.payload},updateUndoStack:function(e,t){e.undoStackChanged=t.payload},updateRedoStack:function(e,t){e.redoStackChanged=t.payload}}}),h=u.actions,y=h.select,v=h.directSelect,f=h.directSelectPreview,b=h.rectSelect,g=(h.draw,h.updateItem),x=h.updateScale,j=h.toggleAxisHandle,m=h.customizeColorPalette,O=h.joinDataItem,S=h.createNewItem,k=h.deleteItems,w=h.updateUndoStack,C=h.updateRedoStack,I=u.reducer,P=Object(p.b)({name:"tool",initialState:{activeTool:"Select"},reducers:{activateTool:function(e,t){e.activeTool=t.payload}}}),T=P.actions.activateTool,B=P.reducer,R=Object(p.a)({reducer:{canvas:I,tool:B}}),M=i(2),G=i(4),E={"Shape Position":{X:{id:"x",channel:"x",group:"Shape Position",type:"numeric",encodable:!0,class:["line-prop","circle-prop","rect-prop","pointText-prop","path-prop","polygon-prop","image-prop","group-prop","area-prop"],accessor:["x"]},Y:{id:"y",channel:"y",group:"Shape Position",type:"numeric",encodable:!0,class:["line-prop","circle-prop","rect-prop","pointText-prop","path-prop","polygon-prop","image-prop","group-prop","area-prop"],accessor:["y"]},Baseline:{id:"baseline",group:"Shape Position",type:"categorical",encodable:!1,class:["area-prop"],accessor:["baseline"],options:[{display:"top",value:"top"},{display:"middle",value:"middle"},{display:"bottom",value:"bottom"},{display:"left",value:"left"},{display:"center",value:"center"},{display:"right",value:"right"}]}},"Segment Position":{X:{id:"segmentX",channel:"x",group:"Segment Position",type:"numeric",encodable:!0,class:["segment-prop"],accessor:["x"]},Y:{id:"segmentY",channel:"y",group:"Segment Position",type:"numeric",encodable:!0,class:["segment-prop"],accessor:["y"]}},"Vertex Position":{X:{id:"vxX",channel:"x",group:"Vertex Position",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["x"]},Y:{id:"vxY",channel:"y",group:"Vertex Position",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["y"]}},Size:{Width:{id:"width",channel:"width",group:"Size",type:"numeric",encodable:!0,class:["rect-prop","path-prop","image-prop","area-prop"],accessor:["bounds","width"]},Height:{id:"height",channel:"height",group:"Size",type:"numeric",encodable:!0,class:["rect-prop","path-prop","image-prop","area-prop"],accessor:["bounds","height"]},Radius:{id:"radius",channel:"radius",group:"Size",type:"numeric",encodable:!0,class:["circle-prop"],accessor:["radius"]},"Inner Radius":{id:"innerRadius",channel:"innerRadius",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","ring-prop"],accessor:["innerRadius"]},"Outer Radius":{id:"outerRadius",channel:"outerRadius",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","ring-prop"],accessor:["outerRadius"]},Angle:{id:"angle",channel:"angle",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","pie-prop"],accessor:["angle"]},Thickness:{id:"thickness",channel:"thickness",group:"Size",type:"numeric",encodable:!0,class:["arc-prop","ring-prop"],accessor:["thickness"]},Area:{id:"area",channel:"area",group:"Size",type:"numeric",encodable:!0,class:["rect-prop","circle-prop"],accessor:["area"]}},Text:{Content:{id:"content",channel:"text",group:"Text",type:"string",encodable:!0,class:["pointText-prop"],accessor:["text"]},Font:{id:"fontFamily",channel:"fontFamily",group:"Text",type:"categorical",encodable:!1,class:["pointText-prop"],accessor:["fontFamily"],options:[{display:"Arial",value:"Arial, sans-serif"},{display:"Alegreya Sans",value:"'Alegreya Sans', sans-serif"},{display:"Alegreya",value:"'Alegreya', serif"},{display:"Calibri",value:"Calibri, sans-serif"},{display:"Cambria",value:"Cambria, sans-serif"},{display:"Chivo",value:"'Chivo', sans-serif"},{display:"Comic Sans MS",value:"'Comic Sans MS', sans-serif"},{display:"Consolas",value:"Consolas, monospace"},{display:"Cormorant",value:"'Cormorant', serif"},{display:"Courier New",value:"'Courier New', Courier, monospace"},{display:"Eczar",value:"'Eczar', serif"},{display:"Fira Sans",value:"'Fira Sans', sans-serif"},{display:"Futura",value:"Futura, sans-serif"},{display:"Georgia",value:"Georgia, serif"},{display:"Helvetica Neue",value:"'HelveticaNeue', 'Helvetica Neue', 'HelveticaNeueRoman', 'HelveticaNeue-Roman', 'Helvetica Neue Roman', sans-serif"},{display:"Impact",value:"Impact, Charcoal, sans-serif"},{display:"Palatino",value:"Palatino, serif"},{display:"Libre Franklin",value:"'Libre Franklin', sans-serif"},{display:"Playfair Display",value:"'Playfair Display', serif"},{display:"Playfair Display SC",value:"'Playfair Display SC', serif"},{display:"Rubik",value:"'Rubik', sans-serif"},{display:"Space Mono",value:"'Space Mono', monospace"},{display:"Times New Roman",value:"'Times New Roman', TimesNewRoman, serif"},{display:"Trebuchet MS",value:"'Trebuchet MS', sans-serif"},{display:"Verdana",value:"Verdana, Geneva, sans-serif"},{display:"Work Sans",value:"'Work Sans', sans-serif"}]},Color:{id:"textColor",channel:"fillColor",group:"Text",type:"color",encodable:!0,class:["pointText-prop"],accessor:["fillColor"]},Weight:{id:"fontWeight",channel:"fontWeight",group:"Text",type:"categorical",encodable:!1,class:["pointText-prop"],accessor:["fontWeight"],options:[{display:"normal",value:"normal"},{display:"bold",value:"bold"}]},"Size (px)":{id:"fontSize",channel:"fontSize",group:"Text",type:"numeric",encodable:!0,class:["pointText-prop"],accessor:["fontSize"]}},"Vertex Style":{Shape:{id:"vxShape",channel:"shape",group:"Vertex Style",type:"categorical",encodable:!1,class:["vertex-prop"],accessor:["shape"],options:[{display:"none",value:void 0},{display:"rectangle",value:"rect"},{display:"circle",value:"circle"}]},Width:{id:"vxWidth",channel:"width",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["width"]},Height:{id:"vxHeight",channel:"height",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["height"]},Radius:{id:"vxRadius",channel:"radius",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["radius"]},"Fill Color":{id:"vxFillColor",channel:"fillColor",group:"Vertex Style",type:"color",encodable:!0,class:["vertex-prop"],accessor:["fillColor"]},"Stroke Color":{id:"vxStrokeColor",channel:"strokeColor",group:"Vertex Style",type:"color",encodable:!0,class:["vertex-prop"],accessor:["strokeColor"]},"Stroke Width":{id:"vxStrokeWidth",channel:"strokeWidth",group:"Vertex Style",type:"numeric",encodable:!0,class:["vertex-prop"],accessor:["strokeWidth"]},Opacity:{id:"vxOpacity",channel:"opacity",group:"Vertex Style",type:"numeric-range",encodable:!1,class:["vertex-prop"],range:[0,1],accessor:["opacity"]}},Style:{"Curve Mode":{id:"curveMode",channel:"curveMode",group:"Style",type:"categorical",encodable:!1,class:["path-prop","area-prop"],accessor:["curveMode"],options:[{display:"Natural",value:"natural",parameters:[]},{display:"Basis",value:"basis",parameters:[]},{display:"BumpX",value:"bumpX",parameters:[]},{display:"BumpY",value:"bumpY",parameters:[]},{display:"Linear",value:"linear",parameters:[]},{display:"Step",value:"step",parameters:[]},{display:"CatmullRom",value:"CatmullRom",parameters:[]},{display:"Cardinal",value:"cardinal",parameters:[]}]},"Fill Color":{id:"fillColor",channel:"fillColor",group:"Style",type:"color",encodable:!0,class:["circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],accessor:["fillColor"]},"Stroke Color":{id:"strokeColor",channel:"strokeColor",group:"Style",type:"color",encodable:!0,class:["line-prop","circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],accessor:["strokeColor"]},"Stroke Width":{id:"strokeWidth",channel:"strokeWidth",group:"Style",type:"numeric",encodable:!0,class:["line-prop","circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],accessor:["strokeWidth"]},Opacity:{id:"opacity",channel:"opacity",group:"Style",type:"numeric-range",encodable:!1,class:["line-prop","circle-prop","rect-prop","path-prop","polygon-prop","arc-prop","pie-prop","text-prop","area-prop","ring-prop"],range:[0,1],accessor:["opacity"]}},Canvas:{Background:{id:"canvasFillColor",group:"canvas",type:"color",encodable:!1,class:["canvas-prop"],accessor:["fillColor"]}},"Collection Position":{X:{id:"collectionX",channel:"x",group:"Collection Position",type:"numeric",encodable:!0,class:["collection-prop"],accessor:["x"]},Y:{id:"collectionY",channel:"y",group:"Collection Position",type:"numeric",encodable:!0,class:["collection-prop"],accessor:["y"]}},"Glyph Position":{X:{id:"glyphX",channel:"x",group:"Glyph Position",type:"numeric",encodable:!0,class:["glyph-prop"],accessor:["x"]},Y:{id:"glyphY",channel:"y",group:"Glyph Position",type:"numeric",encodable:!0,class:["glyph-prop"],accessor:["y"]}},Layout:{Type:{id:"layoutType",group:"Layout",type:"categorical",encodable:!1,class:["collection-prop","grid-prop","stack-prop","none-prop"],options:[{display:"Grid",value:"grid",parameters:["Num Rows","Num Columns","Row Gap","Column Gap","Horz Gravity","Vert Gravity"]},{display:"Stack",value:"stack",parameters:["Orientation","Horz Gravity","Vert Gravity"]},{display:"Pack",value:"packing",parameters:[]},{display:"Treemap",value:"treemap",parameters:[]},{display:"None",value:"none",parameters:[]}]},"Num Rows":{id:"numRows",group:"Layout",type:"numeric-integer",encodable:!1,class:["grid-prop","layout-prop"],accessor:["numRows"]},"Num Columns":{id:"numCols",group:"Layout",type:"numeric-integer",encodable:!1,class:["grid-prop","layout-prop"],accessor:["numCols"]},"Row Gap":{id:"rowGap",group:"Layout",type:"numeric",encodable:!1,class:["grid-prop","layout-prop"],accessor:["rowGap"]},"Column Gap":{id:"colGap",group:"Layout",type:"numeric",encodable:!1,class:["grid-prop","layout-prop"],accessor:["colGap"]},Orientation:{id:"orientation",group:"Layout",type:"categorical",encodable:!1,class:["stack-prop","layout-prop"],accessor:["orientation"],options:[{display:"Horizontal",value:"horizontal",parameters:[]},{display:"Vertical",value:"vertical",parameters:[]}]},"Horz Gravity":{id:"horzGravity",group:"Layout",type:"categorical",encodable:!1,class:["grid-prop","stack-prop","layout-prop"],accessor:["horzCellAlignment"],options:[{display:"Left",value:"left",parameters:[]},{display:"Center",value:"center",parameters:[]},{display:"Right",value:"right",parameters:[]}]},"Vert Gravity":{id:"vertGravity",group:"Layout",type:"categorical",encodable:!1,class:["grid-prop","stack-prop","layout-prop"],accessor:["vertCellAlignment"],options:[{display:"Top",value:"top",parameters:[]},{display:"Middle",value:"middle",parameters:[]},{display:"Bottom",value:"bottom",parameters:[]}]}},Axis:{"Include 0":{id:"includeZero",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["includeZero"]},"Show Path":{id:"showPath",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["pathVisible"]},"Show Ticks":{id:"showTicks",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["tickVisible"]},Orientation:{id:"axisOrientation",group:"axis",type:"categorical",encodable:!1,class:["axis-prop"],accessor:["orientation"],options:[{display:"top",value:"top"},{display:"bottom",value:"bottom"},{display:"left",value:"left"},{display:"right",value:"right"}]},"Stroke Color":{id:"axisStrokeColor",group:"axis",type:"color",encodable:!1,class:["axis-prop"],accessor:["strokeColor"]},"Text Color":{id:"axisTextColor",group:"axis",type:"color",encodable:!1,class:["axis-prop"],accessor:["textColor"]},"Path Position":{id:"pathPos",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["pathPosition"]},"Tick Offset":{id:"tickOffset",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["tickOffset"]},"Tick Size":{id:"tickSize",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["tickSize"]},"Label Offset":{id:"labelOffset",group:"axis",type:"numeric",encodable:!1,class:["axis-prop"],accessor:["labelOffset"]},"Label Format":{id:"labelFormat",group:"axis",type:"string",encodable:!1,class:["axis-prop"],accessor:["labelFormat"]},"Show Title":{id:"showTitle",group:"axis",type:"boolean",encodable:!1,class:["axis-prop"],accessor:["showTitle"]}},Legend:{"Text Color":{id:"legendTextColor",group:"legend",type:"color",encodable:!1,class:["legend-prop"],accessor:["textColor"]}},Gridlines:{"Stroke Color":{id:"gridlineStrokeColor",group:"Gridlines",type:"color",encodable:!1,class:["gridlines-prop"],accessor:["strokeColor"]},"Stroke Width":{id:"gridlineStrokeWidth",group:"Gridlines",type:"numeric",encodable:!1,class:["gridlines-prop"],accessor:["strokeWidth"]}},"Alignment in Cell":{Horizontal:{id:"x-constraint",group:"Float",type:"categorical",encodable:!1,class:["line-constraint-prop","circle-constraint-prop","rect-constraint-prop","text-constraint-prop","repeat-grid-constraint-prop","partition-constraint-prop"],options:[{display:"Off",value:"off"},{display:"Left",value:"left"},{display:"Center",value:"center"},{display:"Right",value:"right"}]},Vertical:{id:"y-constraint",group:"Float",type:"categorical",encodable:!1,class:["line-constraint-prop","circle-constraint-prop","rect-constraint-prop","text-constraint-prop","repeat-grid-constraint-prop","partition-constraint-prop"],options:[{display:"Off",value:"off"},{display:"Top",value:"top"},{display:"Middle",value:"middle"},{display:"Bottom",value:"bottom"}]}}},N=i(11),U=function(e,t,i,a){var n,c=a||"undo",r=e.toJSON(),l=Object(G.a)(t);try{for(l.s();!(n=l.n()).done;){var s=n.value;s.id in r.tables||(r.tables[s.id]=s.toJSON())}}catch(o){l.e(o)}finally{l.f()}i.push(JSON.stringify(r)),"undo"===c?R.dispatch(w({length:i.length})):"redo"===c&&R.dispatch(C({length:i.length}))},D=function(e,t){var i,a="",n=Object(G.a)(e);try{for(n.s();!(i=n.n()).done;){var c=i.value;if(c.getSVGPathData)a+=c.getSVGPathData();else if(c.bounds){var r=c.bounds;a+=["M",r.left,r.top].join(" "),a+=["L",r.right,r.top].join(" "),a+=["L",r.right,r.bottom].join(" "),a+=["L",r.left,r.bottom,"Z"].join(" ")}else if("vertex"===c.type){var l=Math.max(c.width,c.height,c.radius,t);a+=["M",c.x-l/2,c.y-l/2].join(" "),a+=["L",c.x+l/2,c.y-l/2].join(" "),a+=["L",c.x+l/2,c.y+l/2].join(" "),a+=["L",c.x-l/2,c.y+l/2,"Z"].join(" ")}}}catch(s){n.e(s)}finally{n.f()}return a},A=function(e,t,i,a){var n;if(t.length>=1?n=a.getItem(t[0]):i&&(n=a.getItem(i)),!n)return null;if(!n.dataScope)return null;if(1===n.dataScope.numTuples)return null;var c=a.getEncodingByItem(n,e);return c?c.aggregator:null},F=function(e,t,i,a){var n;if(t.length>=1?n=a.getItem(t[0]):i&&(n=a.getItem(i)),!n)return null;var c=a.getEncodingByItem(n,e);return c?c.scale.scheme:null},L=function(e,t,i,a){var n;if(t.length>=1?n=a.getItem(t[0]):i&&(n=a.getItem(i)),!n)return null;var c=a.getEncodingByItem(n,e);return c?c.scale.type:null},z=function(e,t){for(var i=0,a=[["x","width"],["y","height"],["fillColor","strokeColor"]];i<a.length;i++){var n=a[i];if(n.indexOf(e)>=0&&n.indexOf(t)>=0)return!0}return!1},Y=function(e,t){var i=e.bounds.width/e.bounds.height,a="collection"===e.type&&e.layout&&"grid"===e.layout.type,n=a?2*e.layout.rowGap:5,c=a?2*e.layout.colGap:5;return i>2?N.layout("grid",{numCols:1,rowGap:n}):N.layout("grid",{numRows:1,colGap:c})},H=function(e,t){var i=document.getElementById("canvas").getBoundingClientRect();return[e-i.x,t-i.y]},V=function(e,t){var i=function(e,t){switch(e){case"vertex":return"vx"+t.replace(/^\w/,(function(e){return e.toUpperCase()}));case"scene":return"canvas"+t.replace(/^\w/,(function(e){return e.toUpperCase()}));case"collection":case"segment":case"legend":return e+t.replace(/^\w/,(function(e){return e.toUpperCase()}));default:return t}}(e,t);for(var a in E)for(var n in E[a])if(E[a][n].id===i)return E[a][n];return null},W=[],X=void 0,_=void 0,J=function(){for(var e=["M",W[0][0],W[0][1]].join(" "),t=1;t<W.length;t++){var i=W[t][0],a=W[t][1];i===W[0][0]&&a===W[0][1]?e+="Z":e+=["L",W[t][0],W[t][1]].join(" ")}void 0!==X&&void 0!==_&&(e+=["L",X,_].join(" ")),M.select("#polylineToolUI").style("visibility","visible").style("fill","none").attr("d",e)},q=function(e,t,i,a){if(W&&0!==W.length){if(J(),M.select("#polylineToolUI").style("visibility","hidden"),W.length>1){U(e,t,a);var n=e.mark("path",{vertices:W});R.dispatch(S(n.id)),i.render(e)}W=[],X=void 0,_=void 0}},K=i(1);var Z,Q,$=Object(d.b)((function(e){return{selected:e.canvas.selected,itemUpdated:e.canvas.itemUpdated,scaleUpdated:e.canvas.scaleUpdated,dataItemJoined:e.canvas.dataItemJoined,itemsDeleted:e.canvas.itemsDeleted}}))((function(e){return Object(a.useEffect)((function(){e.renderer.render(e.scene)}),[e.scene,e.renderer,e.itemUpdated,e.scaleUpdated,e.dataItemJoined,e.itemsDeleted]),Object(a.useEffect)((function(){var t=function(t,i){var a=R.getState().canvas.selected;if(a&&a.length>0){var n=e.scene.getItem(a[0]);n&&(e.scene.translate(n,t,i),R.dispatch(g({id:n.id,type:n.type,properties:{x:n.x,y:n.y}})))}var c=R.getState().canvas.directSelected;if(c){var r=e.scene.getItem(c);"path"===r.parent.type&&(r._doTranslate(t,i),R.dispatch(g({id:r.parent.id,type:r.parent.type,properties:{x:r.parent.x,y:r.parent.y}})))}};document.addEventListener("keydown",(function(i){switch(i.key){case"Delete":var a=R.getState().canvas.selected;if(a&&a.length>0)for(var n=a.length-1;n>=0;n--){var c=e.scene.getItem(a[n]);c&&c.parent===e.scene&&(R.dispatch(y([])),e.scene.removeItem(c),R.dispatch(k([c].map((function(e){return e.id})))))}break;case"ArrowLeft":t(-5,0);break;case"ArrowRight":t(5,0);break;case"ArrowUp":t(0,-5);break;case"ArrowDown":t(0,5);break;case"Escape":"Pen"===R.getState().tool.activeTool&&q(e.scene,e.datasets,e.renderer,e.undoStack)}}))}),[e.scene,e.datasets,e.renderer,e.undoStack]),"canvas"===e.type?Object(K.jsx)("canvas",{className:"canvas",id:"canvas"}):Object(K.jsx)("svg",{className:"canvas",id:"canvas"})})),ee={nw:function(e){return{x:e.left,y:e.top}},n:function(e){return{x:e.x,y:e.top}},ne:function(e){return{x:e.right,y:e.top}},e:function(e){return{x:e.right,y:e.y}},se:function(e){return{x:e.right,y:e.bottom}},s:function(e){return{x:e.x,y:e.bottom}},sw:function(e){return{x:e.left,y:e.bottom}},w:function(e){return{x:e.left,y:e.y}}},te=void 0,ie=function(e){if(e){var t,i,a,n,c,r,l,s,o,d,p=M.select("#axisHandle");switch(e.channel){case"x":case"width":t=e.bounds.left,i=te||e.bounds.middle,a=e.bounds.right,n=i,l=45,s=16,o=(c=e.isFlipped?e.bounds.left:e.bounds.right-l)+5,d=(r=i-s/2)+s/2,p.select("text").style("writing-mode","lr");break;case"y":case"height":t=te||e.bounds.center,i=e.bounds.top,a=t,n=e.bounds.bottom,s=45,c=t-(l=16)/2,o=t+3,d=(r=e.isFlipped?e.bounds.bottom-s:e.bounds.top)+5,p.select("text").style("writing-mode","tb").style("glyph-orientation-vertical",0)}p.select("line").attr("x1",t).attr("x2",a).attr("y1",i).attr("y2",n),p.select("rect").attr("x",c).attr("y",r).attr("width",l).attr("height",s).attr("rx",6).attr("ry",6),p.select("text").text(e.encoding.scale.rangeExtent.toFixed(0)+"px").attr("x",o).attr("y",d)}},ae=function(e,t,i){var a={x:e.left,y:e.top,width:e.width,height:e.height};for(var n in a)i.attr(n,a[n]);for(var c in t)i.style(c,t[c])},ne=function(e){Z=e.x,Q=e.y},ce=function(e,t,i,a){var n={top:t.top,height:t.height,left:t.left,width:t.width};return e.indexOf("s")>=0?(a<1-t.height&&(a=1-t.height),n.height+=a):e.indexOf("n")>=0&&(a>t.height-1&&(a=t.height-1),n.height-=a,n.top+=a),e.indexOf("e")>=0?(i<1-t.width&&(i=1-t.width),n.width+=i):e.indexOf("w")>=0&&(i>t.width-1&&(i=t.width-1),n.left+=i,n.width-=i),n.right=n.left+n.width,n.bottom=n.top+n.height,n.x=(n.left+n.right)/2,n.y=(n.top+n.bottom)/2,n},re=["nw","n","ne","w","sw","s","se","e"];var le,se,oe,de,pe,ue,he,ye,ve,fe,be,ge,xe=Object(d.b)((function(e){return{selected:e.canvas.selected,directSelected:e.canvas.directSelected,directSelectPreview:e.canvas.directSelectPreview,itemUpdated:e.canvas.itemUpdated,axisHandleVisible:e.canvas.axisHandleVisible,scaleUpdated:e.canvas.scaleUpdated,rectSelectRegion:e.canvas.rectSelectRegion}}))((function(e){return Object(a.useEffect)((function(){if(0!==e.selected.length){var t=e.scene.getItem(e.selected[0]);M.select("#selectionUI").selectAll("circle").style("stroke","#1592e6").style("fill","white").call(M.drag().on("start",ne).on("drag",(function(e){!function(e,t,i){var a=e.x-Z,n=e.y-Q,c=ce(t,i.bounds,a,n),r=M.select("#handleG");M.select("#boundsOutline").attr("x",c.left).attr("y",c.top).attr("width",c.width).attr("height",c.height);var l,s=Object(G.a)(re);try{for(s.s();!(l=s.n()).done;){var o=l.value,d=ee[o](c);r.select("."+o).attr("cx",d.x).attr("cy",d.y)}}catch(p){s.e(p)}finally{s.f()}}(e,M.select(this).attr("class"),t)})).on("end",(function(i){!function(e,t,i,a){var n,c=e.x-Z,r=e.y-Q,l=ce(t,i.bounds,c,r);if("rect"===i.type||"line"===i.type)n={width:l.width,height:l.height,xRef:t.indexOf("e")<0?"right":"left",yRef:t.indexOf("n")<0?"top":"bottom"};else if("circle"===i.type)n={radius:Math.max(l.width,l.height)/2,xRef:t.indexOf("e")<0?"right":"left",yRef:t.indexOf("n")<0?"top":"bottom"};else if("pointText"===i.type){var s=Math.floor(parseInt(i.fontSize)*l.width/i.bounds.width);n={fontSize:(s=Math.max(4,s))+"px"}}n&&(a.setProperties(i,n),R.dispatch(g({id:i.id,type:i.type,properties:n})))}(i,M.select(this).attr("class"),t,e.scene)})))}}),[e.scene,e.selected]),Object(a.useEffect)((function(){!function(e,t){if(M.select("#selectionUI").selectAll("circle").style("visibility","hidden"),M.select("#handleG").style("visibility","hidden"),M.selectAll(".openGroup").style("visibility","hidden"),M.select("#pathOutline").style("visibility","hidden"),M.select("#selectPeerOutline").style("visibility","hidden"),M.select("#boundsOutline").style("visibility","hidden"),1===e.length){var i=t.getItem(e[0]);if(!i)return;var a,n,c=Object(N.getPeersInScene)(i);if(c.length>1){var r=D(c,2);M.select("#selectPeerOutline").style("visibility","visible").attr("d",r)}a="collection"===i.type||"axis"===i.type||"legend"===i.type?{stroke:"#1ecb40","stroke-dasharray":"5,5","stroke-width":2,fill:"none"}:{stroke:"#1592e6","stroke-dasharray":"none","stroke-width":1.5,fill:"none"},"legend"===i.type?((n=i.bounds.clone()).left-=10,n.top-=10,n.width+=20,n.height+=20):n=i.bounds,"path"===i.type||"area"===i.type||"polygon"===i.type||"arc"===i.type||"pie"===i.type?(M.select("#boundsOutline").style("visibility","hidden"),M.select("#pathOutline").style("visibility","visible"),M.select("#pathSegments").attr("d",i.getSVGPathData()),M.select("#pathVertices").attr("d",D(i.vertices,2))):(M.select("#boundsOutline").style("visibility","visible"),M.select("#pathOutline").style("visibility","hidden"),ae(n,a,M.select("#boundsOutline"))),M.selectAll(".openGroup").style("visibility","hidden");for(var l=i.parent,s=1,o={stroke:"#1ecb40","stroke-width":4,fill:"none",opacity:.15,visibility:"visible"};l&&"scene"!==l.type;)ae(l.bounds,o,M.select("#openGroup"+s)),l=l.parent,s+=1;M.select("#handleG").style("visibility","visible");var d=M.select("#selectionUI");if(["rect","circle","line","pointText"].indexOf(i.type)<0)return void d.selectAll("circle").style("visibility","hidden");var p,u=Object(G.a)(re);try{for(u.s();!(p=u.n()).done;){var h=p.value,y=ee[h](n);d.select("."+h).style("cursor",h+"-resize").attr("cx",y.x).attr("cy",y.y).style("visibility","visible")}}catch(g){u.e(g)}finally{u.f()}"line"===i.type?(0===i.bounds.width&&(d.selectAll("circle").style("visibility","hidden"),d.select(".n").style("visibility","visible"),d.select(".s").style("visibility","visible")),0===i.bounds.height&&(d.selectAll("circle").style("visibility","hidden"),d.select(".e").style("visibility","visible"),d.select(".w").style("visibility","visible"))):"pointText"===i.type&&(d.selectAll("circle").style("visibility","hidden"),d.select(".se").style("visibility","visible"))}else if(e.length>1){var v=e.map((function(e){return t.getItem(e)}));M.select("#handleG").style("visibility","visible");for(var f=v[0].bounds.clone(),b=1;b<v.length;b++)f=f.union(v[b].bounds);ae(f,{stroke:"#1592e6","stroke-dasharray":"none","stroke-width":1.5,fill:"none",visibility:"visible"},M.select("#boundsOutline")),M.select("#selectPeerOutline").style("visibility","hidden"),M.select("#pathOutline").style("visibility","hidden")}}(e.selected,e.scene),function(e,t){if(M.selectAll(".directSelectPreview").style("visibility","hidden"),e){var i=t.getItem(e);if(!i)return M.selectAll(".directSelected").style("visibility","hidden"),void M.select("#directSelectPeerOutline").style("visibility","hidden");var a=Object(N.getPeersInScene)(i);if(a.length>1){var n=D(a,4);M.select("#directSelectPeerOutline").style("visibility","visible").attr("d",n)}var c={stroke:"#1592e6","stroke-width":2,fill:"none",visibility:"visible"};if("segment"===i.type){var r=M.select("#segment").attr("x1",i.vertex1.x).attr("y1",i.vertex1.y).attr("x2",i.vertex2.x).attr("y2",i.vertex2.y);for(var l in c)r.style(l,c[l]);M.select("#vertex").style("visibility","hidden")}else{var s={left:i.x-2,top:i.y-2,width:4,height:4};ae(s,c,M.select("#vertex")),M.select("#segment").style("visibility","hidden")}}else M.selectAll(".directSelected").style("visibility","hidden"),M.select("#directSelectPeerOutline").style("visibility","hidden")}(e.directSelected,e.scene),function(e,t){if(1===e.length){var i=t.getItem(e[0]);if(i&&"collection"===i.type&&i.layout&&"grid"===i.layout.type){for(var a=i.layout,n=a.cellBounds,c=a.numCols,r=a.numRows,l=[],s=0;s<c-1;s++){var o=a.colGap<0?n[s].right+a.colGap:n[s].right;l.push({x:o,y:n[s].top,width:Math.abs(a.colGap),height:i.bounds.height,type:"c"})}for(var d=0;d<r-1;d++){var p=a.rowGap<0?n[d*c].bottom+a.rowGap:n[d*c].bottom;l.push({x:n[0].left,y:p,width:i.bounds.width,height:Math.abs(a.rowGap),type:"r"})}var u=M.select("#gridGaps").style("visibility","visible").selectAll("rect").data(l);u.enter().append("rect").merge(u).attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height})).style("fill","pink").style("opacity",.2).style("cursor",(function(e){return"r"===e.type?"ns-resize":"ew-resize"})).call(M.drag().on("drag",(function(a){a.sourceEvent.stopPropagation();var n=M.select(this).datum().type,c={},r="r"===n?"rowGap":"colGap",l="r"===n?a.dy:a.dx;c[r]=i.layout[r]+l,t.setProperties(i.layout,c),R.dispatch(g({id:e[0],type:i.type,properties:c}))}))),u.exit().remove()}else M.select("#gridGaps").style("visibility","hidden")}else M.select("#gridGaps").style("visibility","hidden")}(e.selected,e.scene)}),[e.scene,e.selected,e.directSelected,e.itemUpdated,e.scaleUpdated]),Object(a.useEffect)((function(){!function(e,t){if(M.selectAll(".directSelectPreview").style("visibility","hidden"),e){var i=t.getItem(e);if(!i)return;var a={stroke:"#79AFE0","stroke-width":2,fill:"none",visibility:"visible"};if("segment"===i.type){var n=M.select("#segmentPreview").attr("x1",i.vertex1.x).attr("y1",i.vertex1.y).attr("x2",i.vertex2.x).attr("y2",i.vertex2.y);for(var c in a)n.style(c,a[c])}else{var r={left:i.x-3,top:i.y-3,width:6,height:6};ae(r,a,M.select("#vertexPreview"))}}}(e.directSelectPreview,e.scene)}),[e.directSelectPreview,e.scene]),Object(a.useEffect)((function(){var t;e.axisHandleVisible.visible?(e.scene,(t=e.scene.getItem(e.axisHandleVisible.axis))&&(M.select("#axisHandle").style("visibility","visible").select("rect").call(M.drag().on("start",(function(e){"x"===t.channel||"width"===t.channel?te=t.bounds.middle:"y"!==t.channel&&"height"!==t.channel||(te=t.bounds.center)})).on("end",(function(e){te=void 0})).on("drag",(function(e){e.sourceEvent.stopPropagation();var i=t.isFlipped?-1:1,a=t.encoding.scale;if("x"===t.channel||"width"===t.channel){var n=a.rangeExtent+e.dx*i;if(n<=0){if(!(a.getEncodedChannels().indexOf("width")<0))return;a.isFlipped=!a.isFlipped}t.encoding.scale.rangeExtent=n,t.autoUpdateTicks()}else if("y"===t.channel||"height"===t.channel){var c=a.rangeExtent-e.dy*i;if(c<=0){if(!(a.getEncodedChannels().indexOf("height")<0))return;a.isFlipped=!a.isFlipped}t.encoding.scale.rangeExtent=c,t.autoUpdateTicks()}R.dispatch(x({id:t.encoding.scale.id,type:t.encoding.scale.type,axis:t.id}))}))),ie(t))):M.select("#axisHandle").style("visibility","hidden")}),[e.scene,e.axisHandleVisible]),Object(a.useEffect)((function(){0!==e.rectSelectRegion.width&&0!==e.rectSelectRegion.height||M.select("#rectSelectRegion").style("visibility","hidden");ae(e.rectSelectRegion,{stroke:"#ccc","stroke-width":2,fill:"none","stroke-dasharray":"5,5",opacity:1,visibility:"visible"},M.select("#rectSelectRegion"))}),[e.rectSelectRegion]),Object(a.useEffect)((function(){e.scaleUpdated.axis&&ie(e.scene.getItem(e.scaleUpdated.axis))}),[e.scene,e.scaleUpdated]),Object(K.jsxs)("g",{id:"selectionUI",children:[Object(K.jsx)("rect",{id:"openGroup1",className:"openGroup"}),Object(K.jsx)("rect",{id:"openGroup2",className:"openGroup"}),Object(K.jsx)("rect",{id:"openGroup3",className:"openGroup"}),Object(K.jsx)("rect",{id:"openGroup4",className:"openGroup"}),Object(K.jsx)("path",{id:"selectPeerOutline",style:{stroke:"#60bdf0",strokeWidth:1,fill:"none"}}),Object(K.jsx)("path",{id:"directSelectPeerOutline",style:{stroke:"#60bdf0",strokeWidth:1,fill:"none"}}),Object(K.jsx)("rect",{id:"boundsOutline"}),Object(K.jsx)("g",{id:"handleG",children:re.map((function(e){return Object(K.jsx)("circle",{className:e,r:"4"},e)}))}),Object(K.jsxs)("g",{id:"axisHandle",children:[Object(K.jsx)("line",{style:{strokeWidth:"2px",stroke:"#1ecb40"}}),Object(K.jsx)("rect",{style:{fill:"#1ecb40"}}),Object(K.jsx)("text",{style:{fill:"white",fontSize:"11px",pointerEvents:"none",fontWeight:"bold",alignmentBaseline:"middle",dominantBaseline:"middle"}})]}),Object(K.jsxs)("g",{id:"pathOutline",style:{stroke:"#1592e6",strokeWidth:2,fill:"none"},children:[Object(K.jsx)("path",{id:"pathSegments"}),Object(K.jsx)("path",{id:"pathVertices"})]}),Object(K.jsx)("g",{id:"gridGaps",children:Object(K.jsx)("rect",{})}),Object(K.jsx)("rect",{id:"rectSelectRegion"}),Object(K.jsx)("line",{id:"segment",className:"directSelected"}),Object(K.jsx)("rect",{id:"vertex",className:"directSelected"}),Object(K.jsx)("line",{id:"segmentPreview",className:"directSelectPreview"}),Object(K.jsx)("rect",{id:"vertexPreview",className:"directSelectPreview"})]})})),je=!1,me=!1,Oe=!1,Se=null,ke={},we={},Ce=function(e,t){var i=H(e.clientX,e.clientY),a=R.getState().canvas.selected;if(0===a.length)return N.hitTest(t,i[0],i[1]);var n=t.getItem(a[0]);if("axis"===n.type||"legend"===n.type)return N.hitTest(t,i[0],i[1]);for(var c=n.parent;c;){var r=N.hitTest(c,i[0],i[1]);if(r)return r;c=c.parent}return null},Ie=function(e,t,i,a,n,c){"axis"===e.type?("x"===e.channel||"width"===e.channel?e.pathY=a:"y"!==e.channel&&"height"!==e.channel||(e.pathX=i),R.dispatch(g({id:e.id,type:e.type,properties:{pathPosition:e.pathPosition}}))):(t.translate(e,n,c),R.dispatch(g({id:e.id,type:e.type,properties:{x:e.x,y:e.y}})))},Pe=!1,Te=!1,Be=!1,Re=!1,Me=!1,Ge=!1,Ee=!1,Ne=!1,Ue=!1;function De(e){return Object(K.jsxs)("svg",{id:"evtLayer",className:"canvas",onDoubleClick:function(t){if("Select"===R.getState().tool.activeTool)!function(e,t){var i=R.getState().canvas.selected;if(i.length>0){var a=t.getItem(i[0]);if(a&&"axis"!==a.type&&"legend"!==a.type&&a.children&&a.children.length>0){var n=H(e.clientX,e.clientY),c=N.hitTest(a,n[0],n[1]);c&&R.dispatch(y([c.id]))}}}(t,e.scene)},onMouseDown:function(t){switch(t.preventDefault(),R.getState().tool.activeTool){case"Select":!function(e,t){je=!0,le=e.clientX,se=e.clientY;var i=Ce(e,t);if(null!==i&&"legend"===i.type&&i.channel.indexOf("Color")>0&&"string"===i.fieldType){var a=H(e.clientX,e.clientY),n=i.pathHitTest(a[0],a[1]);if(null!==n){var c=n.dataScope.getFieldValue("category");return void R.dispatch(m({legend:i.id,value:c}))}}R.dispatch(m({legend:null,value:null})),Se=i,null===i&&0===e.button?me=!0:null!==i&&(ke[i.id]="axis"!==i.type||"y"!==i.channel&&"height"!==i.channel?i.x:i.pathX,we[i.id]="axis"!==i.type||"x"!==i.channel&&"width"!==i.channel?i.y:i.pathY)}(t,e.scene);break;case"Rect":!function(e,t){Te=!0;var i=H(e.clientX,e.clientY);pe=i[0],ue=i[1]}(t,e.scene);break;case"Ellipse":!function(e,t){Re=!0;var i=H(e.clientX,e.clientY);he=i[0],ye=i[1]}(t,e.scene);break;case"Ring":!function(e,t){Ge=!0;var i=H(e.clientX,e.clientY);ve=i[0],fe=i[1]}(t,e.scene);break;case"DirectSelect":!function(e,t){var i=H(e.clientX,e.clientY);N.inMarkHitTest(t,i[0],i[1],4)||(oe=e.clientX,de=e.clientY,Pe=!0)}(t,e.scene);break;case"Line":!function(e,t){Ne=!0;var i=H(e.clientX,e.clientY);be=i[0],ge=i[1]}(t,e.scene);break;case"Pen":e.scene}},onMouseMove:function(t){switch(t.preventDefault(),R.getState().tool.activeTool){case"Select":!function(e,t,i){if(je){if(me){var a=H(Math.min(le,e.clientX),Math.min(se,e.clientY)),n=a[0],c=a[1],r=Math.abs(e.clientX-le),l=Math.abs(e.clientY-se);R.dispatch(b({left:n,top:c,width:r,height:l}))}else if(Se){var s=R.getState().canvas.selected,o=s.indexOf(Se.id)>=0;if(0!==s.length&&o){if(o){Oe=!0;var d,p=Object(G.a)(R.getState().canvas.selected);try{for(p.s();!(d=p.n()).done;){var u=d.value,h=t.getItem(u);Ie(h,t,ke[h.id]+e.clientX-le,we[h.id]+e.clientY-se,ke[h.id]+e.clientX-le-h.x,we[h.id]+e.clientY-se-h.y)}}catch(f){p.e(f)}finally{p.f()}}}else R.dispatch(y([Se.id])),Oe=!0,Ie(Se,t,ke[Se.id]+e.clientX-le,we[Se.id]+e.clientY-se,ke[Se.id]+e.clientX-le-Se.x,we[Se.id]+e.clientY-se-Se.y)}}else{var v=Ce(e,t);v&&"axis"===v.type&&v.encoding?R.dispatch(j({axis:v.id,visible:!0})):R.dispatch(j({visible:!1}))}}(t,e.scene,e.renderer);break;case"Rect":!function(e,t){if(Te){Be=!0;var i,a,n,c,r=H(e.clientX,e.clientY),l=pe,s=r[0],o=ue,d=r[1];i=Math.min(l,s),a=Math.min(o,d),n=Math.abs(l-s),c=Math.abs(o-d),e.shiftKey&&(c=n=Math.min(n,c),i=l<s?l:l-n,a=o<d?o:o-c),M.select("#rectToolUI").style("visibility","visible").attr("x",i).attr("y",a).attr("width",n).attr("height",c)}}(t,e.scene);break;case"Ellipse":!function(e,t){if(Re){Me=!0;var i=H(e.clientX,e.clientY),a=he,n=i[0],c=ye,r=i[1],l=(a+n)/2,s=(c+r)/2,o=Math.min(Math.abs(a-n)/2,Math.abs(c-r)/2);M.select("#circleToolUI").style("visibility","visible").attr("cx",l).attr("cy",s).attr("r",o)}}(t,e.scene);break;case"Ring":!function(e,t){if(Ge){Ee=!0;var i=H(e.clientX,e.clientY),a=ve,n=i[0],c=fe,r=i[1],l=(a+n)/2,s=(c+r)/2,o=Math.min(Math.abs(a-n)/2,Math.abs(c-r)/2);M.select("#ringToolOuterUI").style("visibility","visible").attr("cx",l).attr("cy",s).attr("r",o),M.select("#ringToolInnerUI").style("visibility","visible").attr("cx",l).attr("cy",s).attr("r",2*o/3)}}(t,e.scene);break;case"DirectSelect":!function(e,t){if(Pe){var i=H(Math.min(oe,e.clientX),Math.min(de,e.clientY)),a=i[0],n=i[1],c=Math.abs(e.clientX-oe),r=Math.abs(e.clientY-de);R.dispatch(b({left:a,top:n,width:c,height:r}))}else{var l=H(e.clientX,e.clientY),s=N.hitTest(t,l[0],l[1]);s&&"axis"===s.type&&s.encoding?R.dispatch(j({axis:s.id,visible:!0})):R.dispatch(j({visible:!1}));var o=N.inMarkHitTest(t,l[0],l[1],4);R.dispatch(f(o?o.id:null))}}(t,e.scene);break;case"Line":!function(e,t){if(Ne){Ue=!0;var i,a,n=H(e.clientX,e.clientY);if(e.shiftKey){var c=180*Math.atan2(n[1]-ge,n[0]-be)/Math.PI,r=45*Math.round(c/45)*Math.PI/180,l=Math.sqrt(Math.pow(n[1]-ge,2)+Math.pow(n[0]-be,2));i=be+Math.cos(r)*l,a=ge+Math.sin(r)*l}else i=n[0],a=n[1];M.select("#lineToolUI").style("visibility","visible").attr("x1",be).attr("y1",ge).attr("x2",i).attr("y2",a)}}(t,e.scene);break;case"Pen":!function(e,t){if(0!==W.length){var i=H(e.clientX,e.clientY),a=W[W.length-1];if(e.shiftKey){var n=180*Math.atan2(i[1]-a[1],i[0]-a[0])/Math.PI,c=45*Math.round(n/45)*Math.PI/180,r=Math.sqrt(Math.pow(i[1]-a[1],2)+Math.pow(i[0]-a[0],2));X=a[0]+Math.cos(c)*r,_=a[1]+Math.sin(c)*r}else X=i[0],_=i[1];Math.sqrt(Math.pow(X-W[0][0],2)+Math.pow(_-W[0][1],2))<2&&W.length>2?M.select("#selectionUI").select("#vertexPreview").attr("x",W[0][0]-5).attr("y",W[0][1]-5).attr("width",10).attr("height",10).style("visibility","visible"):M.select("#selectionUI").select("#vertexPreview").style("visibility","hidden"),J()}}(t,e.scene)}},onMouseUp:function(t){switch(t.preventDefault(),R.getState().tool.activeTool){case"Select":!function(e,t){if(me){var i=H(Math.min(le,e.clientX),Math.min(se,e.clientY)),a=i[0],n=i[1],c=Math.abs(e.clientX-le),r=Math.abs(e.clientY-se);R.dispatch(b({left:a,top:n,width:0,height:0}));var l,s={left:a,top:n,width:c,height:r,right:a+c,bottom:n+r},o=N.rectHitTest(t,s).map((function(e){return e.id})),d=Object(G.a)(o);try{for(d.s();!(l=d.n()).done;){var p=l.value,u=t.getItem(p);ke[u.id]="axis"!==u.type||"y"!==u.channel&&"height"!==u.channel?u.x:u.pathX,we[u.id]="axis"!==u.type||"x"!==u.channel&&"width"!==u.channel?u.y:u.pathY}}catch(g){d.e(g)}finally{d.f()}R.dispatch(y(o))}else if(!Oe)if(null===Se)R.dispatch(y([]));else{var h,v=R.getState().canvas.selected,f=v.indexOf(Se.id)>=0;e.shiftKey&&!f?h=v.concat(Se.id):e.shiftKey&&f?(h=v.filter((function(e){return e!==Se.id})),ke[Se.id]="axis"!==Se.type||"y"!==Se.channel&&"height"!==Se.channel?Se.x:Se.pathX,we[Se.id]="axis"!==Se.type||"x"!==Se.channel&&"width"!==Se.channel?Se.y:Se.pathY):h=[Se.id],R.dispatch(y(h))}je=!1,me=!1,Oe=!1,Se=null}(t,e.scene);break;case"Rect":!function(e,t,i,a,n){Te=!1;var c=M.select("#rectToolUI");if(c.style("visibility","hidden"),Be){U(t,i,n);var r=t.mark("rect",{left:parseInt(c.attr("x")),top:parseInt(c.attr("y")),width:parseInt(c.attr("width")),height:parseInt(c.attr("height"))});R.dispatch(S(r.id)),R.dispatch(y([r.id])),a.render(t)}Be=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack);break;case"Ellipse":!function(e,t,i,a,n){Re=!1;var c=M.select("#circleToolUI");if(c.style("visibility","hidden"),Me){U(t,i,n);var r=t.mark("circle",{x:parseInt(c.attr("cx")),y:parseInt(c.attr("cy")),radius:parseInt(c.attr("r")),fillColor:"none"});R.dispatch(S(r.id)),R.dispatch(y([r.id])),a.render(t)}Me=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack);break;case"Ring":!function(e,t,i,a,n){Ge=!1;var c=M.select("#ringToolOuterUI");if(c.style("visibility","hidden"),M.select("#ringToolInnerUI").style("visibility","hidden"),Ee){U(t,i,n);var r=t.mark("ring",{x:parseInt(c.attr("cx")),y:parseInt(c.attr("cy")),outerRadius:parseInt(c.attr("r")),innerRadius:2*parseInt(c.attr("r"))/3,fillColor:"none"});R.dispatch(S(r.id)),R.dispatch(y([r.id])),a.render(t)}Ee=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack);break;case"Line":!function(e,t,i,a,n){Ne=!1;var c=M.select("#lineToolUI");if(c.style("visibility","hidden"),Ue){U(t,i,n);var r=t.mark("line",{x1:parseInt(c.attr("x1")),y1:parseInt(c.attr("y1")),x2:parseInt(c.attr("x2")),y2:parseInt(c.attr("y2"))});R.dispatch(S(r.id)),R.dispatch(y([r.id])),a.render(t)}Ue=!1}(0,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack);break;case"DirectSelect":!function(e,t,i){if(Pe){var a=H(Math.min(oe,e.clientX),Math.min(de,e.clientY)),n=a[0],c=a[1],r=Math.abs(e.clientX-oe),l=Math.abs(e.clientY-de);R.dispatch(b({left:n,top:c,width:0,height:0}));var s={left:n,top:c,width:r,height:l,right:n+r,bottom:c+l},o=N.inMarkRectHitTest(t,s,2);R.dispatch(v(o?o.id:null)),Pe=!1}else{var d=H(e.clientX,e.clientY),p=N.inMarkHitTest(t,d[0],d[1],4);R.dispatch(v(p?p.id:null))}}(t,e.scene);break;case"Pen":!function(e,t,i,a,n){if(void 0!==X&&void 0!==_)Math.sqrt(Math.pow(X-W[0][0],2)+Math.pow(_-W[0][1],2))<2&&W.length>2?(W.push([W[0][0],W[0][1]]),q(t,i,a,n)):(W.push([X,_]),J());else{var c=H(e.clientX,e.clientY);W.push([c[0],c[1]])}M.select("#selectionUI").select("#vertexPreview").style("visibility","hidden")}(t,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack);break;case"Text":!function(e,t,i,a,n){var c=H(e.clientX,e.clientY),r=N.hitTest(t,c[0],c[1]);if(!r&&"visible"===M.select("#textElement").style("visibility"))return M.select("#textElement").style("visibility","hidden"),void a.render(t);r&&"pointText"===r.type||(U(t,i,n),r=t.mark("text",{x:e.clientX,y:e.clientY,text:"",anchor:["left","top"]}),R.dispatch(S(r.id)),a.render(t)),M.select("#textElement").style("visibility","visible").style("left",r.bounds.left+"px").style("top",r.bounds.top-1+"px").property("value",r.text).style("font-family",r.fontFamily).style("font-size",r.fontSize+"px").style("font-weight",r.fontWeight).style("height",r.bounds.height).on("input",(function(e){r.text=M.select("#textElement").property("value")})),document.getElementById("textElement").focus()}(t,e.scene,e.datasets,e.renderer,e.undoStack,e.updateUndoStack)}},children:[Object(K.jsx)(xe,{scene:e.scene,renderer:e.renderer}),Object(K.jsx)("rect",{id:"rectToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}}),Object(K.jsx)("circle",{id:"circleToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}}),Object(K.jsx)("line",{id:"lineToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden"}}),Object(K.jsx)("path",{id:"polylineToolUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden"}}),Object(K.jsx)("circle",{id:"ringToolOuterUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}}),Object(K.jsx)("circle",{id:"ringToolInnerUI",style:{stroke:"#1592e6",strokeWidth:"1.5px",visibility:"hidden",fillOpacity:"0"}})]})}i(192);var Ae=i(313),Fe=i(140),Le=i(102),ze=["Select","DirectSelect","Line","Rect","Ellipse","Ring","Pen","Text"],Ye=N.renderer("svg","preview"),He=N.scene(),Ve=function(e,t){var i={};if(!e)return i;if(e.dataScope)i[e.dataScope.dataTable.id]=e.dataScope.dataTable;else{var a,n=Object(G.a)(t);try{for(n.s();!(a=n.n()).done;){var c=a.value;i[c.id]=c}}catch(r){n.e(r)}finally{n.f()}}return i},We=function(e,t){if("Divide"===t)switch(e){default:return["horizontal","vertical"];case"circle":return["angular","radial"];case"ring":return["angular"];case"pie":return["radial"]}else if("Densify"===t)return["horizontal","vertical"]};var Xe=Object(d.b)((function(e){return{activeTool:e.tool.activeTool,selected:e.canvas.selected,undoStackChanged:e.canvas.undoStackChanged,redoStackChanged:e.canvas.redoStackChanged}}))((function(e){var t=Object(d.c)(),i=Object(a.useRef)(null),n=Object(a.useState)(!1),c=Object(o.a)(n,2),r=c[0],l=c[1],s=Object(a.useState)(null),p=Object(o.a)(s,2),u=p[0],h=p[1],f=Object(a.useState)({}),b=Object(o.a)(f,2),g=b[0],x=b[1],j=Object(a.useState)([]),m=Object(o.a)(j,2),S=m[0],k=m[1],I=Object(a.useState)([]),P=Object(o.a)(I,2),B=P[0],G=P[1],E=Object(a.useState)(""),D=Object(o.a)(E,2),A=D[0],F=D[1],L=function(i){switch(M.select("#textElement").style("visibility","hidden"),e.renderer.render(e.scene),i){case"Rect":case"Ellipse":case"Line":case"Ring":case"Pen":t(v(null)),t(y([])),M.select("#evtLayer").style("cursor","crosshair");break;case"Select":M.select("#evtLayer").style("cursor","default"),t(v(null));break;case"DirectSelect":M.select("#evtLayer").style("cursor","default"),t(y([]));break;default:M.select("#evtLayer").style("cursor","default")}t(T(i))},z=function(){if(!M.select("#preview").empty()){He.clear();var t=e.scene.getItem(e.selected[0]),i=g[M.select("#datasetSelect").property("value")],a=M.select("#fieldSelect").property("value");if(t&&u&&a&&i){var n=t.duplicate();if("none"===n.fillColor&&(n.fillColor="#f5f5f5"),n.strokeColor="#222",He.addChild(n),"Repeat"===u){var c=He.repeat(n,i,{field:a,layout:Y(n,i.getUniqueFieldValues(a).length)}),r=[c.bounds.left-2,c.bounds.top-2,c.bounds.width+4,c.bounds.height+4].join(" ");M.select("#preview").attr("viewBox",r)}else if("Divide"===u){n.strokeWidth=Math.max(n.strokeWidth,1);var l=M.select("#orientationSelect").property("value"),s=He.divide(n,i,{field:a,orientation:l}),o=[s.bounds.left-2,s.bounds.top-2,s.bounds.width+4,s.bounds.height+4].join(" ");M.select("#preview").attr("viewBox",o)}else if("Densify"===u){n.strokeWidth=Math.max(n.strokeWidth,1);var d=M.select("#orientationSelect").property("value"),p=He.densify(n,i,{field:a,orientation:d});He.setProperties(p,{vxShape:"rect",vxWidth:4,vxHeight:4,vxStrokeColor:"#1592e6",vxStrokeWidth:1});var h=[p.bounds.left-2,p.bounds.top-2,p.bounds.width+4,p.bounds.height+4].join(" ");M.select("#preview").attr("viewBox",h)}Ye.clear(),Ye.render(He)}}},H=function(){if(0!==e.selected.length&&u){var t,i=e.scene.getItem(e.selected[0]),a=g[M.select("#datasetSelect").property("value")],n=M.select("#fieldSelect").property("value"),c=a.getUniqueFieldValues(n),r="";if(t=i.dataScope?i.dataScope.getUniqueFieldValues(n).length:c.length,"Repeat"===u)r=[t,i.type+"s","will be created,"].join(" ");else if("Divide"===u)r=["Divide the",i.type,"into",t,"parts,"].join(" ");else if("Densify"===u){if("rect"===i.type)r=["Densify the","horizontal"===M.select("#orientationSelect").property("value")?"top/bottom side":"left/right side","of the rect with",t,"vertices,"].join(" ");else r=["Densify the",i.type,"with",t,"vertices, one for each"].join(" ")}M.select("#msg").text(r)}else F("")};return Object(a.useEffect)((function(){M.selectAll(".iconBtn").classed("active",!1),M.select("#"+e.activeTool+"Btn").classed("active",!0)}),[e.activeTool]),Object(a.useEffect)((function(){var e=document.getElementById("fieldSelect");if(e){var t=new CustomEvent("change",{bubbles:!0,cancelable:!1});e.dispatchEvent(t)}}),[S]),Object(a.useEffect)((function(){if(0===e.selected.length)return M.select("#repeatBtn").property("disabled",!0),M.select("#divideBtn").property("disabled",!0),void M.select("#densifyBtn").property("disabled",!0);var t=e.scene.getItem(e.selected[0]);M.select("#repeatBtn").property("disabled",!t||!Object(N.canRepeat)(t)||0===e.datasets.length),M.select("#divideBtn").property("disabled",!t||!Object(N.canDivide)(t)||0===e.datasets.length),M.select("#densifyBtn").property("disabled",!t||!Object(N.canDensify)(t)||0===e.datasets.length)}),[e.selected,e.scene,e.datasets]),Object(a.useEffect)((function(){M.select("#undoBtn").property("disabled",e.undoStackChanged.length<=0)}),[e.undoStackChanged]),Object(a.useEffect)((function(){M.select("#redoBtn").property("disabled",e.redoStackChanged.length<=0)}),[e.redoStackChanged]),Object(a.useEffect)((function(){M.select("#undoBtn").property("disabled",e.undoStack.length<=0),M.select("#redoBtn").property("disabled",e.redoStack.length<=0)}),[e.undoStack,e.redoStack]),Object(K.jsxs)("div",{children:[Object(K.jsxs)("div",{className:"myToolBar",children:[Object(K.jsxs)("div",{className:"myBtnGroup",children:[Object(K.jsx)("button",{className:"myTextBtn",id:"openBtn",onClick:function(e){i.current.click()},children:"Open"},"open"),Object(K.jsx)("input",{type:"file",id:"scnFile",ref:i,style:{display:"none"},accept:".alscn",onChange:function(t){t.stopPropagation(),t.preventDefault();var i=t.target.files[0],a=new FileReader;a.onload=function(){e.loadScene(JSON.parse(a.result)),e.resetStacks()},a.readAsText(i)}}),Object(K.jsx)("button",{className:"myTextBtn",id:"saveBtn",onClick:function(t){var i=e.scene.getDataTables(),a=Object.values(i).length>0?Object.values(i)[0].name+".diproject":"visualization.diproject",n=JSON.stringify(e.scene.toJSON());Object(Le.saveAs)(new Blob([n],{type:"text/plain;charset=utf-8"}),a)},children:"Save"},"save"),Object(K.jsx)("button",{className:"myTextBtn",id:"exportBtn",onClick:function(t){var i=document.getElementById("canvas"),a=(new XMLSerializer).serializeToString(i);a.match(/^<svg[^>]+xmlns="http:\/\/www\.w3\.org\/2000\/svg"/)||(a=a.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),a.match(/^<svg[^>]+"http:\/\/www\.w3\.org\/1999\/xlink"/)||(a=a.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),a='<?xml version="1.0" standalone="no"?>\r\n'+a;var n=e.scene.getDataTables(),c=Object.values(n).length>0?Object.values(n)[0].name+".svg":"visualization.svg";Object(Le.saveAs)(new Blob([a],{type:"text/plain;charset=utf-8"}),c)},children:"Export"},"export")]}),Object(K.jsxs)("div",{className:"myBtnGroup",children:[Object(K.jsx)("button",{className:"myTextBtn",id:"undoBtn",onClick:function(t){if(0!==e.undoStack.length){U(e.scene,e.datasets,e.redoStack,"redo");var i=e.undoStack.pop();e.loadScene(JSON.parse(i)),R.dispatch(w({length:e.undoStack.length}))}},children:"Undo"},"undo"),Object(K.jsx)("button",{className:"myTextBtn",id:"redoBtn",onClick:function(t){if(0!==e.redoStack.length){U(e.scene,e.datasets,e.undoStack);var i=e.redoStack.pop();e.loadScene(JSON.parse(i)),R.dispatch(C({length:e.redoStack.length}))}},children:"Redo"},"redo")]}),Object(K.jsx)("div",{className:"myBtnGroup",children:ze.map((function(e){return Object(K.jsx)("button",{className:"iconBtn",title:e,id:e+"Btn",tool:e,onClick:function(e){return L(e.target.getAttribute("tool"))}},e)}))}),Object(K.jsxs)("div",{className:"myBtnGroup",children:[Object(K.jsx)("button",{className:"myTextBtn",id:"repeatBtn",onClick:function(t){if(L("Select"),0!==e.selected.length){h("Repeat"),l(!0);var i=e.scene.getItem(e.selected[0]),a=Ve(i,e.datasets);x(a);var n=i.firstChild&&i.firstChild.dataScope?i.firstChild.dataScope.fields:[],c=a[Object.keys(a)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),k(c)}},children:"Repeat"},"repeat"),Object(K.jsx)("button",{className:"myTextBtn",id:"divideBtn",onClick:function(t){if(L("Select"),0!==e.selected.length){h("Divide"),l(!0);var i=e.scene.getItem(e.selected[0]);G(We(i.type,"Divide"));var a=Ve(i,e.datasets);x(a);var n=i.dataScope?i.dataScope.fields:[],c=a[Object.keys(a)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),k(c)}},children:"Divide"},"divide"),Object(K.jsx)("button",{className:"myTextBtn",id:"densifyBtn",onClick:function(t){if(L("Select"),0!==e.selected.length){h("Densify"),l(!0);var i=e.scene.getItem(e.selected[0]);G(We(i.type,"Densify"));var a=Ve(i,e.datasets);x(a);var n=i.dataScope?i.dataScope.fields:[],c=a[Object.keys(a)[0]].nonNumericFields.concat(["atlas_rowId"]);c=c.filter((function(e){return n.indexOf(e)<0})),k(c)}},children:"Densify"},"densify")]})]}),Object(K.jsxs)(Ae.a,{show:r,onShow:function(e){z(),H()},backdrop:"static",keyboard:!1,children:[Object(K.jsx)(Ae.a.Header,{children:Object(K.jsx)(Ae.a.Title,{children:u})}),Object(K.jsxs)(Ae.a.Body,{children:[Object(K.jsxs)("div",{style:{clear:"both",marginBottom:"10px"},children:[Object(K.jsx)("div",{id:"msg",style:{clear:"both",marginBottom:"7px",display:"block"},children:A}),"one for each ",Object(K.jsx)("select",{id:"fieldSelect",onChange:function(e){z(),H()},style:{marginLeft:"8px"},children:S.map((function(e){return Object(K.jsx)("option",{value:e,children:"atlas_rowId"===e?"row of data":e},e)}))}),Object(K.jsxs)("div",{style:{marginTop:"12px",clear:"left"},children:["from dataset",Object(K.jsx)("select",{id:"datasetSelect",onChange:function(e){k(g[e.target.value].nonNumericFields)},style:{marginLeft:"7px"},children:Object.values(g).map((function(e){return Object(K.jsx)("option",{value:e.id,children:e.name},e.id)}))})]}),Object(K.jsxs)("div",{style:{marginTop:"15px",display:"Repeat"===u||"Densify"===u&&e.selected[0]&&"rect"!==e.scene.getItem(e.selected[0]).type?"none":"block"},children:["Orientation",Object(K.jsx)("select",{id:"orientationSelect",onChange:function(e){z()},style:{marginLeft:"7px"},children:B.map((function(e){return Object(K.jsx)("option",{value:e,children:e},e)}))})]})]}),Object(K.jsx)("svg",{id:"preview",style:{width:"470px",height:"180px",border:"solid 0px #ddd",padding:"5px"}})]}),Object(K.jsxs)(Ae.a.Footer,{children:[Object(K.jsx)(Fe.a,{variant:"secondary",onClick:function(e){l(!1)},children:"Cancel"}),Object(K.jsx)(Fe.a,{variant:"primary",onClick:function(){if(l(!1),U(e.scene,e.datasets,e.undoStack),"Repeat"===u){var t=e.scene.getItem(e.selected[0]);R.dispatch(y([]));var i=g[M.select("#datasetSelect").property("value")],a=M.select("#fieldSelect").property("value"),n=Y(t,i.getUniqueFieldValues(a).length),c=e.scene.repeat(t,i,{field:a,layout:n});1===n.numCols?e.scene.axis("y",a,{item:t}):1===n.numRows&&e.scene.axis("x",a,{item:t}),e.scene.reCreateRelatedAxes(c),R.dispatch(y([c.id])),R.dispatch(O({}))}else if("Divide"===u){var r=e.scene.getItem(e.selected[0]);R.dispatch(y([]));var s=g[M.select("#datasetSelect").property("value")],o=M.select("#fieldSelect").property("value"),d=M.select("#orientationSelect").property("value"),p=e.scene.divide(r,s,{field:o,orientation:d});R.dispatch(y([p.id])),R.dispatch(O({}))}else if("Densify"===u){var h=e.scene.getItem(e.selected[0]);R.dispatch(y([]));var v=g[M.select("#datasetSelect").property("value")],f=M.select("#fieldSelect").property("value"),b=M.select("#orientationSelect").property("value"),x=e.scene.densify(h,v,{field:f,orientation:b});R.dispatch(y([x.id])),R.dispatch(O({}))}},children:"OK"})]})]})]})})),_e=(i(193),i(77)),Je=i(312),qe=i(314),Ke=i(315),Ze={};for(var Qe in E){var $e=[];for(var et in E[Qe]){var tt,it=Object(G.a)(E[Qe][et].class);try{for(it.s();!(tt=it.n()).done;){var at=tt.value;$e.indexOf(at)<0&&$e.push(at)}}catch(kt){it.e(kt)}finally{it.f()}}Ze[Qe]=$e}var nt=function(e,t,i){if(M.select("#"+e.id).style("padding-left","3px"),M.select("#"+e.id+"ScaleBtn").style("display","none"),e.accessor){var a,n=t,c=Object(G.a)(e.accessor);try{for(c.s();!(a=c.n()).done;){n=n[a.value]}}catch(kt){c.e(kt)}finally{c.f()}"numeric"===e.type&&(n=n.toFixed(1)),"color"===e.type?M.select("#"+e.id).style("background",n).property("value",n):"boolean"===e.type?M.select("#"+e.id).property("checked",n):M.select("#"+e.id).property("value",n).property("disabled","area"===e.channel)}if(e.channel){var r;r="width"===e.channel||"height"===e.channel||"area"===e.channel||"radius"===e.channel?i.sizeBound(t,e.channel):"x"===e.channel||"y"===e.channel?i.positionBound(t,e.channel):i.getEncodingByItem(t,e.channel);var l="segment"===t.type?t.parent.dataScope:"vertex"===t.type&&t.parent.dataScope||t.dataScope;if(r)if(r.channel===e.channel){M.select("#"+e.id).property("value",r.field).property("disabled",!0).style("pointer-events","none"),M.select("#"+e.id+"UnencodeBtn").style("display","inline-block").on("click",(function(e){i.removeEncoding(r);var a={};a[r.channel]=!0,R.dispatch(g({id:t.id,type:t.type,properties:a}))})),M.select("#"+e.id+"EncodeBtn").style("display","none"),("numeric"===e.type&&["linear","sqrt","log","power"].indexOf(r.scale.type)>=0||"color"===e.type&&["sequentialColor","divergingColor"].indexOf(r.scale.type)>=0)&&(M.select("#"+e.id).style("padding-left","23px"),M.select("#"+e.id+"ScaleBtn").style("display","inline-block"))}else{var s="vertex"===r.anyItem.type||"segment"===r.anyItem.type?"[see "+r.anyItem.type+"]":"[see "+r.channel+"]";M.select("#"+e.id).property("value",s).property("disabled",!0).style("pointer-events","none"),M.select("#"+e.id+"UnencodeBtn").style("display","none"),M.select("#"+e.id+"EncodeBtn").style("display","none")}else if(l){var o="Segment Position"===e.group||"Vertex Position"===e.group;M.select("#"+e.id).property("disabled",o).style("pointer-events","all"),M.select("#"+e.id+"UnencodeBtn").style("display","none"),M.select("#"+e.id+"EncodeBtn").style("display","inline-block")}else{var d="Segment Position"===e.group||"Vertex Position"===e.group;M.select("#"+e.id).property("disabled",d).style("pointer-events","all"),M.select("#"+e.id+"UnencodeBtn").style("display","none"),M.select("#"+e.id+"EncodeBtn").style("display","none")}}if("layoutType"===e.id){var p=t.layout?t.layout.type:"none";M.select("#"+e.id).property("value",p),M.selectAll(".layout-prop").style("display","none"),M.selectAll("."+p+"-prop").style("display","inline-block");var u=M.select("#"+e.id).selectAll("option"),h=t.firstChild.type,y=[];"rect"===h?(y.push("packing"),i.getEncodingByItem(t.firstChild,"area")||y.push("treemap")):"circle"===h?y.push("treemap"):"collection"===h&&(y=y.concat(["packing","treemap"])),u.property("disabled",(function(e,t){var i=M.select(this).property("value");return y.indexOf(i)>=0}));var v,f=e.options.filter((function(e){return e.value===p}))[0].parameters,b=Object(G.a)(f);try{for(b.s();!(v=b.n()).done;){var x=v.value,j=E.Layout[x],m=t.layout[j.accessor[0]];"numeric-integer"===j.type?m=m.toFixed(0):"numeric"===j.type&&(m=m.toFixed(1)),M.select("#"+j.id).property("value",m),M.select("#"+j.id+"ScaleBtn").style("display","none")}}catch(kt){b.e(kt)}finally{b.f()}}if("axisOrientation"===e.id){var O=M.select("#"+e.id).selectAll("option");"x"===t.channel||"width"===t.channel?O.property("disabled",(function(e,t){var i=M.select(this).property("value");return"top"!==i&&"bottom"!==i})):"y"===t.channel||"height"===t.channel?O.property("disabled",(function(e,t){var i=M.select(this).property("value");return"left"!==i&&"right"!==i})):O.property("disabled",!0)}if("baseline"===e.id){var S=M.select("#"+e.id).selectAll("option"),k=t.orientation;"horizontal"===k?S.property("disabled",(function(e,t){var i=M.select(this).property("value");return"top"!==i&&"middle"!==i&&"bottom"!==i})):"vertical"===k?S.property("disabled",(function(e,t){var i=M.select(this).property("value");return"left"!==i&&"center"!==i&&"right"!==i})):S.property("disabled",!0)}"vxShape"===e.id&&ct()},ct=function(){var e=M.select("#vxShape").property("value");"rect"===e?(M.select("#vxRadius_row").style("display","none"),M.select("#vxWidth_row").style("display","inline-block"),M.select("#vxHeight_row").style("display","inline-block")):"circle"===e&&(M.select("#vxRadius_row").style("display","inline-block"),M.select("#vxWidth_row").style("display","none"),M.select("#vxHeight_row").style("display","none"))};var rt=Object(d.b)((function(e){return{selected:e.canvas.selected,directSelected:e.canvas.directSelected,itemUpdated:e.canvas.itemUpdated}}))((function(e){var t=Object(a.useState)("#fff"),i=Object(o.a)(t,2),c=i[0],r=i[1],l=Object(a.useState)(null),s=Object(o.a)(l,2),d=s[0],p=s[1],u=Object(a.useState)(null),h=Object(o.a)(u,2),y=h[0],v=h[1],f=Object(a.useState)({}),b=Object(o.a)(f,2),x=b[0],m=b[1];Object(a.useEffect)((function(){m({})}),[e.scene]),Object(a.useEffect)((function(){if(null!==d){var t="canvasFillColor"===d.id?e.scene:e.selected.length>0?e.scene.getItem(e.selected[0]):e.directSelected?e.scene.getItem(e.directSelected):null;if(null!==t){var i=t[d.accessor];r(i||"#fff"),M.select("#colorPicker").style("display","block")}}else M.select("#colorPicker").style("display","none")}),[d,e.scene,e.selected,e.directSelected]),Object(a.useEffect)((function(){if(null!==d){if(M.select("#"+d.id).style("background",c).property("value",c),"canvasFillColor"===d.id)e.scene[d.accessor]=c;else if(e.selected.length>0){var t=e.scene.getItem(e.selected[0]);if("axis"===t.type||"gridlines"===t.type||"legend"===t.type)t[d.accessor]=c;else{var i={};i[d.accessor]=c,e.scene.setProperties(t,i)}}else if(e.directSelected){var a=e.scene.getItem(e.directSelected),n={};n[d.accessor]=c,e.scene.setProperties(a,n)}e.renderer.render(e.scene)}}),[c,d,e.scene,e.selected,e.directSelected,e.renderer]),Object(a.useEffect)((function(){if(e.itemUpdated.id&&"inspector"!==e.itemUpdated.source){var t=e.scene.getItem(e.itemUpdated.id);if(void 0!==t)for(var i in e.itemUpdated.properties){var a=V(t.type,i);a&&nt(a,t,e.scene)}}}),[e.scene,e.itemUpdated]),Object(a.useEffect)((function(){var t,i=e.selected.length>0?e.scene.getItem(e.selected[0]):void 0;if(i){t=i.type;var a=e.scene.getItem(e.selected[0]);a.dataScope?v(a.dataScope.dataTable):v(null)}else t="canvas",i=e.scene,v(null);var n=M.select(".propertyPanel");if(n.selectAll(".propertyGroupHeader").style("display","none"),n.selectAll(".propertyRow").style("display","none"),i)for(var c in n.selectAll("."+t+"-prop").style("display","inline-block"),E)for(var r in E[c])E[c][r].class.indexOf(t+"-prop")>=0&&nt(E[c][r],i,e.scene)}),[e.scene,e.selected]),Object(a.useEffect)((function(){if(e.directSelected){var t=e.scene.getItem(e.directSelected);t.dataScope?v(t.dataScope.dataTable):t.parent.dataScope?v(t.parent.dataScope.dataTable):v(null)}else v(null);var i=M.select(".propertyPanel");if(i.selectAll(".propertyGroupHeader").style("display","none"),i.selectAll(".propertyRow").style("display","none"),e.directSelected){var a=e.scene.getItem(e.directSelected),n=a.type;for(var c in i.selectAll("."+n+"-prop").style("display","inline-block"),E)for(var r in E[c])E[c][r].class.indexOf(n+"-prop")>=0&&nt(E[c][r],a,e.scene)}}),[e.scene,e.directSelected]);var O=function(t){var i=M.select("#"+t.id);if(!i.empty()){var a=i.property("value"),n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);if(void 0!==n){U(e.scene,e.datasets,e.undoStack);var c={};switch(t.id){case"axisOrientation":n[t.accessor[0]]=a,c[t.accessor[0]]=a;break;case"orientation":case"horzGravity":case"vertGravity":c[t.accessor[0]]=a,e.scene.setProperties(n.layout,c),e.scene.reCreateRelatedAxes(n);break;case"layoutType":var r;c.layout=a,n.id in x||(x[n.id]=[]),x[n.id].unshift(n.layout),x[n.id].length>0&&(r=x[n.id].find((function(e){return e&&e.type===a}))),r||(r=function(e){switch(e){case"stack":return N.layout("stack",{orientation:"vertical"});case"packing":return N.layout("packing");case"none":return;default:return N.layout("grid",{numRows:1})}}(a)),e.scene.setProperties(n,{layout:r}),nt(t,n,e.scene);break;case"vxShape":c[t.accessor[0]]=a,e.scene.setProperties(n,c),ct();break;default:c[t.accessor[0]]=a,e.scene.setProperties(n,c)}R.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}},k=function(t){var i=M.select("#"+t.id);if(!i.empty()){var a=parseFloat(i.property("value"));if(!isNaN(a)&&!("rowGap"!==t.id&&"colGap"!==t.id&&a<0)){"numeric-integer"===t.type&&(a=parseInt(a));var n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);U(e.scene,e.datasets,e.undoStack);var c={};switch(t.id){case"strokeWidth":case"width":case"height":case"area":case"fontSize":case"vxWidth":case"vxHeight":case"vxRadius":case"vxOpacity":case"vxStrokeWidth":case"opacity":case"radius":case"innerRadius":case"outerRadius":c[t.channel]=a,e.scene.setProperties(n,c);break;case"rowGap":case"colGap":case"numRows":case"numCols":n.layout&&(c[t.id]=a,e.scene.setProperties(n.layout,c));break;case"tickOffset":case"labelOffset":case"tickSize":case"pathPos":case"gridlineStrokeWidth":c[t.accessor[0]]=a,n[t.accessor[0]]=a;break;case"x":case"collectionX":case"glyphX":e.scene.translate(n,a-n.x,0);break;case"y":case"collectionY":case"glyphY":e.scene.translate(n,0,a-n.y)}R.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}},w=function(t,i,a){var n;if(e.selected.length>=1?n=e.scene.getItem(e.selected[0]):e.directSelected&&(n=e.scene.getItem(e.directSelected)),n){var c;U(e.scene,e.datasets,e.undoStack),"x"!==i&&"y"!==i||"area"===n.type||"collection"!==n.parent.type||!n.parent.layout||e.scene.setProperties(n.parent,{layout:void 0}),e.scene.encode(n,{field:t,channel:i,scale:a}),a?e.scene.reCreateRelatedAxes(n):i.indexOf("Color")>0?c=e.scene.legend(i,t):"width"!==i&&"height"!==i&&"x"!==i&&"y"!==i||(c=e.scene.axis(i,t,{item:n}));var r={};r[i]="encoded",R.dispatch(g({id:n.id,type:n.type,properties:r})),c&&R.dispatch(S(c.id))}},C=function(t,i){var a,n=Object(G.a)(e.scene.children);try{for(n.s();!(a=n.n()).done;){var c=a.value;if("axis"===c.type&&c.encoding&&c.encoding.scale===t)return void R.dispatch(j({axis:c.id,visible:i}))}}catch(kt){n.e(kt)}finally{n.f()}},I=function(e){return Object(K.jsx)("input",{id:e.id,onChange:function(t){return k(e)}})},P=function(t){return Object(K.jsx)("input",{type:"text",id:t.id,onInput:function(i){return function(t){var i=M.select("#"+t.id);if(!i.empty()){var a=i.property("value"),n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);U(e.scene,e.datasets,e.undoStack);var c={};"labelFormat"===t.id&&(c[t.accessor[0]]=a,n[t.accessor[0]]=a),R.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}(t)}})},T=function(t){return Object(K.jsx)("input",{type:"checkbox",id:t.id,onChange:function(i){return function(t){var i=M.select("#"+t.id);if(!i.empty()){U(e.scene,e.datasets,e.undoStack);var a=i.property("checked"),n=e.selected.length>0?e.scene.getItem(e.selected[0]):e.scene.getItem(e.directSelected);n[t.accessor[0]]=a;var c={};c[t.accessor[0]]=a,R.dispatch(g({id:n.id,type:n.type,properties:c,source:"inspector"}))}}(t)}})},B=n.a.forwardRef((function(e,t){var i=e.children,a=e.onClick;return Object(K.jsx)("button",{className:"dropdown-item dropdown-toggle encodeFields",href:"",ref:t,onClick:function(e){e.preventDefault(),a(e)},children:"  "+i})})),D=function(t,i){var a="propertyRow "+i.class.join(" ");return Object(K.jsxs)("tr",{className:a,id:i.id+"_row",children:[Object(K.jsx)("td",{className:"propertyName",children:t}),Object(K.jsxs)("td",{className:"propertyInput",children:[Object(K.jsxs)(Je.a,{id:i.id+"ScaleBtn",className:"scaleBtnDiv",children:[Object(K.jsx)(Je.a.Toggle,{className:"scaleBtn",variant:"link",bsPrefix:"p-0"}),Object(K.jsx)(Je.a.Menu,{className:"scaleMenu",children:Object(K.jsx)("div",{children:Object(K.jsxs)(qe.a,{children:[Object(K.jsx)(qe.a.Group,{style:{margin:"0 10px 0 10px",display:t.indexOf("Color")<0?"block":"none"},children:Object(K.jsxs)(Ke.a,{direction:"horizontal",gap:1,children:[Object(K.jsx)(qe.a.Label,{className:"scaleMenuLabel",children:"Scale type"}),Object(K.jsxs)(qe.a.Select,{defaultValue:L(i.channel,e.selected,e.directSelected,e.scene),onChange:function(t){return function(t,i){var a;if(e.selected.length>=1?a=e.scene.getItem(e.selected[0]):e.directSelected&&(a=e.scene.getItem(e.directSelected)),a){U(e.scene,e.datasets,e.undoStack);var n=e.scene.getEncodingByItem(a,t);if(n){n.scale.type=i,e.scene.reCreateRelatedAxes(a);var c={};c[t]="scaleType",R.dispatch(g({id:a.id,type:a.type,properties:c}))}}}(i.channel,t.target.value)},size:"sm",children:[Object(K.jsx)("option",{value:"linear",children:"Linear"}),Object(K.jsx)("option",{value:"log",children:"Log"}),Object(K.jsx)("option",{value:"sqrt",children:"Square Root"}),Object(K.jsx)("option",{value:"power",children:"Power (2)"})]})]})}),Object(K.jsx)(qe.a.Group,{style:{margin:"0 10px 0 10px",display:A(i.channel,e.selected,e.directSelected,e.scene)?"block":"none"},children:Object(K.jsxs)(Ke.a,{direction:"horizontal",gap:1,children:[Object(K.jsx)(qe.a.Label,{className:"scaleMenuLabel",children:"Aggregator"}),Object(K.jsxs)(qe.a.Select,{defaultValue:A(i.channel,e.selected,e.directSelected,e.scene),onChange:function(t){return function(t,i){var a;if(e.selected.length>=1?a=e.scene.getItem(e.selected[0]):e.directSelected&&(a=e.scene.getItem(e.directSelected)),a){U(e.scene,e.datasets,e.undoStack);var n=e.scene.getEncodingByItem(a,t);if(n){n.aggregator=i,e.scene.reCreateRelatedAxes(a);var c={};c[t]="aggregator",R.dispatch(g({id:a.id,type:a.type,properties:c}))}}}(i.channel,t.target.value)},size:"sm",children:[Object(K.jsx)("option",{value:"sum",children:"Sum"}),Object(K.jsx)("option",{value:"avg",children:"Average"}),Object(K.jsx)("option",{value:"max",children:"Maximum"}),Object(K.jsx)("option",{value:"min",children:"Minimum"}),Object(K.jsx)("option",{value:"median",children:"Median"}),Object(K.jsx)("option",{value:"count",children:"Count"})]})]})}),Object(K.jsx)(qe.a.Group,{style:{margin:"0 10px 0 10px",display:t.indexOf("Color")>0?"block":"none"},children:Object(K.jsxs)(Ke.a,{direction:"horizontal",gap:1,children:[Object(K.jsx)(qe.a.Label,{className:"scaleMenuLabel",children:"Color Scheme"}),Object(K.jsxs)(qe.a.Select,{defaultValue:F(i.channel,e.selected,e.directSelected,e.scene),onChange:function(t){return function(t,i){var a;if(e.selected.length>=1?a=e.scene.getItem(e.selected[0]):e.directSelected&&(a=e.scene.getItem(e.directSelected)),a){U(e.scene,e.datasets,e.undoStack);var n=e.scene.getEncodingByItem(a,t);if(n){n.scale.scheme=i,e.scene.reCreateRelatedLegends(a);var c={};c[t]="scheme",R.dispatch(g({id:a.id,type:a.type,properties:c}))}}}(i.channel,t.target.value)},size:"sm",children:[Object(K.jsx)("option",{value:"interpolateTurbo",children:"turbo"}),Object(K.jsx)("option",{value:"interpolateViridis",children:"Viridis"}),Object(K.jsx)("option",{value:"interpolateInferno",children:"Inferno"}),Object(K.jsx)("option",{value:"interpolateMagma",children:"Magma"}),Object(K.jsx)("option",{value:"interpolatePlasma",children:"Plasma"}),Object(K.jsx)("option",{value:"interpolateCividis",children:"Cividis"}),Object(K.jsx)("option",{value:"interpolateWarm",children:"Warm"}),Object(K.jsx)("option",{value:"interpolateCool",children:"Cool"}),Object(K.jsx)("option",{value:"interpolateCubehelixDefault",children:"CubehelixDefault"}),Object(K.jsx)("option",{value:"interpolateBuGn",children:"Blue-Green"}),Object(K.jsx)("option",{value:"interpolateBuPu",children:"Blue-Purple"}),Object(K.jsx)("option",{value:"interpolateGnBu",children:"Green-Blue"}),Object(K.jsx)("option",{value:"interpolateOrRd",children:"Orange-Red"}),Object(K.jsx)("option",{value:"interpolatePuBuGn",children:"Purple-Blue-Green"}),Object(K.jsx)("option",{value:"interpolatePuBu",children:"Purple-Blue"}),Object(K.jsx)("option",{value:"interpolatePuRd",children:"Purple-Red"}),Object(K.jsx)("option",{value:"interpolateRdPu",children:"Red-Purple"}),Object(K.jsx)("option",{value:"interpolateYlGnBu",children:"Yellow-Green-Blue"}),Object(K.jsx)("option",{value:"interpolateYlGn",children:"Yellow-Green"}),Object(K.jsx)("option",{value:"interpolateYlOrBr",children:"Yellow-Orange-Brown"}),Object(K.jsx)("option",{value:"interpolateYlOrRd",children:"Yellow-Orange-Red"})]})]})})]})})})]}),function(){switch(i.type){default:return I(i);case"numeric-range":return e=i,Object(K.jsxs)("div",{className:"propertySliderDiv",children:[Object(K.jsx)("input",{type:"range",min:e.range[0],max:e.range[1],step:(e.range[1]-e.range[0])/10,className:"propertySlider",id:e.id,onChange:function(t){return k(e)}}),Object(K.jsxs)("div",{className:"propertySliderMarks",children:[Object(K.jsx)("div",{style:{margin:0,float:"left"},children:e.range[0]}),Object(K.jsx)("div",{style:{margin:0,float:"right"},children:e.range[1]})]})]});case"color":return function(e){return Object(K.jsx)("input",{id:e.id,onClick:function(t){p(e),t.stopPropagation()}})}(i);case"categorical":return function(e){return Object(K.jsx)("select",{id:e.id,onChange:function(t){return O(e)},children:e.options.map((function(e){return Object(K.jsx)("option",{value:e.value,children:e.display},e.display)}))})}(i);case"boolean":return T(i);case"string":return P(i)}var e}()]}),i.encodable?Object(K.jsxs)("td",{children:[Object(K.jsx)("button",{className:"unencodeBtn",id:i.id+"UnencodeBtn"}),Object(K.jsxs)(Je.a,{id:i.id+"EncodeBtn",children:[Object(K.jsx)(Je.a.Toggle,{className:"encodeBtn",variant:"link",bsPrefix:"p-0"}),Object(K.jsx)(Je.a.Menu,{children:null===y?[]:y.getEncodableFields(i.channel).map((function(t,a){var n=function(e,t,i){var a={};for(var n in i.encodings){var c=i.encodings[n];for(var r in c){var l=c[r];z(r,t)&&l.dataTable.getFieldType(l.field)===e&&(l.scale.id in a||(a[l.scale.id]=[]),a[l.scale.id].push(l))}}return a}(y.getFieldType(t),i.channel,e.scene);if(0===Object.keys(n).length)return Object(K.jsx)(Je.a.Item,{className:"encodeFields",onClick:function(e){w(t,i.channel)},children:t},t);var c=[];for(var r in n)c.push({fields:n[r].map((function(e){return e.field})).join("/"),scale:n[r][0].scale});return Object(K.jsxs)(Je.a,{id:i.id+"_scale_"+t,drop:"start",children:[Object(K.jsx)(Je.a.Toggle,{as:B,bsPrefix:"p-0",children:t}),Object(K.jsx)(Je.a.Menu,{children:[null].concat(c).map((function(e,a){return null===e?Object(K.jsx)(Je.a.Item,{className:"encodeFields",onClick:function(e){w(t,i.channel)},children:"Create new scale"},"new"+a):Object(K.jsx)(Je.a.Item,{className:"encodeFields",onClick:function(a){w(t,i.channel,e.scale)},onMouseEnter:function(t){C(e.scale,!0)},onMouseLeave:function(t){C(e.scale,!1)},children:"Merge with "+e.fields},e.scale.id+"_"+a)}))})]},i.id+"_scale_"+t)}))})]})]}):Object(K.jsx)("td",{})]},t)};return Object(K.jsxs)("div",{children:[Object(K.jsx)("div",{className:"propertyPanel",onClick:function(e){return p(null)},style:{overflow:"visible"},children:Object.keys(E).map((function(e){return Object(K.jsxs)("div",{children:[Object(K.jsx)("span",{className:Ze[e].concat(["propertyGroupHeader"]).join(" "),children:e}),Object(K.jsx)("table",{children:Object(K.jsx)("tbody",{children:Object.keys(E[e]).map((function(t){return D(t,E[e][t])}))})})]},e)}))}),Object(K.jsx)("div",{id:"colorPicker",children:Object(K.jsx)(_e.a,{disableAlpha:!0,color:c,onChangeComplete:function(e){return r(e.hex)}})})]})})),lt=(i(300),function e(t,i,a){if(i.push({item:t,level:a}),t.children)switch(t.type){case"collection":e(t.firstChild,i,a+1);break;case"axis":case"legend":case"gridlines":break;default:for(var n=t.children.length-1;n>=0;n--)e(t.children[n],i,a+1)}}),st=function(e){switch(e.type){case"axis":case"legend":return e.id;default:return e.classId?e.classId:e.id}};var ot=Object(d.b)((function(e){return{selected:e.canvas.selected,dataItemJoined:e.canvas.dataItemJoined,newItemCreated:e.canvas.newItemCreated,itemsDeleted:e.canvas.itemsDeleted}}))((function(e){return Object(a.useEffect)((function(){var t=[];lt(e.scene,t,-1),t.forEach((function(e,t){return e.index=t}));var i=M.select(".layerView");i.selectAll("*").remove(),i.append("text").text("Layers").style("font-weight","bold").attr("class","layerText").attr("x",20).attr("y",16);var a=i.selectAll(".layer").data(t.slice(1)).enter().append("g").attr("class","layer");a.append("rect").attr("class","layerRow").attr("id",(function(e){return st(e.item)})).attr("x",0).attr("y",(function(e){return 20+25*e.index-3})).attr("width",260).attr("height",25).on("click",(function(e,t){R.dispatch(v(null)),R.dispatch(T("Select")),R.dispatch(y([t.item.id]))})),a.append("image").attr("class","layerIcon").attr("x",(function(e){return 20+25*e.level})).attr("y",(function(e){return 20+25*e.index+2})).attr("href",(function(e){return"/app/icons/"+e.item.type+".png"})),a.append("text").attr("class","layerText").attr("x",(function(e){return 20+25*e.level+22})).attr("y",(function(e){return 20+25*e.index+1})).text((function(e){return function(e){if("axis"===e.type)return e.channel.substring(0,1).toUpperCase()+e.channel.substring(1)+" axis: "+e.field;var t=e.type.substring(0,1).toUpperCase()+e.type.substring(1);if(e.dataScope){var i=e.getScene().getPeers(e);i.length>1&&(t+=" ("+i.length+")");var a=e.dataScope.fields;e.parent&&"collection"===e.parent.type&&e.parent.dataScope&&(a=a.filter((function(t){return e.parent.dataScope.fields.indexOf(t)<0})));var n=a.join(", ");"atlas_rowId"===n&&(n="row ID"),""!==n&&(t+=": "+n)}return t}(e.item)}))}),[e.scene,e.dataItemJoined,e.newItemCreated,e.itemsDeleted]),Object(a.useEffect)((function(){if(M.selectAll(".layerRow").classed("layerSelected",!1),e.selected.length>0){var t=e.scene.getItem(e.selected[0]);if(!t)return;M.select(".layerView").select("#"+st(t)).classed("layerSelected",!0)}}),[e.scene,e.selected]),Object(K.jsx)("svg",{className:"layerView"})})),dt=i(3),pt=(i(301),i(104)),ut=i(17);var ht=Object(d.b)((function(e){return{selected:e.canvas.selected,directSelected:e.canvas.directSelected}}))((function(e){var t=Object(a.useState)(null),i=Object(o.a)(t,2),n=i[0],c=i[1],r=Object(a.useState)(null),l=Object(o.a)(r,2),s=l[0],d=l[1],p=Object(a.useRef)(null),u=Object(a.useMemo)((function(){if(null===n)return[{Header:" ",accessor:" "}];var e,t=n.fields,i=[],a=Object(G.a)(t);try{var c=function(){var t=e.value;i.push({Header:"atlas_rowId"===t?"Row ID":t,accessor:t,filter:"equals",Cell:function(e){var i=e.value;return n.getRawValue(t,i)}})};for(a.s();!(e=a.n()).done;)c()}catch(kt){a.e(kt)}finally{a.f()}return i}),[n]),h=Object(a.useMemo)((function(){return null===n?[{col:1}]:n.data}),[n]),y=Object(pt.useTable)({columns:u,data:h,initialState:{hiddenColumns:["atlas_rowId"]}},pt.useFilters),v=y.getTableProps,f=y.getTableBodyProps,b=y.headerGroups,g=y.rows,x=y.prepareRow,j=y.setFilter,m=y.setAllFilters,O=function(e){if(!n)return Object(K.jsx)("span",{});switch(n.getFieldType(e)){case"string":return Object(K.jsx)("img",{src:"/app/icons/string.png",alt:"(string) ",width:"20px",height:"10px",style:{margin:"0 4px 2px 0"}});case"date":return Object(K.jsx)("img",{src:"/app/icons/date.png",alt:"(date) ",width:"15px",style:{margin:"0 3px 2px 0"}});default:return Object(K.jsx)("img",{src:"/app/icons/number.png",alt:"(number) ",width:"12px",height:"12px",style:{margin:"0 2px 3px 0"}})}};return Object(a.useEffect)((function(){if(!e.datasets||0===e.datasets.length)return c(null),m([]),void d(null);if(0!==e.selected.length||e.directSelected){if(e.selected.length>0){var t=e.scene.getItem(e.selected[0]);if(!t||"axis"===t.type||"legend"===t.type||"gridlines"===ut.d.type)return c(e.datasets[0]),m([]),void d(null);if(t.dataScope){c(t.dataScope.dataTable);var i=t.dataScope.filters;for(var a in i)j(a,i[a]);d("Selected "+t.type+" has "+t.dataScope.numTuples+" attached data rows")}else c(null),m([]),d("Selected "+t.type+" has no attached data")}else if(e.directSelected){var n=e.scene.getItem(e.directSelected);if(n||(c(e.datasets[0]),m([]),d(null)),n.dataScope){c(n.dataScope.dataTable);var r=n.dataScope.filters;for(var l in r)j(l,r[l]);d("Selected "+n.type+" has "+n.dataScope.numTuples+" attached data rows")}else c(null),m([]),d("Selected "+n.type+" has no attached data")}}else c(e.datasets[0]),m([]),d(null)}),[e.selected,e.directSelected,e.scene,e.datasets,m,j]),Object(K.jsxs)("div",{id:"dataPanel",children:[Object(K.jsxs)("div",{id:"datasetInfo",children:[e.datasets.map((function(e){return Object(K.jsx)("div",{className:n&&n.id===e.id?"activeTableTab":"tableTab",onClick:function(t){return c(e)},children:e.name+" ("+e.getRowCount()+" rows)"},e.id)})),Object(K.jsx)("button",{id:"csvBtn",onClick:function(){p.current.click()},children:"Import Data"}),Object(K.jsx)("input",{type:"file",id:"file",ref:p,style:{display:"none"},accept:".csv",onChange:function(t){t.stopPropagation(),t.preventDefault();var i=t.target.files[0],a=new FileReader;a.onload=function(){U(e.scene,e.datasets,e.undoStack);var t=Object(N.csvFromString)(a.result,i.name),n=e.datasets.slice();n.push(t),e.loadDataset(n),c(t)},i&&a.readAsText(i)}})]}),Object(K.jsx)("div",{id:"dataScopeInfo",style:{display:s?"block":"none"},children:s||""}),Object(K.jsx)("div",{id:"tableDiv",children:Object(K.jsxs)("table",Object(dt.a)(Object(dt.a)({id:"dataTable"},v()),{},{children:[Object(K.jsx)("thead",{children:b.map((function(e){return Object(K.jsx)("tr",Object(dt.a)(Object(dt.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(K.jsxs)("th",Object(dt.a)(Object(dt.a)({},e.getHeaderProps()),{},{children:[O(e.Header),e.render("Header")]}))}))}))}))}),Object(K.jsx)("tbody",Object(dt.a)(Object(dt.a)({},f()),{},{children:g.map((function(e){return x(e),Object(K.jsx)("tr",Object(dt.a)(Object(dt.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(K.jsx)("td",Object(dt.a)(Object(dt.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))})]})}));i(303);var yt=Object(d.b)((function(e){return{legendClicked:e.canvas.legendClicked}}))((function(e){var t=Object(a.useState)(null),i=Object(o.a)(t,2),n=i[0],c=i[1],r=Object(a.useState)("#fff"),l=Object(o.a)(r,2),s=l[0],d=l[1],p=Object(a.useState)(null),u=Object(o.a)(p,2),h=u[0],y=u[1];return Object(a.useEffect)((function(){var t=e.legendClicked.legend,i=e.legendClicked.value;t&&i?(M.select("#legendColorPicker").style("visibility","visible"),c(e.scene.getItem(t)),y(i),d(e.scene.getItem(t).encoding.scale.map(i))):M.select("#legendColorPicker").style("visibility","hidden")}),[e.legendClicked,e.scene]),Object(K.jsx)("div",{id:"legendColorPicker",children:Object(K.jsx)(_e.a,{disableAlpha:!0,color:s,onChangeComplete:function(t,i){d(t.hex);var a,c=n.encoding.scale.domain,r=[],l=Object(G.a)(c);try{for(l.s();!(a=l.n()).done;){var s=a.value;s===h?r.push(t.hex):r.push(n.encoding.scale.map(s))}}catch(kt){l.e(kt)}finally{l.f()}n.encoding.scale._setRange(r),e.renderer.render(e.scene)}})})}));var vt=function(e){var t=Object(a.useState)(N.renderer("svg","canvas")),i=Object(o.a)(t,1)[0],n=Object(a.useState)(N.scene()),c=Object(o.a)(n,2),r=c[0],l=c[1],s=Object(a.useState)(""),d=Object(o.a)(s,2),p=d[0],u=d[1],h=Object(a.useState)([]),f=Object(o.a)(h,2),b=f[0],g=f[1],x=Object(a.useState)([]),m=Object(o.a)(x,2),O=m[0],S=m[1],k=Object(a.useState)([]),w=Object(o.a)(k,2),C=w[0],I=w[1];Object(a.useEffect)((function(){document.body.style.backgroundColor="#ddd",document.body.style.overflow="hidden"}),[]),Object(a.useEffect)((function(){p&&fetch("app/scenes/"+p+".alscn").then((function(e){return e.json()})).then((function(e){P(e)}))}),[p]),Object(a.useEffect)((function(){R.dispatch(j({visible:!1})),R.dispatch(y([])),R.dispatch(v(null)),i.clear(),i.render(r)}),[i,r]);var P=function(e){var t=N.sceneLoader(),i=t.load(e);l(i),g(Object.values(t.tables))};return Object(K.jsxs)("div",{style:{overflow:"hidden"},children:[Object(K.jsx)($,{scene:r,renderer:i,datasets:b,undoStack:O,redoStack:C,type:"svg"}),Object(K.jsx)(De,{scene:r,renderer:i,datasets:b,undoStack:O,redoStack:C}),Object(K.jsx)("div",{id:"specList",style:{display:"none"},children:Object(K.jsx)("ul",{children:["Rect","BarChartHorz","BarChartVert","BoxPlot","BulletChart","DivergingBarChart","GanttChart","GroupedBarChart","HeatMap","Histogram","MosaicPlot","StackedBarChart","TowerChart","Treemap","WaffleChart","WaterfallChart","BubblePlot","CirclePacking","DotPlot","DoughnutChart","PieChart","RadialBarChart","Scatterplot","Sunburst","BumpChart","ConnectedScatterPlot","DumbbellChart","LineGraph","LineGraph2","LollipopChart","MultiLineGraph","ParallelCoordinates","RangeChart","SlopeGraph","StringlineChart","AreaChart","DensityPlot","RadarChart","RidgelinePlot","RoseChart","StackedAreaChart","StellarChart","StreamGraph","ViolinPlot","Isotype","GridAreaChart","MultipleBarCharts","MultipleBoxPlots","MultiplePieCharts","ScatterplotMatrix","Sparklines","GridStackedAreaChart","MultipleViolinPlots"].map((function(e){return Object(K.jsx)("li",{onClick:function(t){return u(e)},children:e},e)}))})}),Object(K.jsx)(ht,{scene:r,renderer:i,datasets:b,undoStack:O,loadDataset:g}),Object(K.jsx)(ot,{scene:r,renderer:i}),Object(K.jsx)(Xe,{scene:r,renderer:i,datasets:b,undoStack:O,redoStack:C,resetStacks:function(){S([]),I([])},loadScene:P}),Object(K.jsx)(rt,{scene:r,renderer:i,datasets:b,undoStack:O}),Object(K.jsx)(yt,{scene:r,renderer:i}),Object(K.jsx)("input",{type:"text",id:"textElement",style:{visibility:"hidden",position:"absolute"}})]})},ft=i(13),bt=i.n(ft),gt=i(105);function xt(e){return jt.apply(this,arguments)}function jt(){return(jt=Object(gt.a)(bt.a.mark((function e(t){var i,a,n;return bt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return i=e.sent,e.next=5,i.text();case 5:return a=e.sent,n=JSON.parse(a),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var mt=function(e){var t=N.renderer("svg","canvas"),i=Object(a.useState)(N.scene()),n=Object(o.a)(i,2),c=n[0],r=n[1],l=Object(a.useState)("BarChartHorz"),s=Object(o.a)(l,2),d=s[0],p=s[1];Object(a.useEffect)((function(){document.body.style.backgroundColor="#ddd",document.body.style.overflow="hidden"}),[]),Object(a.useEffect)((function(){u("specs/"+d+".json")}),[d]),Object(a.useEffect)((function(){t.clear(),t.render(c)}),[t,c]);var u=function(){var e=Object(gt.a)(bt.a.mark((function e(t){var i,a,n;return bt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xt(t);case 2:return i=e.sent,a=N.specExecutor(),e.next=6,a.run(i);case 6:n=e.sent,R.dispatch(y([])),r(n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(K.jsxs)("div",{style:{overflow:"hidden"},children:[Object(K.jsx)($,{scene:c,renderer:t,type:"svg"}),Object(K.jsx)(De,{scene:c,renderer:t}),Object(K.jsx)("div",{id:"specList",children:Object(K.jsx)("ul",{children:["BarChartHorz","BarChartVert","BoxPlot","BulletChart","DivergingBarChart","GanttChart","GroupedBarChart","HeatMap","Histogram","MosaicPlot","StackedBarChart","TowerChart","Treemap","WaffleChart","WaterfallChart"].map((function(e){return Object(K.jsx)("li",{onClick:function(t){return p(e)},children:e},e)}))})}),Object(K.jsx)(ht,{scene:c,renderer:t}),Object(K.jsx)(ot,{scene:c,renderer:t}),Object(K.jsx)(rt,{scene:c,renderer:t}),Object(K.jsx)(Xe,{})]})};var Ot=function(e){return Object(K.jsx)(l.a,{basename:"/app",children:Object(K.jsx)("div",{children:Object(K.jsxs)(s.c,{children:[Object(K.jsx)(s.a,{path:"/",element:Object(K.jsx)(vt,{})}),Object(K.jsx)(s.a,{path:"/reuse",element:Object(K.jsx)(mt,{})})]})})})},St=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,316)).then((function(t){var i=t.getCLS,a=t.getFID,n=t.getFCP,c=t.getLCP,r=t.getTTFB;i(e),a(e),n(e),c(e),r(e)}))};r.a.render(Object(K.jsx)(n.a.StrictMode,{children:Object(K.jsx)(d.a,{store:R,children:Object(K.jsx)(Ot,{})})}),document.getElementById("root")),St()},80:function(e,t,i){}},[[305,1,2]]]);
//# sourceMappingURL=main.dea4ed19.chunk.js.map